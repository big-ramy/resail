// --- ุจุฏุงูุฉ ุงูููู: translations, global variables, DOMContentLoaded etc. ---
const translations = {
    "ar": {
        "image-paths": { // ูุฐุง ูู ุงูุฌุฒุก ุงูุฎุงุต ุจูุณุงุฑุงุช ุงูุตูุฑ
            "normal": (id) => `CV templates_ar/${id}.webp`,
            "standard": (id) => `CV templates_ar/${id}.webp`,
            "professional": (id) => `CV templates_ar/${id}.webp`,
            "ast": (id) => `CV templates_ar/${id}.webp`
        },
        // ุชุฑุฌูุงุช ุตูุญุฉ ุงูุฏูุน (ุงูุนุฑุจูุฉ)
        "local-payment-title": "ุงูุฏูุน ุงููุญูู",
        "local-payment-desc": "(ุนุจุฑ STC Pay ุฃู ุชุญููู ุงูุฑุงุฌุญู)",
        "sar-currency": "ุฑูุงู ุณุนูุฏู",
        "click-to-pay": "ุงุฎุชุฑ ูุณููุชู ุงูููุถูุฉ:",
        "international-payment-header": "ุฏููู ูุขูู",
        "card-payment-title": "ุงูุฏูุน ุจุงูุจุทุงูุฉ ุงูุงุฆุชูุงููุฉ",
        "click-to-pay-ls": "ุงุถุบุท ููุฏูุน ุงูุขูู:",
        "pay-with-card": "ุงุฏูุน ุงูุขู",
        "select_font_label": "ุงุฎุชุฑ ุฎุท ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ:",
        // ุชุฑุฌูุงุช ุฑุณุงุฆู ุงูุชูุจูู/ุงูุฃุฎุทุงุก (ุงูุนุฑุจูุฉ)
        "Please fill in all fields.": "ุงูุฑุฌุงุก ููุก ุฌููุน ุงูุญููู ุงููุทููุจุฉ.",
        "Please enter a valid email.": "ุงูุฑุฌุงุก ุฅุฏุฎุงู ุนููุงู ุจุฑูุฏ ุฅููุชุฑููู ุตุงูุญ.",
        "File size exceeds the limit (3MB).": "ุญุฌู ุงูููู ูุชุฌุงูุฒ ุงูุญุฏ ุงููุณููุญ ุจู (3 ููุฌุงุจุงูุช).",
        "Please attach only image or PDF files.": "ุงูุฑุฌุงุก ุฅุฑูุงู ูููุงุช ุตูุฑ ุฃู PDF ููุท.",
        "An error occurred while preparing your payment. Please try again or contact support.": "ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญุถูุฑ ุนูููุฉ ุงูุฏูุน. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู ุฃู ุงูุงุชุตุงู ุจุงูุฏุนู.",
        "Error, price for this category is undefined.": "ุญุฏุซ ุฎุทุฃุ ุงูุณุนุฑ ููุฐู ุงููุฆุฉ ุบูุฑ ูุญุฏุฏ.",
        "Please select a valid image file.": "ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ููู ุตูุฑุฉ ุตุงูุญ.",
        "Image size is too large. Please select an image smaller than {size} megabytes.": "ุญุฌู ุงูุตูุฑุฉ ูุจูุฑ ุฌุฏุงู. ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุตูุฑุฉ ุฃุตุบุฑ ูู {size} ููุบุงุจุงูุช.",
        "You must have at least one field in this section.": "ูุฌุจ ุฃู ูููู ูุฏูู ุญูู ูุงุญุฏ ุนูู ุงูุฃูู ูู ูุฐุง ุงููุณู.",
        "payment-success": "ุชู ุงุณุชูุงู ุทูุจู ุจูุฌุงุญ! ุณูุชู ุฅุฑุณุงู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ุฅูู ุจุฑูุฏู ุงูุฅููุชุฑููู ูุฑูุจุงู.",
        "Error processing file.": "ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ูุนุงูุฌุฉ ุงูููู.",
        "Enter a skill": "ุฃุฏุฎู ููุงุฑุฉ",
        //ูุณู ุงูููุงุฑุงุช
        "Select Level": "ุงุฎุชุฑ ุงููุณุชูู",
        "Beginner": "ูุจุชุฏุฆ",
        "Intermediate": "ูุชูุณุท",
        "Advanced": "ูุชูุฏู",
        "Expert": "ุฎุจูุฑ",
        "accordion_image_controls": "๐ผ๏ธ ุงูุชุญูู ุจุงูุตูุฑุฉ ุงูุดุฎุตูุฉ",
        "image_size_label": "ุญุฌู ุงูุตูุฑุฉ",
        "image_radius_label": "ุดูู ุงูุฅุทุงุฑ (Radius)",
        "accordion_font_controls": "โ๏ธ ุงูุชุญูู ุจุงูุฎุทูุท",
        "accordion_size_controls": "๐ ุงูุชุญูู ุจุฃุญุฌุงู ุงููุตูุต",
        "name_size_label": "ุญุฌู ุงูุงุณู",
        "title_size_label": "ุญุฌู ุงููุณูู ุงููุธููู",
        "contact_size_label": "ุญุฌู ูุนูููุงุช ุงูุงุชุตุงู",
        "section_title_size_label": "ุญุฌู ุนูุงููู ุงูุฃูุณุงู",
        "subsection_title_size_label": "ุญุฌู ุงูุนูุงููู ุงููุฑุนูุฉ",
        "body_text_size_label": "ุญุฌู ุงููุต ุงูุฃุณุงุณู",
        "accordion_color_controls": "๐จ ุงูุชุญูู ุจุงูุฃููุงู",
        "select_name_font_label": "ุฎุท ุงูุงุณู ุงูุฑุฆูุณู:",
        "select_headings_font_label": "ุฎุท ุงูุนูุงููู:",
        "select_body_font_label": "ุฎุท ุงููุต ุงูุฃุณุงุณู:",

        // --- ุชุฑุฌูุงุช ููุญุฉ ุงูุชุญูู ุจุงูุฃููุงู ---
        "color_presets_titl": "ุงุฎุชุฑ ูุงูุจ ุงููุงู",
        "color_customization_title":"ุชุฎุตูุต ุฃููุงู ุงููุงูุจ",
        "background_colors_title": "ุฃููุงู ุงูุฎูููุงุช",
        "primary_bg_label": "ุงูุฎูููุฉ ุงูุฃุณุงุณูุฉ / ุงูุฑุฃุณ",
        "sidebar_bg_label": "ุฎูููุฉ ุงูุนุงููุฏ ุงูุฌุงูุจู",
        "accent_bg_label": "ุฎูููุฉ ูููุฒุฉ / ููููุงุฑุงุช",
        "gradient_label": "ูุชุฏุฑุฌ",
        "text_colors_title": "ุฃููุงู ุงููุตูุต ูุงูุฃููููุงุช",
        "header_text_label": "ูุต ุงูุฑุฃุณ",
        "title_text_label": "ูุต ุงูุนูุงููู",
        "body_text_label": "ูุต ุงููุญุชูู",
        "subtle_text_label": "ูุต ูุฑุนู",
        "gradient_horizontal": "ุฃููู",
        "gradient_vertical": "ุนููุฏู",
        "gradient_diagonal": "ูุทุฑู",

        // ุงูุชุฑุฌูุงุช ุงูุนุงูุฉ ุงููุชุจููุฉ ูู ุงูููู ุงูุฃุตูู
        "promo_bar_text": "ุนุฑุถ ุฎุงุต! ุงุณุชุฎุฏู ููุฏ <span class='blinking-code'>FIRSTBUY</span> ูุฎุตู 25% ุฃู ููุฏ <span class='blinking-code'>SAVE10</span> ูุฎุตู 10%!",
        "from-city": "ูู",
        "notification-action": "ูุงู ููุชู ุจุฅูุดุงุก ุณูุฑุชู ุงูุฐุงุชูุฉ!",
        "CV downloaded successfully!": "ุชู ุชูุฒูู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ุจูุฌุงุญ!",
        "Professional CV Builder": "ุฅูุดุงุก ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ุงูุงุญุชุฑุงููุฉ",
        "brand-name": "ุฑุณุงุฆู",
        "home-link": "ุงูุฑุฆูุณูุฉ",
        "features-link": "ุงููููุฒุงุช",
        "products-link": "ุงูููุชุฌุงุช",
        "product-basic": "ุงุฑุณุงู ูุงุชุณุงุจ",
        "product-cv": "ุฅูุดุงุก ุณูุฑุฉ ุฐุงุชูุฉ",
        "about-link": "ุนูุง",
        "contact-link": "ุงุชุตู ุจูุง",
        "English": "English",
        "Professional CV Builder_header": "ุฃูุดุฆ ุณูุฑุชู ุงูุฐุงุชูุฉ ุงูุงุญุชุฑุงููุฉ ุจุณูููุฉ",
        "Create a professional CV that stands out and gets you hired.": "ุงุจุฑุฒ ููุงุฑุงุชู ูุฎุจุฑุงุชู ุจุชุตููู ุงุญุชุฑุงูู ูููุช ุงูุงูุชุจุงู ูููุชุญ ูู ุฃุจูุงุจ ุงููุฑุต.",
        "Create Your CV Now": "ุงุจุฏุฃ ูู ุฅูุดุงุก ุณูุฑุชู ุงูุฐุงุชูุฉ ุงูุขู",
        "loading-cv-text": "ุฌุงุฑู ุฅูุดุงุก ุงูุณูุฑุฉ ุงูุฐุงุชูุฉุ ูุฑุฌู ุงูุงูุชุธุงุฑ...",
        "Why Resail CV Builder?": "ููุงุฐุง ูุธุงู ุฑุณุงุฆู ูุฅูุดุงุก ุงูุณูุฑุฉ ุงูุฐุงุชูุฉุ",
        "Easy Data Entry": "ุณูููุฉ ุฅุฏุฎุงู ุงูุจูุงูุงุช",
        "Intuitive forms to quickly fill in all your information.": "ููุงุฐุฌ ุณููุฉ ูุจุฏูููุฉ ูููุก ุฌููุน ุจูุงูุงุชู ุจุณุฑุนุฉ ููุณุฑ.",
        "Diverse and Professional Templates": "ููุงูุจ ูุชููุนุฉ ูุงุญุชุฑุงููุฉ",
        "Choose from many modern and attractive designs to suit your style.": "ุงุฎุชุฑ ูู ุจูู ุงูุนุฏูุฏ ูู ุงูุชุตูููุงุช ุงูุนุตุฑูุฉ ูุงูุฌุฐุงุจุฉ ูุชูุงุณุจ ุฐููู ููุฌุงูู.",
        "Arabic and English Support": "ุฏุนู ูุงูู ููุบุฉ ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ",
        "Create your CV in either Arabic or English with proper formatting.": "ุฃูุดุฆ ุณูุฑุชู ุงูุฐุงุชูุฉ ุจูุบุชู ุงูููุถูุฉ ูุน ุถูุงู ุงูุชูุณูู ุงูุตุญูุญ ูููุง ุงูุงุชุฌุงููู.",
        "Instant Preview": "ูุนุงููุฉ ููุฑูุฉ",
        "See your CV instantly as you build it, ensuring it looks perfect.": "ุดุงูุฏ ุดูู ุณูุฑุชู ุงูุฐุงุชูุฉ ููุฑ ุฅุฏุฎุงู ุงูุจูุงูุงุช ุฃู ุงุฎุชูุงุฑ ุงููุงูุจ ูุชุถูู ุงููุธูุฑ ุงููุซุงูู.",
        "Professional PDF Export": "ุชุตุฏูุฑ ุจุตูุบุฉ PDF ุนุงููุฉ ุงูุฌูุฏุฉ",
        "Download your completed CV as a high-quality PDF file, ready to share.": "ุงุญุตู ุนูู ุณูุฑุชู ุงูุฐุงุชูุฉ ุงูููุงุฆูุฉ ูููู PDF ุงุญุชุฑุงูู ุฌุงูุฒ ููุทุจุงุนุฉ ุฃู ุงููุดุงุฑูุฉ ุนุจุฑ ุงูุฅูุชุฑูุช.",
        "Flexible Payment Options": "ุฎูุงุฑุงุช ุฏูุน ูุชููุนุฉ ูุขููุฉ",
        "Pay easily using various methods including PayPal and local options.": "ูุณุงุฆู ุฏูุน ูุชุนุฏุฏุฉ ุชุดูู PayPal ูุฎูุงุฑุงุช ูุญููุฉ ูุชุณููู ุนูููุฉ ุงูุญุตูู ุนูู ุณูุฑุชู ุงูุฐุงุชูุฉ.",
        "Customer Testimonials": "ูุงุฐุง ูุงู ุนููุงุคูุง ุนูุงุ",
        "โCreating my CV was incredibly easy and fast. The templates are modern and professional. Highly recommended!โ": "ยซูุงูุช ุนูููุฉ ุฅูุดุงุก ุณูุฑุชู ุงูุฐุงุชูุฉ ุณููุฉ ูุณุฑูุนุฉ ุจุดูู ูุง ูุตุฏู. ุงูููุงูุจ ุนุตุฑูุฉ ูุงุญุชุฑุงููุฉ ุญููุง. ุฃูุตู ุจู ุจุดุฏุฉ!ยป",
        "- Sarah Ahmed": "- ุณุงุฑุฉ ุฃุญูุฏ",
        "โI loved the variety of templates and the instant preview feature. It helped me choose the perfect design for my application.โ": "ยซุฃุนุฌุจุชูู ุญููุง ุชููุน ุงูููุงูุจ ูููุฒุฉ ุงููุนุงููุฉ ุงูููุฑูุฉ. ุณุงุนุฏูู ุฐูู ูู ุงุฎุชูุงุฑ ุงูุชุตููู ุงููุซุงูู ูุชูุฏููู.ยป",
        "- Khalid Hassan": "- ุฎุงูุฏ ุญุณู",
        "About Resail CV Builder": "ุนู ูุธุงู ุฑุณุงุฆู ูุฅูุดุงุก ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ",
        "Resail is your go-to platform for effortlessly creating professional and impactful CVs. We provide a wide range of modern templates and intuitive tools to help you stand out in the job market with a high-quality PDF resume.": "ุฑุณุงุฆู ูู ูุธุงูู ุงููุชูุงูู ูุฅูุดุงุก ุณูุฑ ุฐุงุชูุฉ ุงุญุชุฑุงููุฉ ููุคุซุฑุฉ ุจุณูููุฉ. ููุฏู ูุฌููุนุฉ ูุงุณุนุฉ ูู ุงูููุงูุจ ุงูุนุตุฑูุฉ ูุงูุฃุฏูุงุช ุงูุจุฏูููุฉ ููุณุงุนุฏุชู ุนูู ุงูุชููุฒ ูู ุณูู ุงูุนูู ุจุณูุฑุฉ ุฐุงุชูุฉ ุนุงููุฉ ุงูุฌูุฏุฉ ุจุตูุบุฉ PDF.",
        "Our service focuses on simplifying the CV creation process, offering diverse templates, and ensuring full support for both Arabic and English languages with accurate formatting. Download your ready-to-share PDF CV after a seamless payment process.": "ุชุฑูุฒ ุฎุฏูุชูุง ุนูู ุชุจุณูุท ุนูููุฉ ุฅูุดุงุก ุงูุณูุฑุฉ ุงูุฐุงุชูุฉุ ูุชูุฏูู ููุงูุจ ูุชููุนุฉุ ูุถูุงู ุงูุฏุนู ุงููุงูู ููุบุชูู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ ุจุชูุณูู ุฏููู. ุงุญุตู ุนูู ุณูุฑุชู ุงูุฐุงุชูุฉ ุจุตูุบุฉ PDF ุฌุงูุฒุฉ ูููุดุงุฑูุฉ ุจุนุฏ ุนูููุฉ ุฏูุน ุณูุณุฉ.",
        "CVs Generated So Far": "ุนุฏุฏ ุงูุณูุฑ ุงูุฐุงุชูุฉ ุงูุชู ุชู ุฅูุดุงุคูุง ุญุชู ุงูุขู",
        "+ูฅููู": "+ูฅููู",
        "Join thousands who have successfully created their professional CVs.": "ุงูุถู ุฅูู ุขูุงู ุงููุณุชุฎุฏููู ุงูุฐูู ุฃูุดุฃูุง ุณูุฑูู ุงูุฐุงุชูุฉ ุงูุงุญุชุฑุงููุฉ ุจูุฌุงุญ.",
        "Frequently Asked Questions": "ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ",
        "How do I create a CV?": "ููู ูููููู ุฅูุดุงุก ุณูุฑุฉ ุฐุงุชูุฉุ",
        "Simply click on 'Create Your CV Now', fill in your details in the form, choose a template, and preview your CV.": "ูุง ุนููู ุณูู ุงูููุฑ ุนูู ุฒุฑ 'ุงุจุฏุฃ ูู ุฅูุดุงุก ุณูุฑุชู ุงูุฐุงุชูุฉ ุงูุขู'ุ ูู ุจููุก ุจูุงูุงุชู ูู ุงููููุฐุฌุ ุงุฎุชุฑ ุงููุงูุจ ุงูููุงุณุจุ ููู ุจูุนุงููุฉ ุณูุฑุชู ุงูุฐุงุชูุฉ.",
        "Are the templates free?": "ูู ุงูููุงูุจ ูุฌุงููุฉุ",
        "We offer a variety of free and premium templates. Premium templates require a small fee for download.": "ููุฏู ูุฌููุนุฉ ูุชููุนุฉ ูู ุงูููุงูุจ ุงููุฌุงููุฉ ูุงููุฏููุนุฉ. ุชุชุทูุจ ุงูููุงูุจ ุงููุฏููุนุฉ ุฑุณูุงู ุจุณูุทุงู ููุชูุฒูู ุฃู ุงูุทุจุงุนุฉ.",
        "How do I download my CV?": "ููู ูููููู ุชูุฒูู ุณูุฑุชู ุงูุฐุงุชูุฉุ",
        "After previewing your CV, click on 'Request Download / Print'. You will be guided through the payment process if you selected a premium template, and then you can download the PDF.": "ุจุนุฏ ูุนุงููุฉ ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ูุงุฎุชูุงุฑ ุงููุงูุจุ ุงููุฑ ุนูู ุฒุฑ 'ุทูุจ ุชูุฒูู / ุทุจุงุนุฉ'. ุณูุชู ุชูุฌููู ูุนูููุฉ ุงูุฏูุน ุฅุฐุง ุงุฎุชุฑุช ูุงูุจุงู ูุฏููุนุงูุ ูุจุนุฏูุง ููููู ุชูุฒูู ุงูููู ุจุตูุบุฉ PDF.",
        "Contact Us": "ุชูุงุตู ูุนูุง",
        "For inquiries or support, please contact us via email: ramyheshamamer@gmail.com": "ููุงุณุชูุณุงุฑุงุช ุฃู ุงูุฏุนูุ ุชูุงุตู ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู: <strong><a href=\"mailto:ramyheshamamer@gmail.com\">ramyheshamamer@gmail.com</a></strong>",
        "Enter Your Information": "ุฃุฏุฎู ุจูุงูุงุชู",
        "Full Name": "ุงูุงุณู",
        "Enter your name": "ุฃุฏุฎู ุงุณูู",
        "Job Title": "ุงููุณูู ุงููุธููู",
        "Enter your job title": "ุฃุฏุฎู ุงููุณูู ุงููุธููู",
        "Email Address": "ุงูุจุฑูุฏ ุงูุฅููุชุฑููู",
        "Enter your email address": "ุฃุฏุฎู ุจุฑูุฏู ุงูุฅููุชุฑููู",
        "Phone Number": "ุฑูู ุงููุงุชู",
        "Enter your phone number": "ุฃุฏุฎู ุฑูู ูุงุชูู",
        "Website / Portfolio": "ุงููููุน ุงูุดุฎุตู",
        "Enter your website or portfolio URL": "ุฃุฏุฎู ูููุนู ุงูุดุฎุตู",
        "Profile Picture": "ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ",
        "Choose a picture to enhance the look of your CV in some templates.": "ุงุฎุชุฑ ุตูุฑุฉ ูุชุญุณูู ูุธูุฑ ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ูู ุจุนุถ ุงูููุงุฐุฌ.",
        "Career Objective": "ุงููุฏู ุงููุธููู",
        "Enter your career objective": "ุฃุฏุฎู ูุฏูู ุงููุธููู",
        "Work Experience": "ุงูุฎุจุฑุฉ ุงูุนูููุฉ",
        "Add Experience": "ุฅุถุงูุฉ ุฎุจุฑุฉ",
        "Remove Last": "ุญุฐู ุขุฎุฑ",
        "Job Title_placeholder": "ุงููุณูู ุงููุธููู",
        "Company": "ุงูุดุฑูุฉ",
        "Duration": "ุงููุฏุฉ",
        "Description": "ุงููุตู",
        "Education": "ุงููุคููุงุช ุงูุนูููุฉ",
        "Add Education": "ุฅุถุงูุฉ ูุคูู",
        "Degree": "ุงูุดูุงุฏุฉ",
        "University/Institution": "ุงูุฌุงูุนุฉ/ุงููุนูุฏ",
        // ุชุฑุฌูุฉ ุงุถุงูุฉ ูุณู ูุฎุตุต
        "custome-section": "ุฅุถุงูุฉ ูุณู ูุฎุตุต",
        "custom_section_placeholder": "ุนููุงู ุงููุณู ุงูุฌุฏูุฏ (ูุซุงู: ุงููุดุงุฑูุน ุฃู ุงูุฏูุฑุงุช)",
        "add_subsection_btn": '<i class="fas fa-plus"></i> ุฅุถุงูุฉ ุนููุงู ูุฑุนู',
        "remove_subsection_title": "ุญุฐู ุงูุนููุงู ุงููุฑุนู",
        "subsection_title_placeholder": "ุงูุนููุงู ุงููุฑุนู (ูุซุงู: ุดูุงุฏุฉ PMP)",
        "subsection_desc_placeholder": "ุงููุตู ุฃู ุงูุชูุงุตูู ุงููุชุนููุฉ ุจุงูุนููุงู ุงููุฑุนู...",
        "remove_section_btn": "ุญุฐู ุงููุณู ุจุงููุงูู",
        "confirm_delete_section": "ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงููุณู ุจุงููุงููุ",
        "Skills": "ุงูููุงุฑุงุช ",
        "Add Skill": "ุฅุถุงูุฉ ููุงุฑุฉ",
        "Enter a skill": "ุฃุฏุฎู ููุงุฑุฉ",
        "Languages": "ุงููุบุงุช",
        "Add Language": "ุฅุถุงูุฉ ูุบุฉ",
        "Enter a language": "ุฃุฏุฎู ูุบุฉ",
        "References": "ุงููุฑุงุฌุน",
        "Add Reference": "ุฅุถุงูุฉ ูุฑุฌุน",
        "Name": "ุงูุงุณู",
        "Position": "ุงููููุน",
        "Phone": "ุงููุงุชู",
        "Email": "ุงูุจุฑูุฏ",
        "Data Completion Progress": "ูุณุจุฉ ุฅููุงู ุงูุจูุงูุงุช",
        "Back to Home": "ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ",
        "Next: Choose Template": "ุงูุชุงูู: ุงุฎุชุฑ ูุงูุจ",
        "Choose a CV Template and Preview": "ุงุฎุชุฑ ูููุฐุฌูุง ููุณูุฑุฉ ุงูุฐุงุชูุฉ ูุงููุนุงููุฉ",
        "Normal Templates (Full Width)": "ููุงุฐุฌ ุนุงุฏูุฉ (ุนุฑุถ ุงูุตูุญุฉ)",
        "Normal Template 1 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 1",
        "Normal Template 2 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 2",
        "Normal Template 3 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 3",
        "Normal Template 4 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 4",
        "Normal Template 5 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 5",
        "Normal Template 6 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 6",
        "Normal Template 7 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 7",
        "Normal Template 8 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 8",
        "Normal Template 9 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 9",
        "Normal Template 10 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 10",
        "Normal Template 11 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 11",
        "Normal Template 12 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 12",
        "Standard Templates (Sidebar)": "ููุงุฐุฌ ุนุงุฏูุฉ (ูุณู ุฌุงูุจู ูุฑุฆูุณู)",
        "Standard Template 1 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 1 (ุดุฑูุท ุฌุงูุจู)",
        "Standard Template 2 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 2 (ุดุฑูุท ุฌุงูุจู)",
        "Standard Template 3 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 3 (ุดุฑูุท ุฌุงูุจู)",
        "Standard Template 4 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 4 (ุดุฑูุท ุฌุงูุจู)",
        "Standard Template 5 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 5 (ุดุฑูุท ุฌุงูุจู)",
        "Standard Template 6 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 6 (ุดุฑูุท ุฌุงูุจู)",
        "Standard Template 7 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 7 (ุดุฑูุท ุฌุงูุจู)",
        "Standard Template 8 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 8 (ุดุฑูุท ุฌุงูุจู)",
        "Standard Template 9 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 9 (ุดุฑูุท ุฌุงูุจู)",
        "Standard Template 10 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 10 (ุดุฑูุท ุฌุงูุจู)",
        "Standard Template 11 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 11 (ุดุฑูุท ุฌุงูุจู)",
        "Standard Template 12 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุนุงุฏู 12 (ุดุฑูุท ุฌุงูุจู)",
        "Professional Templates (Header + Sidebar)": "ููุงุฐุฌ ุงุญุชุฑุงููุฉ (ุฑุฃุณ ูุฌุงูุจู ูุฑุฆูุณู)",
        "Professional Template 1 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุงุญุชุฑุงูู 1",
        "Professional Template 2 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุงุญุชุฑุงูู 2",
        "Professional Template 3 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุงุญุชุฑุงูู 3",
        "Professional Template 4 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุงุญุชุฑุงูู 4",
        "Professional Template 5 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุงุญุชุฑุงูู 5",
        "Professional Template 6 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุงุญุชุฑุงูู 6",
        "Professional Template 7 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุงุญุชุฑุงูู 7",
        "Professional Template 8 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุงุญุชุฑุงูู 8",
        "Professional Template 9 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุงุญุชุฑุงูู 9",
        "Professional Template 10 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุงุญุชุฑุงูู 10",
        "Professional Template 11 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุงุญุชุฑุงูู 11",
        "Professional Template 12 Preview": "ูุนุงููุฉ ุงููููุฐุฌ ุงูุงุญุชุฑุงูู 12",
        "AST Supported Templates": "ููุงุฐุฌ ุฏุงุนูุฉ ูุฃูุธูุฉ AST",
        "AST Template 1 Preview": "ูุนุงููุฉ ูููุฐุฌ AST 1",
        "AST Template 2 Preview": "ูุนุงููุฉ ูููุฐุฌ AST 2",
        "AST Template 3 Preview": "ูุนุงููุฉ ูููุฐุฌ AST 3",
        "AST Template 4 Preview": "ูุนุงููุฉ ูููุฐุฌ AST 4",
        "AST Template 5 Preview": "ูุนุงููุฉ ูููุฐุฌ AST 5",
        "AST Template 6 Preview": "ูุนุงููุฉ ูููุฐุฌ AST 6",
        "AST Template 7 Preview": "ูุนุงููุฉ ูููุฐุฌ AST 7",
        "AST Template 8 Preview": "ูุนุงููุฉ ูููุฐุฌ AST 8",
        "AST Template 9 Preview": "ูุนุงููุฉ ูููุฐุฌ AST 9",
        "AST Template 10 Preview": "ูุนุงููุฉ ูููุฐุฌ AST 10",
        "AST Template 11 Preview": "ูุนุงููุฉ ูููุฐุฌ AST 11",
        "AST Template 12 Preview": "ูุนุงููุฉ ูููุฐุฌ AST 12",
        "Back to Data Entry": "ุงูุนูุฏุฉ ูุฅุฏุฎุงู ุงูุจูุงูุงุช",
        "Next: Preview CV": "ุงูุชุงูู: ูุนุงููุฉ ุงูุณูุฑุฉ",
        "Your CV Preview": "ูุนุงููุฉ ุณูุฑุชู ุงูุฐุงุชูุฉ",
        "Download PDF (Direct)": "ุชูุฒูู PDF (ูุนุงููุฉ)",
        "Request Download / Print": "ุทูุจ ุชูุฒูู / ุทุจุงุนุฉ",
        "Back to Templates": "ุงูุนูุฏุฉ ููููุงุฐุฌ",
        "choose-payment": "ุงุฎุชุฑ ูุณููุฉ ุงูุฏูุน",
        "Enter discount code (if any)": "ุฃุฏุฎู ููุฏ ุงูุฎุตู (ุฅู ูุฌุฏ)",
        "Apply Discount": "ุชุทุจูู ุงูุฎุตู",
        "messages": "ุงูุณุนุฑ",
        "payment": "ุงูุฏูุน",
        "payment-note": "ุจุนุฏ ุฅุชูุงู ุงูุฏูุน ูู ุชุทุจูู ุงูุจููุ ุงูุฑุฌุงุก ุชุนุจุฆุฉ ุงูุจูุงูุงุช ุงูุชุงููุฉ:",
        "your-name": "ุงุณูู:",
        "your-email": "ุจุฑูุฏู ุงูุฅููุชุฑููู:",
        "your-phone": "ุฑูู ุงููุงุชู:",
        "attachment": "ุฃุฑูู ุฅูุตุงู ุงูุฏูุน (ุตูุฑุฉ / PDF):",
        "submit": "ุฅุฑุณุงู",
        "Submitting...": "ุฌุงุฑู ุงูุฅุฑุณุงู...",
        "Back to Payment Options": "ุงูุนูุฏุฉ ูุฎูุงุฑุงุช ุงูุฏูุน",
        "terms-of-service-title": "ุดุฑูุท ุงูุฎุฏูุฉ",
        "terms-of-service-intro-p": "ูุฑุญุจุงู ุจูู ูู ูุธุงู ุฑุณุงุฆู ูุฅูุดุงุก ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ. ุจุงุณุชุฎุฏุงูู ูุฎุฏูุงุชูุงุ ูุฅูู ุชูุงูู ุนูู ุงูุงูุชุฒุงู ุจุงูุดุฑูุท ูุงูุฃุญูุงู ุงูุชุงููุฉุ ูุงูุชู ุชุดูู ุงุชูุงููุฉ ููุฒูุฉ ุจููู ูุจูู \"ุฑุณุงุฆู\". ูุฑุฌู ูุฑุงุกุชูุง ุจุนูุงูุฉ.",
        "terms-of-service-h4-1": "1. ุงุณุชุฎุฏุงู ุงูุฎุฏูุฉ",
        "terms-of-service-p-1-1": "ุชุชูุญ ูู ููุตุฉ ุฑุณุงุฆู ุฅูุดุงุก ูุชุตููู ุงูุณูุฑ ุงูุฐุงุชูุฉ ุงูุงุญุชุฑุงููุฉ ูุชุตุฏูุฑูุง ุจุตูุบุฉ PDF. ูุฌุจ ุฃู ุชููู ุฌููุน ุงูุจูุงูุงุช ูุงููุนูููุงุช ุงูุชู ุชูุฏููุง (ุจูุง ูู ุฐููุ ุนูู ุณุจูู ุงููุซุงู ูุง ุงูุญุตุฑุ ุงูุงุณูุ ุงูุฎุจุฑุงุชุ ุงููุคููุงุชุ ุงูููุงุฑุงุช) ุตุญูุญุฉ ูุฏูููุฉ ูุญุฏูุซุฉุ ูุชุชุญูู ุฃูุช ูุญุฏู ูุณุคูููุฉ ุงููุญุชูู ุงูุฎุงุต ุจู. ูุง ูุฌูุฒ ุงุณุชุฎุฏุงู ุงูุฎุฏูุฉ ูุฃู ุฃุบุฑุงุถ ุบูุฑ ูุงููููุฉ ุฃู ุงุญุชูุงููุฉ ุฃู ุชุดููุฑูุฉ ุฃู ุบูุฑ ูุตุฑุญ ุจูุง.",
        "terms-of-service-p-1-2": "ูุญุชูุธ ุจุงูุญู ูู ุชุนููู ุฃู ุฅููุงุก ูุตููู ุฅูู ุงูุฎุฏูุฉ ุฅุฐุง ุงูุชููุช ุฃูุงู ูู ูุฐู ุงูุดุฑูุทุ ุฃู ุฅุฐุง ุฑุฃููุง ุฃู ุณูููู ูุถุฑ ุจุงูุฎุฏูุฉ ุฃู ุงููุณุชุฎุฏููู ุงูุขุฎุฑูู.",
        "terms-of-service-h4-2": "2. ุงูููููุฉ ุงูููุฑูุฉ",
        "terms-of-service-p-2-1": "ุฌููุน ุงูุชุตูููุงุชุ ุงูููุงูุจุ ุงููุตูุตุ ุงูุฑุณููุงุชุ ุงูุดุนุงุฑุงุชุ ุงูุฃููููุงุชุ ุงูุตูุฑุ ุงูุจุฑูุฌูุงุชุ ูุฃู ูุญุชูู ุขุฎุฑ ูุชุงุญ ุนุจุฑ ุงูุฎุฏูุฉ (\"ูุญุชูู ุงูุฎุฏูุฉ\") ูู ููููุฉ ููุฑูุฉ ุฎุงุตุฉ ุจู \"ุฑุณุงุฆู\" ุฃู ูุฑุฎุตุฉ ููุงุ ููู ูุญููุฉ ุจููุฌุจ ููุงููู ุญููู ุงููุดุฑ ูุงูุนูุงูุงุช ุงูุชุฌุงุฑูุฉ ูุงูููููุฉ ุงูููุฑูุฉ ุงูุฃุฎุฑู. ุนูุฏ ุงุณุชุฎุฏุงูู ููุฎุฏูุฉุ ูุฅูู ุชุญุตู ุนูู ุชุฑุฎูุต ุดุฎุตูุ ุบูุฑ ุญุตุฑูุ ุบูุฑ ูุงุจู ููุชุญูููุ ููุงุจู ููุฅูุบุงุก ูุงุณุชุฎุฏุงู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ุงูุชู ุชูุดุฆูุง ูุฃุบุฑุงุถู ุงูุดุฎุตูุฉ ุฃู ุงูููููุฉ ููุท.",
        "terms-of-service-p-2-2": "ูุง ูุฌูุฒ ูู ุฅุนุงุฏุฉ ุจูุน ุฃู ุฅุนุงุฏุฉ ุฅูุชุงุฌ ุฃู ุชูุฒูุน ุฃู ุชุนุฏูู ุฃู ุฅูุดุงุก ุฃุนูุงู ูุดุชูุฉ ุฃู ุนุฑุถ ุนููู ุฃู ุฃุฏุงุก ุนููู ุฃู ูุดุฑ ุฃู ููู ุฃู ุงุณุชุบูุงู ุฃู ุฌุฒุก ูู ูุญุชูู ุงูุฎุฏูุฉ ุฃู ุงูุฎุฏูุฉ ููุณูุง ุฏูู ุฅุฐู ูุชุงุจู ูุณุจู ูู \"ุฑุณุงุฆู\".",
        "terms-of-service-h4-3": "3. ุงูุฏูุน ูุงูุฃุณุนุงุฑ",
        "terms-of-service-p-3-1": "ุชุชุทูุจ ุจุนุถ ุงูููุงูุจ ูุงูููุฒุงุช ุงููุชูุฏูุฉ ุฏูุน ุฑุณูู ูุญุฏุฏุฉ. ุชููู ุฌููุน ุงูุฃุณุนุงุฑ ููุถุญุฉ ุจูุถูุญ ูู ุตูุญุฉ ุงุฎุชูุงุฑ ุงูููุงูุจ ุฃู ุนูุฏ ุจุฏุงูุฉ ุนูููุฉ ุงูุฏูุน. ุชุญุชูุธ \"ุฑุณุงุฆู\" ุจุงูุญู ูู ุชุนุฏูู ุงูุฃุณุนุงุฑ ุฃู ูุฑุถ ุฑุณูู ุนูู ููุฒุงุช ุฌุฏูุฏุฉ ูู ุฃู ููุชุ ูุน ุฅุฎุทุงุฑ ูุณุจู ุจุฐูู. ุฌููุน ุงููุฏููุนุงุช ุชุชู ุนุจุฑ ุจูุงุจุงุช ุฏูุน ุฎุงุฑุฌูุฉ ุขููุฉ (ูุซู Lemon Squeezy). \"ุฑุณุงุฆู\" ูุง ุชููู ุจุชุฎุฒูู ูุนูููุงุช ุจุทุงูุฉ ุงูุฏูุน ุงูุฎุงุตุฉ ุจู.",
        "terms-of-service-p-3-2": "ุฌููุน ุงููุฏููุนุงุช ุบูุฑ ูุงุจูุฉ ููุงุณุชุฑุฏุงุฏ ุฅูุง ูู ุญุงูุงุช ูุญุฏุฏุฉ ููููุง ูุณูุงุณุฉ ุงูุงุณุชุฑุฏุงุฏ ุงูุฎุงุตุฉ ุจูุงุ ูุงูุชู ููููู ูุฑุงุฌุนุชูุง ูู ุงููุณู ุงููุฎุตุต ูุฐูู.",
        "terms-of-service-h4-4": "4. ุญุฏูุฏ ุงููุณุคูููุฉ",
        "terms-of-service-p-4-1": "ูุชู ุชูุฏูู ุงูุฎุฏูุฉ \"ููุง ูู\" ู \"ุญุณุจ ุชููุฑูุง\" ุฏูู ุฃู ุถูุงูุงุช ูู ุฃู ููุนุ ุตุฑูุญุฉ ุฃู ุถูููุฉ. ูุญู ูุง ูุถูู ุฏูุฉ ุฃู ุงูุชูุงู ุฃู ุตูุงุญูุฉ ุฃู ููุซูููุฉ ุฃู ุชููุฑ ุฃู ูุนูููุงุช ููุฏูุฉ ูู ูุจู ุงููุณุชุฎุฏููู ุฃู ุงููุชุงุฆุฌ ุงูุชู ูููู ุงูุญุตูู ุนูููุง ูู ุงุณุชุฎุฏุงู ุงูุฎุฏูุฉ.",
        "terms-of-service-p-4-2": "ูู ุชููู \"ุฑุณุงุฆู\" ูุณุคููุฉุ ุชุญุช ุฃู ุธุฑู ูู ุงูุธุฑููุ ุนู ุฃู ุฃุถุฑุงุฑ ูุจุงุดุฑุฉ ุฃู ุบูุฑ ูุจุงุดุฑุฉ ุฃู ุนุฑุถูุฉ ุฃู ุฎุงุตุฉ ุฃู ุชุจุนูุฉ ุฃู ุชุฃุฏูุจูุฉุ ุจูุง ูู ุฐููุ ุนูู ุณุจูู ุงููุซุงู ูุง ุงูุญุตุฑุ ุฎุณุงุฑุฉ ุงูุฃุฑุจุงุญุ ุงูุจูุงูุงุชุ ุฃู ุงูุงุณุชุฎุฏุงูุ ุชูุดุฃ ุนู ุงุณุชุฎุฏุงู ุฃู ุนุฏู ุงููุฏุฑุฉ ุนูู ุงุณุชุฎุฏุงู ุงูุฎุฏูุฉ.",
        "terms-of-service-h4-5": "5. ุงูุชุนุฏููุงุช ุนูู ุงูุดุฑูุท",
        "terms-of-service-p-5-1": "ูุญุชูุธ ุจุงูุญู ูู ุชุนุฏูู ุฃู ุชุญุฏูุซ ูุฐู ุงูุดุฑูุท ูุงูุฃุญูุงู ูู ุฃู ููุช ูุฏูู ุฅุดุนุงุฑ ูุณุจู. ุณูุชู ูุดุฑ ุฃู ุชุบููุฑุงุช ุนูู ูุฐู ุงูุตูุญุฉุ ููุนุชุจุฑ ุงุณุชูุฑุงุฑ ุงุณุชุฎุฏุงูู ููุฎุฏูุฉ ุจุนุฏ ูุดุฑ ุงูุชุนุฏููุงุช ุจูุซุงุจุฉ ููุงููุฉ ููู ุนูู ุงูุดุฑูุท ุงููุนุฏูุฉ. ูุฑุฌู ูุฑุงุฌุนุฉ ูุฐู ุงูุตูุญุฉ ุจุงูุชุธุงู ููุงุทูุงุน ุนูู ุฃู ุชุญุฏูุซุงุช.",
        "terms-of-service-h4-6": "6. ุงููุงููู ุงููุนููู ุจู",
        "terms-of-service-p-6-1": "ุชุฎุถุน ูุฐู ุงูุดุฑูุท ูุงูุฃุญูุงู ูุชูุณุฑ ููููุง ูููุงููู ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉุ ูุชูุงูู ุนูู ุงูุฎุถูุน ููุงุฎุชุตุงุต ุงููุถุงุฆู ุงูุญุตุฑู ููุญุงูู ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ ูุญู ุฃู ูุฒุงุนุงุช ุชูุดุฃ ุนู ูุฐู ุงูุดุฑูุท ุฃู ุงุณุชุฎุฏุงู ุงูุฎุฏูุฉ.",
        "terms-of-service-h4-7": "7. ุงูุงุชุตุงู ุจูุง",
        "terms-of-service-p-7-1": "ูุฃู ุฃุณุฆูุฉ ุฃู ุงุณุชูุณุงุฑุงุช ุจุฎุตูุต ุดุฑูุท ุงูุฎุฏูุฉุ ูุฑุฌู ุงูุงุชุตุงู ุจูุง ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู: <strong><a href=\"mailto:ramyheshamamer@gmail.com\">ramyheshamamer@gmail.com</a></strong>.",
        "back-to-home": "ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ",
        "terms-of-service-link": "ุดุฑูุท ุงูุฎุฏูุฉ",
        "refund-policy-link": "ุณูุงุณุฉ ุงูุงุณุชุฑุฏุงุฏ",
        "privacy-policy-link": "ุณูุงุณุฉ ุงูุฎุตูุตูุฉ",
        "refund-policy-title": "ุณูุงุณุฉ ุงูุงุณุชุฑุฏุงุฏ ูุงููุฒุงุนุงุช",
        "refund-policy-intro-p": "ูุญู ูู \"ุฑุณุงุฆู\" ูุณุนู ูุชูุฏูู ุฎุฏูุฉ ุนุงููุฉ ุงูุฌูุฏุฉ ูุถูุงู ุฑุถุง ุนููุงุฆูุง. ูุธุฑูุง ูุทุจูุนุฉ ููุชุฌุงุชูุง ุงูุฑูููุฉ (ุงูุณูุฑ ุงูุฐุงุชูุฉ ุงูุชู ูุชู ุฅูุดุงุคูุง ูุชูุฒูููุง ุจุตูุบุฉ PDF)ุ ูุฅู ุณูุงุณุชูุง ููุงุณุชุฑุฏุงุฏ ูุงููุฒุงุนุงุช ูุงูุชุงูู:",
        "refund-policy-h4-1": "1. ุงูููุชุฌุงุช ุงูุฑูููุฉ (ุงูุณูุฑ ุงูุฐุงุชูุฉ ุจุตูุบุฉ PDF)",
        "refund-policy-p-1-1": "ุจูุฌุฑุฏ ุฅุชูุงู ุนูููุฉ ุงูุฏูุน ููุฌุงุญ ุฅูุดุงุก ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ูุฅุฑุณุงููุง ุฅูู ุจุฑูุฏู ุงูุฅููุชุฑููู (ุฃู ุชูููุฑ ุฑุงุจุท ุงูุชูุฒูู)ุ ุชุนุชุจุฑ ุงูุฎุฏูุฉ ูุฏ ุงูุชููุช ุจุงููุงูู. ููุฐููุ ูุง ุชุชููุฑ ุนุงุฏุฉู ุนูููุงุช ุงุณุชุฑุฏุงุฏ ูููุจุงูุบ ุงููุฏููุนุฉ.",
        "refund-policy-h4-2": "2. ุญุงูุงุช ุงูุงุณุชุฑุฏุงุฏ ุงูุงุณุชุซูุงุฆูุฉ",
        "refund-policy-p-2-1": "ูุฏ ูุชู ุงููุธุฑ ูู ุทูุจุงุช ุงูุงุณุชุฑุฏุงุฏ ูู ุงูุญุงูุงุช ุงูุงุณุชุซูุงุฆูุฉ ุงูุชุงููุฉ ููุท:",
        "refund-policy-list-1": [
            "<strong>ูุดููุฉ ูููุฉ ุฌููุฑูุฉ:</strong> ุฅุฐุง ูุงุฌูุช ูุดููุฉ ูููุฉ ูู ูุธุงููุง ููุนุชู ูู ุฅูุดุงุก ุฃู ุชูุฒูู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ุจุดูู ูุงููุ ููู ูุชููู ูุฑูู ุงูุฏุนู ูู ุญู ุงููุดููุฉ ูู ุบุถูู ูุชุฑุฉ ุฒูููุฉ ูุนูููุฉ.",
            "<strong>ุฎุทุฃ ูุงุฏุญ ูู ุงูููุชุฌ:</strong> ุฅุฐุง ูุงูุช ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ุงูุชู ุชู ุฅูุดุงุคูุง ุชุญุชูู ุนูู ุฃุฎุทุงุก ูุงุฏุญุฉ ูุงุชุฌุฉ ุนู ุฎูู ูู ูุธุงููุง (ูููุณ ุจุณุจุจ ุฃุฎุทุงุก ูู ุงูุจูุงูุงุช ุงููุฏุฎูุฉ ูู ูุจูู)ุ ููู ูุชููู ูู ุชุตุญูุญูุง.",
            "<strong>ุงูุฏูุน ุงูููุฑุฑ:</strong> ุฅุฐุง ููุช ุจุงูุฏูุน ูููุณ ุงูุฎุฏูุฉ ุนู ุทุฑูู ุงูุฎุทุฃ ุฃูุซุฑ ูู ูุฑุฉ."
        ],
        "refund-policy-h4-3": "3. ุนูููุฉ ุทูุจ ุงูุงุณุชุฑุฏุงุฏ",
        "refund-policy-p-3-1": "ูุชูุฏูู ุทูุจ ุงุณุชุฑุฏุงุฏุ ูุฑุฌู ุงูุงุชุตุงู ุจูุฑูู ุงูุฏุนู ูุฏููุง ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู <a href=\"mailto:ramyheshamamer@gmail.com\">ramyheshamamer@gmail.com</a> ูู ุบุถูู 7 ุฃูุงู ูู ุชุงุฑูุฎ ุงูุดุฑุงุก. ูุฌุจ ุฃู ูุชุถูู ุทูุจู ุงูุชูุงุตูู ุงูุชุงููุฉ:",
        "refund-policy-list-2": [
            "ุงุณูู ุงููุงูู ูุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุงููุณุชุฎุฏู ูู ุงูุดุฑุงุก.",
            "ุชุงุฑูุฎ ูุฑูู ุงููุนุงููุฉ (ุฅู ูุฌุฏ).",
            "ูุตู ููุตู ูููุดููุฉ ุงูุชู ูุงุฌูุชูุง ูุงูุฃุณุจุงุจ ุงูุชู ุชุฏูุนู ูุทูุจ ุงูุงุณุชุฑุฏุงุฏ.",
            "ุฃู ููุทุงุช ุดุงุดุฉ ุฃู ูุณุชูุฏุงุช ุชุฏุนู ุทูุจู."
        ],
        "refund-policy-h4-4": "4. ูุฑุงุฌุนุฉ ุงูุทูุจุงุช",
        "refund-policy-p-4-1": "ุณูููู ุจูุฑุงุฌุนุฉ ุฌููุน ุทูุจุงุช ุงูุงุณุชุฑุฏุงุฏ ุจุนูุงูุฉ. ุณูุชู ุฅุฎุทุงุฑู ุจุงููุฑุงุฑ ูู ุบุถูู 5 ุฃูุงู ุนูู ูู ุงุณุชูุงู ุทูุจู. ุฅุฐุง ุชูุช ุงูููุงููุฉ ุนูู ุงูุงุณุชุฑุฏุงุฏุ ูุณูุชู ูุนุงูุฌุฉ ุงููุจูุบ ุฅูู ุทุฑููุฉ ุงูุฏูุน ุงูุฃุตููุฉ ุฎูุงู 7-14 ููู ุนููุ ุงุนุชูุงุฏูุง ุนูู ุณูุงุณุงุช ูุนุงูุฌ ุงูุฏูุน ุงูุฎุงุต ุจู.",
        "refund-policy-h4-5": "5. ุญู ุงููุฒุงุนุงุช",
        "refund-policy-p-5-1": "ูุญู ูุดุฌุนู ุนูู ุงูุงุชุตุงู ุจูุง ูุจุงุดุฑุฉ ูู ุญุงู ูุฌูุฏ ุฃู ูุดุงูู ุฃู ูุฒุงุนุงุช ูุจู ุงููุฌูุก ุฅูู ูุนุงูุฌ ุงูุฏูุน ุฃู ุงูุจูู. ูุณุนู ูุญู ุฌููุน ุงููุดููุงุช ุจุดูู ูุฏู ูุนุงุฏู ูุถูุงู ุฑุถุง ุนููุงุฆูุง.",
        "privacy-policy-title": "ุณูุงุณุฉ ุงูุฎุตูุตูุฉ",
        "privacy-policy-intro-p": "ูุญู ูู \"ุฑุณุงุฆู\" ููุชุฒู ุจุญูุงูุฉ ุฎุตูุตูุฉ ุจูุงูุงุชู ุงูุดุฎุตูุฉ. ุชูุถุญ ูุฐู ุงูุณูุงุณุฉ ููู ูุฌูุนุ ูุณุชุฎุฏูุ ูุญููุ ููุฏูุฑ ุงููุนูููุงุช ุงูุชู ุชูุฏููุง ููุง ุนูุฏ ุงุณุชุฎุฏุงู ุฎุฏูุงุชูุง ูุฅูุดุงุก ุงูุณูุฑ ุงูุฐุงุชูุฉ.",
        "privacy-policy-h4-1": "1. ุงููุนูููุงุช ุงูุชู ูุฌูุนูุง",
        "privacy-policy-list-1": [
            "<strong>ูุนูููุงุช ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ:</strong> ูููู ุจุฌูุน ุงููุนูููุงุช ุงูุชู ุชุฏุฎููุง ูุจุงุดุฑุฉ ูู ููุงุฐุฌ ุฅูุดุงุก ุงูุณูุฑุฉ ุงูุฐุงุชูุฉุ ูุซู ุงุณูู ุงููุงููุ ุงููุณูู ุงููุธูููุ ุนููุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑูููุ ุฑูู ุงููุงุชูุ ุงููููุน ุงูุดุฎุตู/ุงููุญูุธุฉุ ุงููุฏู ุงููุธูููุ ุชูุงุตูู ุงูุฎุจุฑุฉ ุงูุนูููุฉุ ุงููุคููุงุช ุงูุนูููุฉุ ุงูููุงุฑุงุชุ ุงููุบุงุชุ ูุงููุฑุงุฌุน. ุฅุฐุง ููุช ุจุชุญููู ุตูุฑุฉ ุดุฎุตูุฉุ ูุฅููุง ูููู ุจุฌูุนูุง ุฃูุถุงู.",
            "<strong>ูุนูููุงุช ุงูุงุชุตุงู ูุงูุฏูุน:</strong> ุนูุฏ ุฅุฌุฑุงุก ุนูููุฉ ุดุฑุงุกุ ูุฌูุน ุงุณููุ ุจุฑูุฏู ุงูุฅููุชุฑูููุ ูุฑูู ูุงุชูู. ุชูุงุตูู ุงูุฏูุน (ูุซู ุฃุฑูุงู ุงูุจุทุงูุงุช ุงูุงุฆุชูุงููุฉ) ูุชู ูุนุงูุฌุชูุง ูุจุงุดุฑุฉ ุจูุงุณุทุฉ ุจูุงุจุงุช ุฏูุน ุฎุงุฑุฌูุฉ ุขููุฉ (ูุซู Lemon Squeezy/Stripe)ุ ููุญู ูุง ูููู ุจุชุฎุฒูู ูุฐู ุงููุนูููุงุช ุงูุญุณุงุณุฉ ุนูู ุฎูุงุฏููุง.",
            "<strong>ุจูุงูุงุช ุงูุงุณุชุฎุฏุงู:</strong> ูุฏ ูุฌูุน ูุนูููุงุช ุญูู ููููุฉ ูุตููู ูุงุณุชุฎุฏุงูู ูุฎุฏูุชูุงุ ูุซู ุนููุงู IPุ ููุน ุงููุชุตูุญุ ุงูุตูุญุงุช ุงูุชู ุฒุฑุชูุงุ ูุงูููุช ุงููุณุชุบุฑู ูู ูู ุตูุญุฉ. ูุฐู ุงูุจูุงูุงุช ุชูุณุชุฎุฏู ูุชุญุณูู ุงูุฎุฏูุฉ ููุง ุชุฑุชุจุท ุจุดูู ูุจุงุดุฑ ุจูุนูููุงุชู ุงูุดุฎุตูุฉ."
        ],
        "privacy-policy-h4-2": "2. ููู ูุณุชุฎุฏู ูุนูููุงุชู",
        "privacy-policy-p-2-1": "ูุณุชุฎุฏู ุงููุนูููุงุช ุงูุชู ูุฌูุนูุง ููุฃุบุฑุงุถ ุงูุชุงููุฉ:",
        "privacy-policy-list-2": [
            "ูุชูุฏูู ุฎุฏูุฉ ุฅูุดุงุก ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ูุชุฎุตูุตูุง ูู.",
            "ููุนุงูุฌุฉ ูุนุงููุงุช ุงูุฏูุน ุงูุฎุงุตุฉ ุจู ูุชุฒููุฏู ุจุงูููุชุฌ ุงูููุงุฆู (ููู PDF ููุณูุฑุฉ ุงูุฐุงุชูุฉ).",
            "ูุชุญุณูู ูุชุทููุฑ ุฎุฏูุงุชูุง ูููุฒุงุชูุง.",
            "ููุชูุงุตู ูุนู ุจุฎุตูุต ุงุณุชุฎุฏุงูู ููุฎุฏูุฉุ ุฃู ูุฃุบุฑุงุถ ุงูุฏุนู ุงููููุ ุฃู ูุฅุฑุณุงู ุชุญุฏูุซุงุช ูููุฉ.",
            "ูุถูุงู ุงูุงูุชุซุงู ูููุชุทูุจุงุช ุงููุงููููุฉ ูุงูุชูุธูููุฉ."
        ],
        "privacy-policy-h4-3": "3. ูุดุงุฑูุฉ ุงููุนูููุงุช",
        "privacy-policy-p-3-1": "ูุญู ูุง ูุจูุนุ ูุคุฌุฑุ ุฃู ูุชุจุงุฏู ูุนูููุงุชู ุงูุดุฎุตูุฉ ูุน ุฃุทุฑุงู ุซุงูุซุฉ ูุฃุบุฑุงุถ ุงูุชุณููู. ูุฏ ูุดุงุฑู ูุนูููุงุชู ูุน:",
        "privacy-policy-list-3": [
            "<strong>ููุฏูู ุงูุฎุฏูุงุช ุงูุฎุงุฑุฌููู:</strong> ูุซู ุจูุงุจุงุช ุงูุฏูุน (Lemon Squeezy/Stripe) ููุนุงูุฌู ุงูุจุฑูุฏ ุงูุฅููุชุฑูููุ ูุฐูู ุจุงููุฏุฑ ุงููุงุฒู ูุชูุฏูู ุฎุฏูุงุชูุง. ูุคูุงุก ุงูููุฏููู ููุฒููู ุจุงูุญูุงุธ ุนูู ุณุฑูุฉ ูุนูููุงุชู.",
            "<strong>ุงูุงูุชุซุงู ุงููุงูููู:</strong> ูุฏ ููุดู ุนู ูุนูููุงุชู ุฅุฐุง ูุงู ุฐูู ูุทููุจูุง ุจููุฌุจ ุงููุงููู ุฃู ุฃูุฑ ูุถุงุฆูุ ุฃู ูุญูุงูุฉ ุญููููุง ููุตุงูุญูุง ุฃู ุญููู ุงููุณุชุฎุฏููู ุงูุขุฎุฑูู."
        ],
        "privacy-policy-h4-4": "4. ุฃูุงู ุงูุจูุงูุงุช",
        "privacy-policy-p-4-1": "ูุญู ูุชุฎุฐ ุฅุฌุฑุงุกุงุช ุฃูููุฉ ูุนูููุฉ ูููุงุณุจุฉ ูุญูุงูุฉ ูุนูููุงุชู ุงูุดุฎุตูุฉ ูู ุงููุตูู ุบูุฑ ุงููุตุฑุญ ุจูุ ุฃู ุงูุชุบููุฑุ ุฃู ุงููุดูุ ุฃู ุงูุชุฏููุฑ. ููุน ุฐููุ ูุฌุจ ุฃู ุชุฏุฑู ุฃูู ูุง ููุฌุฏ ูุธุงู ููู ุจูุงูุงุช ุนุจุฑ ุงูุฅูุชุฑูุช ุฃู ุชุฎุฒูู ุฅููุชุฑููู ุขูู 100%.",
        "privacy-policy-h4-5": "5. ุญูููู",
        "privacy-policy-p-5-1": "ูุญู ูู ุงููุตูู ุฅูู ุจูุงูุงุชู ุงูุดุฎุตูุฉ ุงูุชู ูุญุชูุธ ุจูุงุ ูุทูุจ ุชุตุญูุญ ุฃู ูุนูููุงุช ุบูุฑ ุฏูููุฉุ ุฃู ุทูุจ ุญุฐู ุจูุงูุงุชู. ูููุงุฑุณุฉ ูุฐู ุงูุญูููุ ูุฑุฌู ุงูุงุชุตุงู ุจูุง ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุงููุฐููุฑ ุฃุฏูุงู.",
        "privacy-policy-h4-6": "6. ุงูุชุนุฏููุงุช ุนูู ุณูุงุณุฉ ุงูุฎุตูุตูุฉ",
        "privacy-policy-p-6-1": "ูุญุชูุธ ุจุงูุญู ูู ุชุนุฏูู ุฃู ุชุญุฏูุซ ุณูุงุณุฉ ุงูุฎุตูุตูุฉ ูุฐู ูู ููุช ูุขุฎุฑ. ุณูุชู ูุดุฑ ุฃู ุชุบููุฑุงุช ุนูู ูุฐู ุงูุตูุญุฉุ ููุนุชุจุฑ ุงุณุชูุฑุงุฑู ูู ุงุณุชุฎุฏุงู ุงูุฎุฏูุฉ ุจุนุฏ ูุดุฑ ุงูุชุนุฏููุงุช ุจูุซุงุจุฉ ููุงููุฉ ููู ุนูู ุงูุณูุงุณุฉ ุงููุนุฏูุฉ.",
        "privacy-policy-h4-7": "7. ุงูุงุชุตุงู ุจูุง",
        "privacy-policy-p-7-1": "ูุฃู ุฃุณุฆูุฉ ุฃู ุงุณุชูุณุงุฑุงุช ุจุฎุตูุต ุณูุงุณุฉ ุงูุฎุตูุตูุฉุ ูุฑุฌู ุงูุงุชุตุงู ุจูุง ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู: <strong><a href=\"mailto:ramyheshamamer@gmail.com\">ramyheshamamer@gmail.com</a></strong>."
    },
    "en": {
        "image-paths": { // ูุฐุง ูู ุงูุฌุฒุก ุงูุฎุงุต ุจูุณุงุฑุงุช ุงูุตูุฑ
            "normal": (id) => `CV templates_en/${id}.webp`,
            "standard": (id) => `CV templates_en/${id}.webp`,
            "professional": (id) => `CV templates_en/${id}.webp`,
            "ast": (id) => `CV templates_en/${id}.webp`
        },
        // ุชุฑุฌูุงุช ุตูุญุฉ ุงูุฏูุน (ุงูุฅูุฌููุฒูุฉ - ูุน ุงูุนููุฉ ุจุงูุฏููุงุฑ)
        "local-payment-title": "Local Payment",
        "local-payment-desc": "(via STC Pay or Al Rajhi Transfer)", // ูุฐุง ููุชุงุญ ุฌุฏูุฏ ุชู ุฅุถุงูุชู
        "sar-currency": "SAR", 
        "click-to-pay": "Choose your preferred method:",
        "international-payment-header": "International & Secure",
        "card-payment-title": "Credit Card Payment",
        "click-to-pay-ls": "Click for secure payment:",
        "pay-with-card": "Pay Now",
        "select_font_label": "Select CV Font:",
        "add_custom_section_btn": "Add Custom Section",
        // ุชุฑุฌูุงุช ุฑุณุงุฆู ุงูุชูุจูู/ุงูุฃุฎุทุงุก (ุงูุฅูุฌููุฒูุฉ)
        "Please fill in all fields.": "Please fill in all required fields.",
        "Please enter a valid email.": "Please enter a valid email address.",
        "File size exceeds the limit (3MB).": "File size exceeds the 3MB limit.",
        "Please attach only image or PDF files.": "Please attach only image or PDF files.",
        "An error occurred while preparing your payment. Please try again or contact support.": "An error occurred while preparing your payment. Please try again or contact support.",
        "Error, price for this category is undefined.": "Error, price for this category is undefined.",
        "Please select a valid image file.": "Please select a valid image file.",
        "Image size is too large. Please select an image smaller than {size} megabytes.": "Image size is too large. Please select an image smaller than {size} megabytes.",
        "You must have at least one field in this section.": "You must have at least one field in this section.",
        "payment-success": "Your request has been successfully received! The CV will be sent to your email shortly.",
        "Error processing file.": "Error processing file.",
        //ูุณู ุงูููุงุฑุงุช
        "Enter a skill": "Enter a skill",
        "Select Level": "Select Level",
        "Beginner": "Beginner",
        "Intermediate": "Intermediate",
        "Advanced": "Advanced",
        "Expert": "Expert",
        
        "accordion_image_controls": "๐ผ๏ธ Profile Picture Controls",
        "image_size_label": "Image Size",
        "image_radius_label": "Frame Shape (Radius)",
        "accordion_font_controls": "โ๏ธ Font Controls",
        "accordion_size_controls": "๐ Text Size Controls",
        "name_size_label": "Name Size",
        "title_size_label": "Job Title Size",
        "contact_size_label": "Contact Info Size",
        "section_title_size_label": "Section Titles Size",
        "subsection_title_size_label": "Subsection Titles Size",
        "body_text_size_label": "Body Text Size",
        "accordion_color_controls": "๐จ Color Controls",
        "select_name_font_label": "Main Name Font:",
        "select_headings_font_label": "Headings Font:",
        "select_body_font_label": "Body Text Font:",

        // --- Color Picker Translations ---
        "color_presets_titl": "Choose a color template",
        "color_customization_title":"Customize Template Colors",
        "background_colors_title": "Background Colors",
        "primary_bg_label": "Primary BG / Header",
        "sidebar_bg_label": "Sidebar BG",
        "accent_bg_label": "Accent / Skills BG",
        "gradient_label": "Gradient",
        "text_colors_title": "Text & Icon Colors",
        "header_text_label": "Header Text",
        "title_text_label": "Titles Text",
        "body_text_label": "Body Text",
        "subtle_text_label": "Subtle Text",
        "gradient_horizontal": "Horizontal",
        "gradient_vertical": "Vertical",
        "gradient_diagonal": "Diagonal",

        // ุงูุชุฑุฌูุงุช ุงูุนุงูุฉ ุงููุชุจููุฉ ูู ุงูููู ุงูุฃุตูู
        "promo_bar_text": "Special Offer! Use code <span class='blinking-code'>FIRSTBUY</span> for 25% off or <span class='blinking-code'>SAVE10</span> for 10% off!",
        "from-city": "from",
        "notification-action": "just created their CV!",
        "CV downloaded successfully!": "CV downloaded successfully!",
        "Professional CV Builder": "Professional CV Builder",
        "brand-name": "Resail",
        "home-link": "Home",
        "features-link": "Features",
        "products-link": "Products",
        "product-basic": "WhatsApp Sender",
        "product-cv": "CV Builder",
        "about-link": "About Us",
        "contact-link": "Contact Us",
        "English": "ุงูุนุฑุจูุฉ", // ูุฐุง ูู ุงููุต ุงูุฐู ูุธูุฑ ููุชุจุฏูู ููุนุฑุจูุฉ
        "Professional CV Builder_header": "Build Your Professional CV Easily",
        "Create a professional CV that stands out and gets you hired.": "Showcase your skills and experience with a professional design that grabs attention and opens doors to opportunities.",
        "Create Your CV Now": "Create Your CV Now",
        "loading-cv-text": "Generating CV, please wait...",
        "Why Resail CV Builder?": "Why Resail CV Builder?",
        "Easy Data Entry": "Easy Data Entry",
        "Intuitive forms to quickly fill in all your information.": "Intuitive and easy forms to quickly fill in all your information.",
        "Diverse and Professional Templates": "Diverse and Professional Templates",
        "Choose from many modern and attractive designs to suit your style.": "Choose from many modern and attractive designs to suit your taste and field.",
        "Arabic and English Support": "Full Arabic and English Support",
        "Create your CV in either Arabic or English with proper formatting.": "Create your CV in your preferred language, ensuring correct formatting for both directions.",
        "Instant Preview": "Instant Preview",
        "See your CV instantly as you build it, ensuring it looks perfect.": "See your CV instantly as you enter data or choose a template to ensure the perfect look.",
        "Professional PDF Export": "Professional PDF Export",
        "Download your completed CV as a high-quality PDF file, ready to share.": "Get your final CV as a professional PDF file, ready for printing or sharing online.",
        "Flexible Payment Options": "Flexible and Secure Payment Options",
        "Pay easily using various methods including PayPal and local options.": "Multiple payment methods including PayPal and local options to facilitate the process of getting your CV.",
        "Customer Testimonials": "What Our Customers Say?",
        "โCreating my CV was incredibly easy and fast. The templates are modern and professional. Highly recommended!โ": "โCreating my CV was incredibly easy and fast. The templates are modern and professional. Highly recommended!โ",
        "- Sarah Ahmed": "- Sarah Ahmed",
        "โI loved the variety of templates and the instant preview feature. It helped me choose the perfect design for my application.โ": "โI loved the variety of templates and the instant preview feature. It helped me choose the perfect design for my application.โ",
        "- Khalid Hassan": "- Khalid Hassan",
        "About Resail CV Builder": "About Resail CV Builder",
        "Resail is your go-to platform for effortlessly creating professional and impactful CVs. We provide a wide range of modern templates and intuitive tools to help you stand out in the job market with a high-quality PDF resume.": "Resail is your comprehensive system for easily creating professional and impactful CVs. We offer a wide range of modern templates and intuitive tools to help you stand out in the job market with a high-quality PDF resume.",
        "Our service focuses on simplifying the CV creation process, offering diverse templates, and ensuring full support for both Arabic and English languages with accurate formatting. Download your ready-to-share PDF CV after a seamless payment process.": "Our service focuses on simplifying the CV creation process, offering diverse templates, and ensuring full support for both Arabic and English languages with accurate formatting. Get your PDF CV ready to share after a seamless payment process.",
        "CVs Generated So Far": "CVs Generated So Far",
        "+ูฅููู": "5000+",
        "Join thousands who have successfully created their professional CVs.": "Join thousands who have successfully created their professional CVs.",
        "Frequently Asked Questions": "Frequently Asked Questions",
        "How do I create a CV?": "How do I create a CV?",
        "Simply click on 'Create Your CV Now', fill in your details in the form, choose a template, and preview your CV.": "Simply click on 'Create Your CV Now', fill in your details in the form, choose a template, and preview your CV.",
        "Are the templates free?": "Are the templates free?",
        "We offer a variety of free and premium templates. Premium templates require a small fee for download.": "We offer a variety of free and premium templates. Premium templates require a small fee for download or printing.",
        "How do I download my CV?": "How do I download my CV?",
        "After previewing your CV, click on 'Request Download / Print'. You will be guided through the payment process if you selected a premium template, and then you can download the PDF.": "After previewing your CV and choosing the template, click on 'Request Download / Print'. You will be guided through the payment process if you selected a premium template, and then you can download the PDF file.",
        "Contact Us": "Contact Us",
        "For inquiries or support, please contact us via email: ramyheshamamer@gmail.com": "For inquiries or support, please contact us via email: <strong><a href=\"mailto:ramyheshamamer@gmail.com\">ramyheshamamer@gmail.com</a></strong>",
        "Enter Your Information": "Enter Your Information",
        "Full Name": "Full Name",
        "Enter your name": "Enter your name",
        "Job Title": "Job Title",
        "Enter your job title": "Enter your job title",
        "Email Address": "Email Address",
        "Enter your email address": "Enter your email address",
        "Phone Number": "Phone Number",
        "Enter your phone number": "Enter your phone number",
        "Website / Portfolio": "Website / Portfolio",
        "Enter your website or portfolio URL": "Enter your website or portfolio URL",
        "Profile Picture": "Profile Picture",
        "Choose a picture to enhance the look of your CV in some templates.": "Choose a picture to enhance the look of your CV in some templates.",
        "Career Objective": "Career Objective",
        "Enter your career objective": "Enter your career objective",
        "Work Experience": "Work Experience",
        "Add Experience": "Add Experience",
        "Remove Last": "Remove Last",
        "Job Title_placeholder": "Job Title",
        "Company": "Company",
        "Duration": "Duration",
        "Description": "Description",
        "Education": "Education",
        "Add Education": "Add Education",
        "Degree": "Degree",
        "University/Institution": "University/Institution",
        "custome-section": "ูAdd Custome Section",
        "custom_section_placeholder": "New Section Title (e.g., Projects or Courses)",
        "add_subsection_btn": '<i class="fas fa-plus"></i> Add Sub-heading',
        "remove_subsection_title": "Remove Sub-heading",
        "subsection_title_placeholder": "Sub-heading (e.g., PMP Certificate)",
        "subsection_desc_placeholder": "Description or details related to the sub-heading...",
        "remove_section_btn": "Delete Entire Section",
        "confirm_delete_section": "Are you sure you want to delete this entire section?",
        "Skills": "Skills ",
        "Add Skill": "Add Skill",
        "Enter a skill": "Enter a skill",
        "Languages": "Languages",
        "Add Language": "Add Language",
        "Enter a language": "Enter a language",
        "References": "References",
        "Add Reference": "Add Reference",
        "Name": "Name",
        "Position": "Position",
        "Phone": "Phone",
        "Email": "Email",
        "Data Completion Progress": "Data Completion Progress",
        "Back to Home": "Back to Home",
        "Next: Choose Template": "Next: Choose Template",
        "Choose a CV Template and Preview": "Choose a CV Template and Preview",
        "Normal Templates (Full Width)": "Normal Templates (Full Width)",
        "Normal Template 1 Preview": "Normal Template 1 Preview",
        "Normal Template 2 Preview": "Normal Template 2 Preview",
        "Normal Template 3 Preview": "Normal Template 3 Preview",
        "Normal Template 4 Preview": "Normal Template 4 Preview",
        "Normal Template 5 Preview": "Normal Template 5 Preview",
        "Normal Template 6 Preview": "Normal Template 6 Preview",
        "Normal Template 7 Preview": "Normal Template 7 Preview",
        "Normal Template 8 Preview": "Normal Template 8 Preview",
        "Normal Template 9 Preview": "Normal Template 9 Preview",
        "Normal Template 10 Preview": "Normal Template 10 Preview",
        "Normal Template 11 Preview": "Normal Template 11 Preview",
        "Normal Template 12 Preview": "Normal Template 12 Preview",
        "Standard Templates (Sidebar)": "Standard Templates (Sidebar)",
        "Standard Template 1 Preview": "Standard Template 1 Preview",
        "Standard Template 2 Preview": "Standard Template 2 Preview",
        "Standard Template 3 Preview": "Standard Template 3 Preview",
        "Standard Template 4 Preview": "Standard Template 4 Preview",
        "Standard Template 5 Preview": "Standard Template 5 Preview",
        "Standard Template 6 Preview": "Standard Template 6 Preview",
        "Standard Template 7 Preview": "Standard Template 7 Preview",
        "Standard Template 8 Preview": "Standard Template 8 Preview",
        "Standard Template 9 Preview": "Standard Template 9 Preview",
        "Standard Template 10 Preview": "Standard Template 10 Preview",
        "Standard Template 11 Preview": "Standard Template 11 Preview",
        "Standard Template 12 Preview": "Standard Template 12 Preview",
        "Professional Templates (Header + Sidebar)": "Professional Templates (Header + Sidebar)",
        "Professional Template 1 Preview": "Professional Template 1 Preview",
        "Professional Template 2 Preview": "Professional Template 2 Preview",
        "Professional Template 3 Preview": "Professional Template 3 Preview",
        "Professional Template 4 Preview": "Professional Template 4 Preview",
        "Professional Template 5 Preview": "Professional Template 5 Preview",
        "Professional Template 6 Preview": "Professional Template 6 Preview",
        "Professional Template 7 Preview": "Professional Template 7 Preview",
        "Professional Template 8 Preview": "Professional Template 8 Preview",
        "Professional Template 9 Preview": "Professional Template 9 Preview",
        "Professional Template 10 Preview": "Professional Template 10 Preview",
        "Professional Template 11 Preview": "Professional Template 11 Preview",
        "Professional Template 12 Preview": "Professional Template 12 Preview",
        "AST Supported Templates": "AST Supported Templates",
        "AST Template 1 Preview": "AST Template 1 Preview",
        "AST Template 2 Preview": "AST Template 2 Preview",
        "AST Template 3 Preview": "AST Template 3 Preview",
        "AST Template 4 Preview": "AST Template 4 Preview",
        "AST Template 5 Preview": "AST Template 5 Preview",
        "AST Template 6 Preview": "AST Template 6 Preview",
        "AST Template 7 Preview": "AST Template 7 Preview",
        "AST Template 8 Preview": "AST Template 8 Preview",
        "AST Template 9 Preview": "AST Template 9 Preview",
        "AST Template 10 Preview": "AST Template 10 Preview",
        "AST Template 11 Preview": "AST Template 11 Preview",
        "AST Template 12 Preview": "AST Template 12 Preview",
        "Back to Data Entry": "Back to Data Entry",
        "Next: Preview CV": "Next: Preview CV",
        "Your CV Preview": "Your CV Preview",
        "Download PDF (Direct)": "Download PDF (Preview)",
        "Request Download / Print": "Request Download / Print",
        "Back to Templates": "Back to Templates",
        "choose-payment": "Choose Payment Method",
        "Enter discount code (if any)": "Enter discount code (if any)",
        "Apply Discount": "Apply Discount",
        "messages": "Price",
        "payment": "Payment",
        "payment-note": "After completing the payment in the banking application, please fill in the following details:",
        "your-name": "Your Name:",
        "your-email": "Your Email:",
        "your-phone": "Phone Number:",
        "attachment": "Attach payment receipt (image / PDF):",
        "submit": "Submit",
        "Submitting...": "Submitting...",
        "Back to Payment Options": "Back to Payment Options",
        "terms-of-service-link": "Terms of Service",
        "refund-policy-link": "Refund Policy",
        "privacy-policy-link": "privacy policy",
        "terms-of-service-title": "Terms of Service",
        "terms-of-service-intro-p": "Welcome to the Resail CV Builder system. By using our services, you agree to abide by the following terms and conditions, which constitute a binding agreement between you and \"Resail\". Please read them carefully.",
        "terms-of-service-h4-1": "1. Service Use",
        "terms-of-service-p-1-1": "Resail platform allows you to create and design professional CVs and export them as PDF. All data and information you provide (including, but not limited to, name, experience, qualifications, skills) must be accurate, complete, and up-to-date, and you are solely responsible for your content. The service may not be used for any illegal, fraudulent, defamatory, or unauthorized purposes.",
        "terms-of-service-p-1-2": "We reserve the right to suspend or terminate your access to the service if you violate any of these terms, or if we deem your conduct harmful to the service or other users.",
        "terms-of-service-h4-2": "2. Intellectual Property",
        "terms-of-service-p-2-1": "All designs, templates, texts, graphics, logos, icons, images, software, and any other content available through the service (\"Service Content\") are the intellectual property of \"Resail\" or licensed to us, and are protected by copyright, trademark, and other intellectual property laws. By using the service, you obtain a personal, non-exclusive, non-transferable, and revocable license to use the CV you create for your personal or professional purposes only.",
        "terms-of-service-p-2-2": "You may not resell, reproduce, distribute, modify, create derivative works from, publicly display, publicly perform, publish, transmit, or exploit any part of the Service Content or the service itself without prior written permission from \"Resail\".",
        "terms-of-service-h4-3": "3. Payment and Pricing",
        "terms-of-service-p-3-1": "Some templates and advanced features require specific fees. All prices are clearly displayed on the template selection page or at the start of the payment process. \"Resail\" reserves the right to modify prices or impose fees for new features at any time, with prior notice. All payments are made through secure external payment gateways (such as Lemon Squeezy). \"Resail\" does not store your payment card information.",
        "terms-of-service-p-3-2": "All payments are non-refundable except in specific cases according to our refund policy, which you can review in the dedicated section.",
        "terms-of-service-h4-4": "4. Limitation of Liability",
        "terms-of-service-p-4-1": "The service is provided \"as is\" and \"as available\" without warranties of any kind, express or implied. We do not guarantee the accuracy, completeness, validity, reliability, or availability of any information provided by users or the results that can be obtained from using the service.",
        "terms-of-service-p-4-2": "Under no circumstances shall \"Resail\" be liable for any direct, indirect, incidental, special, consequential, or punitive damages, including, but not limited to, loss of profits, data, or use, arising from the use or inability to use the service.",
        "terms-of-service-h4-5": "5. Modifications to Terms",
        "terms-of-service-p-5-1": "We reserve the right to modify or update these terms and conditions at any time without prior notice. Any changes will be posted on this page, and your continued use of the service after the modifications are published constitutes your acceptance of the modified terms. Please review this page regularly for any updates.",
        "terms-of-service-h4-6": "6. Governing Law",
        "terms-of-service-p-6-1": "These terms and conditions are governed by and construed in accordance with the laws of the Kingdom of Saudi Arabia, and you agree to submit to the exclusive jurisdiction of the courts of the Kingdom of Saudi Arabia to resolve any disputes arising from these terms or the use of the service.",
        "terms-of-service-h4-7": "7. Contact Us",
        "terms-of-service-p-7-1": "For any questions or inquiries regarding the terms of service, please contact us via email: <strong><a href=\"mailto:ramyheshamamer@gmail.com\">ramyheshamamer@gmail.com</a></strong>."
    }
};

const CONTROL_VISIBILITY_CONFIG = {
    // ูููุฆุฉ ุงูุนุงุฏูุฉุ ูุณุชุฎุฏู ุฎูููุฉ ุฃุณุงุณูุฉุ ูููู ููููุฏุฑ ูุงููุตูุต
    'normal': ['primary-bg', 'header-text', 'title-text', 'body-text', 'subtle-text', 'accent-bg'],
    // ูููุฆุฉ ุงูููุงุณูุฉุ ูุถูู ููู ุฎูููุฉ ููุดุฑูุท ุงูุฌุงูุจู
    'standard': ['primary-bg', 'sidebar-bg', 'header-text', 'title-text', 'body-text', 'subtle-text', 'accent-bg'],
    // ูููุฆุฉ ุงูุงุญุชุฑุงููุฉุ ูู ุงูุฃููุงู ูููุฉ
    'professional': ['primary-bg', 'sidebar-bg', 'header-text', 'title-text', 'body-text', 'subtle-text', 'accent-bg'],
    // ูุฆุฉ AST ุชุดุจู ุงููุฆุฉ ุงูููุงุณูุฉ
    'ast': ['primary-bg', 'sidebar-bg', 'header-text', 'title-text', 'body-text', 'subtle-text', 'accent-bg'],
    // ุงููุฆุฉ ุงูุฅุจุฏุงุนูุฉ ุชุนุชูุฏ ุจุดูู ูุจูุฑ ุนูู ุงูุฃููุงู
    'creative': ['primary-bg', 'sidebar-bg', 'header-text', 'title-text', 'body-text', 'subtle-text', 'accent-bg']
};

const colorPalettes = [
    // --- 9 ููุญุงุช ุฃููุงู ุซุงุจุชุฉ ---
    { name: 'Ocean Blue', id: 'palette-ocean', isGradient: false, colors: { '--primary-bg': '#0d47a1', '--secondary-bg': '#1976d2', '--sidebar-bg': '#f4f6f8', '--accent-bg': '#bbdefb', '--header-text': '#ffffff', '--title-text': '#0d47a1', '--body-text': '#333333', '--subtle-text': '#5f6368' } },
    { name: 'Forest Green', id: 'palette-forest', isGradient: false, colors: { '--primary-bg': '#1b5e20', '--secondary-bg': '#388e3c', '--sidebar-bg': '#f5f5f5', '--accent-bg': '#c8e6c9', '--header-text': '#ffffff', '--title-text': '#1b5e20', '--body-text': '#212121', '--subtle-text': '#616161' } },
    { name: 'Graphite & Amber', id: 'palette-graphite', isGradient: false, colors: { '--primary-bg': '#263238', '--secondary-bg': '#37474f', '--sidebar-bg': '#f5f5f5', '--accent-bg': '#ffecb3', '--header-text': '#ffffff', '--title-text': '#ffab00', '--body-text': '#212121', '--subtle-text': '#757575' } },
    { name: 'Ruby Red', id: 'palette-ruby', isGradient: false, colors: { '--primary-bg': '#b71c1c', '--secondary-bg': '#d32f2f', '--sidebar-bg': '#fbe9e7', '--accent-bg': '#ffcdd2', '--header-text': '#ffffff', '--title-text': '#b71c1c', '--body-text': '#424242', '--subtle-text': '#757575' } },
    { name: 'Royal Purple', id: 'palette-purple', isGradient: false, colors: { '--primary-bg': '#4a148c', '--secondary-bg': '#7b1fa2', '--sidebar-bg': '#f3e5f5', '--accent-bg': '#e1bee7', '--header-text': '#ffffff', '--title-text': '#4a148c', '--body-text': '#311b92', '--subtle-text': '#6a1b9a' } },
    { name: 'Earth Tones', id: 'palette-earth', isGradient: false, colors: { '--primary-bg': '#4e342e', '--secondary-bg': '#6d4c41', '--sidebar-bg': '#efebe9', '--accent-bg': '#d7ccc8', '--header-text': '#ffffff', '--title-text': '#4e342e', '--body-text': '#3e2723', '--subtle-text': '#5d4037' } },
    { name: 'Slate Blue', id: 'palette-slate', isGradient: false, colors: { '--primary-bg': '#455a64', '--secondary-bg': '#607d8b', '--sidebar-bg': '#eceff1', '--accent-bg': '#cfd8dc', '--header-text': '#ffffff', '--title-text': '#37474f', '--body-text': '#263238', '--subtle-text': '#546e7a' } },
    { name: 'Teal', id: 'palette-teal', isGradient: false, colors: { '--primary-bg': '#00695c', '--secondary-bg': '#00897b', '--sidebar-bg': '#e0f2f1', '--accent-bg': '#b2dfdb', '--header-text': '#ffffff', '--title-text': '#004d40', '--body-text': '#004d40', '--subtle-text': '#00796b' } },
    { name: 'Maroon', id: 'palette-maroon', isGradient: false, colors: { '--primary-bg': '#880e4f', '--secondary-bg': '#c2185b', '--sidebar-bg': '#fce4ec', '--accent-bg': '#f8bbd0', '--header-text': '#ffffff', '--title-text': '#880e4f', '--body-text': '#560027', '--subtle-text': '#ad1457' } },

    // --- 6 ููุญุงุช ุฃููุงู ูุชุฏุฑุฌุฉ ---
    { name: 'Sunset Fade', id: 'palette-sunset', isGradient: true, colors: { '--primary-bg': 'linear-gradient(to right, #8e2de2, #4a00e0)', '--secondary-bg': '#4a00e0', '--sidebar-bg': '#f3e5f5', '--accent-bg': '#d1c4e9', '--header-text': '#ffffff', '--title-text': '#4a00e0', '--body-text': '#333333', '--subtle-text': '#673ab7' } },
    { name: 'Oceanic Deep', id: 'palette-oceanic', isGradient: true, colors: { '--primary-bg': 'linear-gradient(to right, #005c97, #363795)', '--secondary-bg': '#005c97', '--sidebar-bg': '#e0f7fa', '--accent-bg': '#b2ebf2', '--header-text': '#ffffff', '--title-text': '#005c97', '--body-text': '#004d40', '--subtle-text': '#00796b' } },
    { name: 'Mint Fresh', id: 'palette-mint', isGradient: true, colors: { '--primary-bg': 'linear-gradient(to right, #26d0ce, #1a2980)', '--secondary-bg': '#26d0ce', '--sidebar-bg': '#f1f8e9', '--accent-bg': '#dcedc8', '--header-text': '#ffffff', '--title-text': '#1a2980', '--body-text': '#33691e', '--subtle-text': '#558b2f' } },
    { name: 'Soft Peach', id: 'palette-peach', isGradient: true, colors: { '--primary-bg': 'linear-gradient(to right, #ff9a9e, #fad0c4)', '--secondary-bg': '#ff9a9e', '--sidebar-bg': '#fff5f5', '--accent-bg': '#ffcdd2', '--header-text': '#ffffff', '--title-text': '#e57373', '--body-text': '#bf360c', '--subtle-text': '#f44336' } },
    { name: 'Lush Green', id: 'palette-lush', isGradient: true, colors: { '--primary-bg': 'linear-gradient(to right, #2e7d32, #c8e6c9)', '--secondary-bg': '#2e7d32', '--sidebar-bg': '#f1f8e9', '--accent-bg': '#a5d6a7', '--header-text': '#ffffff', '--title-text': '#1b5e20', '--body-text': '#2e7d32', '--subtle-text': '#66bb6a' } },
    { name: 'Night Sky', id: 'palette-night', isGradient: true, colors: { '--primary-bg': 'linear-gradient(to right, #2c3e50, #4c5a65)', '--secondary-bg': '#2c3e50', '--sidebar-bg': '#eceff1', '--accent-bg': '#b0bec5', '--header-text': '#ffffff', '--title-text': '#2c3e50', '--body-text': '#37474f', '--subtle-text': '#546e7a' } }
];

// ูุงุฆูุฉ ุงูุฎุทูุท ุงูุนุฑุจูุฉ
const arabicFonts = [
    { name: 'Tajawal (ุชุฌูุงู)', value: "'Tajawal', sans-serif" },
    { name: 'Cairo (ุงููุงูุฑุฉ)', value: "'Cairo', sans-serif" },
    { name: 'Amiri (ุฃููุฑู - ููุงุณููู)', value: "'Amiri', serif" },
    { name: 'Almarai (ุงููุฑุงุนู)', value: "'Almarai', sans-serif" },
    { name: 'Markazi Text (ูุฑูุฒู)', value: "'Markazi Text', serif" },
    { name: 'Lalezar (ูุงูู ุฒุงุฑ - ููุนูุงููู)', value: "'Lalezar', cursive" }
];

// ูุงุฆูุฉ ุงูุฎุทูุท ุงูุฅูุฌููุฒูุฉ
const englishFonts = [
    { name: 'Roboto', value: "'Roboto', sans-serif" },
    { name: 'Lato', value: "'Lato', sans-serif" },
    { name: 'Montserrat', value: "'Montserrat', sans-serif" },
    { name: 'Open Sans', value: "'Open Sans', sans-serif" },
    { name: 'PT Sans', value: "'PT Sans', sans-serif" },
    { name: 'Playfair Display (Serif)', value: "'Playfair Display', serif" },
    { name: 'Noto Serif (Serif)', value: "'Noto Serif', serif" }
];

/**
 * ูููู ุจุชุนุจุฆุฉ ููุงุฆู ุงุฎุชูุงุฑ ุงูุฎุทูุท ุจุงูุฎูุงุฑุงุช ุงูููุงุณุจุฉ (ุนุฑุจูุฉ ุฃู ุฅูุฌููุฒูุฉ) ุจูุงุกู ุนูู ุงููุบุฉ ุงูุญุงููุฉ.
 */
function populateFontSelectors() {
    const isArabic = currentLang === 'ar';
    const fontList = isArabic ? arabicFonts : englishFonts;

    const selectors = {
        name: document.getElementById('font-selector-name'),
        headings: document.getElementById('font-selector-headings'),
        body: document.getElementById('font-selector-body')
    };

    // ุชุนุจุฆุฉ ูู ูุงุฆูุฉ ููุณุฏูุฉ
    for (const key in selectors) {
        const selectElement = selectors[key];
        if (selectElement) {
            // ูุณุญ ุงูุฎูุงุฑุงุช ุงููุฏููุฉ
            selectElement.innerHTML = '';
            // ุฅุถุงูุฉ ุงูุฎูุงุฑุงุช ุงูุฌุฏูุฏุฉ
            fontList.forEach(font => {
                const option = document.createElement('option');
                option.value = font.value;
                option.textContent = font.name;
                selectElement.appendChild(option);
            });
        }
    }

    // ุชุญุฏูุฏ ุฎุทูุท ุงูุชุฑุงุถูุฉ ูุฎุชููุฉ ููู ุนูุตุฑ
    if(selectors.name) selectors.name.value = isArabic ? "'Cairo', sans-serif" : "'Playfair Display', serif";
    if(selectors.headings) selectors.headings.value = isArabic ? "'Tajawal', sans-serif" : "'Montserrat', sans-serif";
    if(selectors.body) selectors.body.value = isArabic ? "'Almarai', sans-serif" : "'Roboto', sans-serif";

    // ุชุทุจูู ุงูุฎุทูุท ุงูุงูุชุฑุงุถูุฉ ุนูู ุงููุนุงููุฉ
    applySelectedFonts();
}

/**
 * ุฅุนุฏุงุฏ ุฒุฑ ุชุจุฏูู ุงููุบุฉ ุจุดูู ุฏููุงูููู ุจูุงุกู ุนูู ุงููุบุฉ ุงูุญุงููุฉ.
 */
function setupLanguageToggle() {
    const langToggleButton = document.getElementById('lang-toggle-btn');
    if (!langToggleButton) return;

    if (currentLang === 'ar') {
        // ุฅุฐุง ูุงูุช ุงูุตูุญุฉ ุงูุญุงููุฉ ุนุฑุจูุฉุ ูุฌุจ ุฃู ูุญูู ุงูุฒุฑ ุฅูู ุงูุฅูุฌููุฒูุฉ
        langToggleButton.textContent = 'English';
        langToggleButton.href = 'en.html';
        langToggleButton.onclick = () => setUserLanguage('en');
    } else {
        // ุฅุฐุง ูุงูุช ุงูุตูุญุฉ ุงูุญุงููุฉ ุฅูุฌููุฒูุฉุ ูุฌุจ ุฃู ูุญูู ุงูุฒุฑ ุฅูู ุงูุนุฑุจูุฉ
        langToggleButton.textContent = 'ุงูุนุฑุจูุฉ';
        langToggleButton.href = 'index.html';
        langToggleButton.onclick = () => setUserLanguage('ar');
    }
}

/**
 * ุชุญุฏุฏ ูุบุฉ ุงููุณุชุฎุฏู ูุชูุณุญ ุงูุจูุงูุงุช ุงููุญููุธุฉ ูุถูุงู ุนุฑุถ ุจูุงูุงุช ุชุฌุฑูุจูุฉ ุฌุฏูุฏุฉ ููุชุฑุฌูุฉ.
 * @param {string} lang - ุงููุบุฉ ุงูุฌุฏูุฏุฉ ('ar' ุฃู 'en').
 */
function setUserLanguage(lang) {
    // 1. ุชุญูู ุฅุฐุง ูุงูุช ุงููุบุฉ ุงูุฌุฏูุฏุฉ ูุฎุชููุฉ ุนู ุงูุญุงููุฉ
    if (lang === currentLang) {
        // ูุง ุชูุนู ุดูุฆูุง ุฅุฐุง ูู ุชุชุบูุฑ ุงููุบุฉ
        return;
    }

    // โญ ุงูุชุนุฏูู ุงูุฃุณุงุณู: ุชู ุญุฐู ุงูุณุทุฑ ุงูุฐู ูุงู ูููู ุจูุณุญ ุงูุจูุงูุงุช ูู ููุง
    // localStorage.removeItem('resailCvData_' + currentLang);

    // 3. ุชุญุฏูุซ ุงููุบุฉ ุงูุญุงููุฉ
    currentLang = lang;

    // 4. ุชุญุฏูุฏ ุงุฎุชูุงุฑ ุงููุบุฉ ุงูุฌุฏูุฏ ูู ุฐุงูุฑุฉ ุงูุฌูุณุฉ (sessionStorage)
    sessionStorage.setItem('userLang', lang);

    // 5. ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ ุจุงููุบุฉ ุงูุฌุฏูุฏุฉ
    window.location.href = lang === 'ar' ? 'index.html' : 'en.html';
}

/**
 * ูุฌูุน ูู ุจูุงูุงุช ูููุฐุฌ ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ููุญูุธูุง ูู localStorage
 * ุจุงุณุชุฎุฏุงู ููุชุงุญ ุฎุงุต ุจุงููุบุฉ ุงูุญุงููุฉ (ูุซุงู: 'resailCvData_ar').
 */
function saveCvDataToLocalStorage() {
    const cvData = {
        name: document.getElementById('name-input')?.value,
        title: document.getElementById('title-input')?.value,
        email: document.getElementById('email-input')?.value,
        phone: document.getElementById('phone-input')?.value,
        website: document.getElementById('website-input')?.value,
        objective: document.getElementById('objective-input')?.value,
        profilePic: profilePicDataUrl,
        experiences: getExperiencesData(),
        educations: getEducationsData(),
        skills: getSkillsData(),
        languages: getLanguagesData(),
        references: getReferencesData(),
        customSections: getCustomSectionsData()
    };

    try {
        // โญ ุงูุชุบููุฑ ุงูุฑุฆูุณู ููุง: ุฅุถุงูุฉ currentLang ุฅูู ุงูููุชุงุญ
        localStorage.setItem('resailCvData_' + currentLang, JSON.stringify(cvData));
    } catch (e) {
        console.error("Error saving to localStorage", e);
    }
}


/**
 * ููุญุต localStorage ุนู ุจูุงูุงุช ูุญููุธุฉ ููุบุฉ ุงูุญุงููุฉุ ูุฅุฐุง ูุฌุฏุชุ ูููู ุจุชุนุจุฆุฉ ุงููููุฐุฌ ุจูุง.
 * @returns {boolean} - ููุฑุฌุน 'true' ุฅุฐุง ุชู ุงูุนุซูุฑ ุนูู ุจูุงูุงุช ูุชุญููููุงุ ู'false' ุจุฎูุงู ุฐูู.
 */
function loadCvDataFromLocalStorage() {
    try {
        // โญ ุงูุชุบููุฑ ุงูุฑุฆูุณู ููุง: ูุฑุงุกุฉ ุงูููุชุงุญ ุงูุฎุงุต ุจุงููุบุฉ ุงูุญุงููุฉ
        const savedDataJSON = localStorage.getItem('resailCvData_' + currentLang);
        if (!savedDataJSON) {
            return false; // ูุง ุชูุฌุฏ ุจูุงูุงุช ูุญููุธุฉ ููุฐู ุงููุบุฉ
        }

        const savedData = JSON.parse(savedDataJSON);

        // ... (ุจููุฉ ุงูููุฏ ูู ูุฐู ุงูุฏุงูุฉ ูุจูู ููุง ูู ุฏูู ุชุบููุฑ) ...
        document.getElementById('name-input').value = savedData.name || '';
        document.getElementById('title-input').value = savedData.title || '';
        document.getElementById('email-input').value = savedData.email || '';
        document.getElementById('phone-input').value = savedData.phone || '';
        document.getElementById('website-input').value = savedData.website || '';
        document.getElementById('objective-input').value = savedData.objective || '';
        if (savedData.profilePic) {
            profilePicDataUrl = savedData.profilePic;
        }

        document.getElementById('experience-input').innerHTML = '';
        document.getElementById('education-input').innerHTML = '';
        document.getElementById('skills-input').innerHTML = '';
        document.getElementById('languages-input').innerHTML = '';
        document.getElementById('references-input').innerHTML = '';

        const oldCustomContainer = document.getElementById('custom-sections-container');
        if (oldCustomContainer) {
            oldCustomContainer.innerHTML = '';
        }

        savedData.experiences?.forEach(data => addExperienceField(data));
        savedData.educations?.forEach(data => addEducationField(data));
        savedData.skills?.forEach(data => addSkillField(data));
        savedData.languages?.forEach(data => addLanguageField(data));
        savedData.references?.forEach(data => addReferenceField(data));

        if (savedData.customSections && savedData.customSections.length > 0) {
            savedData.customSections.forEach(sectionData => {
                addCustomSection(); 
                const allCustomSections = document.querySelectorAll('#custom-sections-container .custom-section-wrapper');
                const newSection = allCustomSections[allCustomSections.length - 1]; 

                if (newSection) {
                    newSection.querySelector('.custom-section-title').value = sectionData.title;
                    const subSectionsContainer = newSection.querySelector('.sub-sections-container');
                    subSectionsContainer.innerHTML = ''; 

                    sectionData.subSections.forEach(subData => {
                        const subSectionEntry = document.createElement('div');
                        subSectionEntry.className = 'custom-subsection-entry border p-2 mb-2 rounded position-relative';
                        subSectionEntry.innerHTML = `
                            <button type="button" class="remove-field" onclick="this.parentElement.remove(); generateCV(document.getElementById('cv-container'));" title="${translations[currentLang]['remove_subsection_title']}">&times;</button>
                            <input type="text" class="form-control mb-2 custom-subsection-title" placeholder="${translations[currentLang]['subsection_title_placeholder']}" value="${subData.title || ''}" oninput="generateCV(document.getElementById('cv-container'));">
                            <textarea class="form-control custom-subsection-description" placeholder="${translations[currentLang]['subsection_desc_placeholder']}" rows="3" oninput="generateCV(document.getElementById('cv-container'));">${subData.description || ''}</textarea>
                        `;
                        subSectionsContainer.appendChild(subSectionEntry);
                    });
                }
            });
        }

        updatePageContentLanguage();
        return true;

    } catch (e) {
        console.error("Error loading from localStorage", e);
        localStorage.removeItem('resailCvData_' + currentLang);
        return false;
    }
}
// Global variables
let currentLang = 'ar';
let selectedTemplate = 1;
let selectedTemplateCategory = 'normal';
let profilePicDataUrl = null;
let selectedPriceToPay = 0;
let discountApplied = 0;
const discountCodes = { "SAVE10": 10, "FIRSTBUY": 25, "FREECV": 100 };
const PRICES = {
    local: { normal: 19, standard: 25, professional: 29, ast: 29, creative: 33 }, // ุฃุณุนุงุฑ ุจุงูุฑูุงู
    lemonSqueezy: { normal: 25, standard: 33, professional: 39, ast: 39 , creative: 45 }, // ุฃุณุนุงุฑ ุจุงูุฑูุงู
};

const CHECKOUT_CONFIG = {
    normal: {
        link: 'https://resail-cvs.lemonsqueezy.com/buy/bbfff981-9bd9-495c-b1ac-40b013f5b598?enabled=863216'
    },
    standard: {
        link: 'https://resail-cvs.lemonsqueezy.com/buy/a00ef7a0-db54-47cf-9145-4b5c50892b84?enabled=865702'
    },
    professional: {
        link: 'https://resail-cvs.lemonsqueezy.com/buy/fd9e9305-914a-4936-96ed-e308e9ea6460?enabled=865708'
    },
    ast: {
        link: 'https://resail-cvs.lemonsqueezy.com/buy/38ead94f-86f2-4f7e-a6eb-e5887f5f0d47?enabled=865714'
    },
    creative: {
    link: 'https://resail-cvs.lemonsqueezy.com/buy/c78cce0d-171e-49ff-86dd-5288509cdadc'
    }
};


// DOM elements
let paymentNameInput, paymentEmailInput, paymentPhoneInput, paymentMessagesInput, paymentFileInput, qrPaymentResultDiv, submitPaymentProofButton, cvContainer, siteHeaderGlobal, loadingOverlayGlobal, loadingTextGlobal;

const MAX_FILE_SIZE = 3 * 1024 * 1024; // 3MB
const ALLOWED_FILE_TYPES = ['image/jpeg', 'image/png', 'application/pdf'];

// **ุนููุงู URL ูุฎุงุฏู Node.js ุงูุฎุงุต ุจู**
// ูุฌุจ ุชุญุฏูุซ ูุฐุง ุจู IP ุงูุฎุงุฏู ุงููุนูู ุนูุฏ ุงููุดุฑ (ูุซุงู: 'http://192.168.1.100:3000')
//const NODE_SERVER_URL = 'https://cv-generator-service-627901029415.asia-east2.run.app';
//const NODE_SERVER_URL = 'http://localhost:8080';
const NODE_SERVER_URL = 'https://resail-cv-generator-f0jc.onrender.com';


// **ุนููุงู URL ูุชุทุจูู Google Apps Script ุงูุฎุงุต ุจู (ุงูุฎุงุต ุจูุนุงูุฌุฉ ุงูุฏูุน ููุท)**
const GOOGLE_APPS_SCRIPT_WEB_APP_URL_PAYMENT_PROCESSOR = 'https://script.google.com/macros/s/AKfycbxxkX4jsV4zSz4vR7FcCOhYJmXXuOAt5WrJYgZmhTlmO7dzqXARLM6q_5QNo2KVs8bWww/exec';

// --- ุฏูุงู ุฅุดุนุงุฑุงุช ุงููุจูุนุงุช ุงูุญูุฉ ---
let salesQueue = [
    { name: "ูุญูุฏ", city: "ุงูุฑูุงุถ" },
    { name: "ุณุงุฑุฉ", city: "ุฌุฏุฉ" },
    { name: "ุนุจุฏุงูุฑุญูู", city: "ุงูุฏูุงู" }
]; // ุจูุงูุงุช ุฃูููุฉ ุงูุชุฑุงุถูุฉ

// ูู ุฃุนูู ููู script.js ูุน ุจููุฉ ุงููุชุบูุฑุงุช
let finalPriceToPay = 0; // ุณูุญุชูุธ ุจุงูุณุนุฑ ุงูููุงุฆู ุจุนุฏ ุงูุฎุตู
let appliedCode = ""; // ุณูุญุชูุธ ุจุงูููุฏ ุงููุทุจู


/**
 * ุชุทุจู ุงูุฎุท ุงููุฎุชุงุฑ ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ุนูู ุญุงููุฉ ุนุฑุถ ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ.
 */
function applySelectedFonts() {
    const nameFont = document.getElementById('font-selector-name')?.value;
    const headingsFont = document.getElementById('font-selector-headings')?.value;
    const bodyFont = document.getElementById('font-selector-body')?.value;
    const cvContainer = document.getElementById('cv-container');

    if (!cvContainer || !nameFont || !headingsFont || !bodyFont) return;

    // ุทุฑููุฉ ูุนุงูุฉ ูุชุทุจูู ุงูุชูุณููุงุช ุนุจุฑ ุฅุถุงูุฉ ูุณู style ูุฎุตุต ูููุนุงููู ุงูุญูุฉ
    let livePreviewStyle = document.getElementById('live-font-styles');
    if (!livePreviewStyle) {
        livePreviewStyle = document.createElement('style');
        livePreviewStyle.id = 'live-font-styles';
        document.head.appendChild(livePreviewStyle);
    }

    // ูุชุงุจุฉ ููุงุนุฏ CSS ูุจุงุดุฑุฉู ูุงุณุชูุฏุงู ุงูุนูุงุตุฑ ุงูุตุญูุญุฉ
    livePreviewStyle.textContent = `
        /* ุชุทุจูู ุฎุท ุงููุต ุงูุฃุณุงุณู ุนูู ุงูุญุงููุฉ ูุนูุงุตุฑ ุงูุงุชุตุงู */
        #cv-container, #cv-container .cv-contact-item p { font-family: ${bodyFont}; }
        /* ุชุฌุงูุฒ ุงูุฎุท ูุงุณู ุงูุดุฎุต ูุนููุงูู ุงููุธููู */
        #cv-container .cv-name, #cv-container .cv-title { font-family: ${nameFont}; }
        /* ุชุฌุงูุฒ ุงูุฎุท ูุนูุงููู ุงูุฃูุณุงู */
        #cv-container .cv-section-title { font-family: ${headingsFont}; }
    `;
}

/**
 * =========================================================================
 * == ุฏุงูุฉ createPaletteControls ุงูููุงุฆูุฉ - (ุชุฎูู/ุชุธูุฑ ุงูุจุงูุชุงุช ุญุณุจ ุงููุฆุฉ) ==
 * =========================================================================
 */
function createPaletteControls() {
    const container = document.getElementById('palette-selector');
    if (!container) return;
    container.innerHTML = '';

    // 1. ูุญุฏุฏ ูุง ุฅุฐุง ูุงู ูุฌุจ ุฅุธูุงุฑ ููุญุงุช ุงูุฃููุงู ุงููุชุฏุฑุฌุฉ
    const showGradientPalettes = !['normal', 'standard'].includes(selectedTemplateCategory);

    colorPalettes.forEach(palette => {
        // 2. ุฅุฐุง ูุงูุช ุงูููุญุฉ ูุชุฏุฑุฌุฉ ูุงููุฆุฉ ูุง ุชุฏุนููุงุ ูุชุฌุงูุฒูุง
        if (palette.isGradient && !showGradientPalettes) {
            return; // ุชุฎุทู ูุฐู ุงูููุญุฉ ูุงูุงูุชูุงู ุฅูู ุงูุชุงููุฉ
        }

        // 3. ุจูุงุก ูุนุฑุถ ุงูุฃููููุฉ ูููุญุงุช ุงููุณููุญ ุจูุง ููุท
        const swatch = document.createElement('div');
        swatch.className = 'palette-swatch';
        swatch.dataset.paletteId = palette.id;
        
        const primaryCircle = `<span class="palette-color" style="background: ${palette.colors['--primary-bg']};"></span>`;
        const titleCircle = `<span class="palette-color" style="background: ${palette.colors['--title-text']};"></span>`;
        const accentCircle = `<span class="palette-color" style="background: ${palette.colors['--accent-bg']};"></span>`;

        swatch.innerHTML = `${primaryCircle}${titleCircle}${accentCircle}`;
        
        swatch.onclick = () => applyPalette(palette.id);
        container.appendChild(swatch);
    });
}

/**
 * =========================================================================
 * == ุฏุงูุฉ applyPalette ุงูููุงุฆูุฉ - (ุชููู ุจุชุญุฏูุซ ุงููุงุฌูุฉ ููุท) ==
 * =========================================================================
 * @param {string} paletteId - ูุนุฑู ููุญุฉ ุงูุฃููุงู.
 */
function applyPalette(paletteId) {
    const selectedPalette = colorPalettes.find(p => p.id === paletteId);
    if (!selectedPalette) return;

    const colors = selectedPalette.colors;

    // ุงูุฎุทูุฉ 1: ุชุญุฏูุซ ููู ุฃุฏูุงุช ุงูุชุญูู ููุท
    for (const [key, value] of Object.entries(colors)) {
        const controlName = key.replace('--', '');
        const component = document.querySelector(`.color-control-component[data-color-name="${controlName}"]`);
        
        if (component) { // ููุฃููุงู ุงููุงุจูุฉ ููุชุฏุฑุฌ
            const toggle = component.querySelector('.gradient-toggle');
            const solidPicker = component.querySelector(`#color-picker-${controlName}`);
            const startPicker = component.querySelector(`#color-picker-${controlName}-start`);
            const endPicker = component.querySelector(`#color-picker-${controlName}-end`);

            if (typeof value === 'string' && value.startsWith('linear-gradient')) {
                if (!toggle.checked) toggle.click();
                const colorValues = value.match(/#([0-9a-fA-F]{6}|[0-9a-fA-F]{3})/g);
                if (colorValues && colorValues.length >= 2) {
                    startPicker.value = colorValues[0];
                    endPicker.value = colorValues[1];
                }
            } else {
                if (toggle.checked) toggle.click();
                solidPicker.value = value;
            }
        } else { // ูุฃููุงู ุงููุตูุต ุงูุซุงุจุชุฉ
             const textPicker = document.getElementById(`color-picker-${controlName}`);
             if(textPicker) textPicker.value = value;
        }
    }
    
    document.querySelectorAll('.palette-swatch').forEach(s => s.classList.remove('selected'));
    document.querySelector(`.palette-swatch[data-palette-id="${paletteId}"]`).classList.add('selected');

    // ุงูุฎุทูุฉ 2: ุงุณุชุฏุนุงุก ุฏุงูุฉ ุงูุชุทุจูู ุงูููุญุฏุฉ
    applySelectedColors();
}

/**
 * 3. (ุชุญุฏูุซ) ูุฅุถุงูุฉ ุงูุชุฑุฌูุฉ ุงููุงุฒูุฉ
 */
function updateTranslationsForPalette() {
     const title = document.querySelector('#palette-container h6');
     if (title) {
        title.textContent = translations[currentLang]['color_presets_title'];
     }
}

/**
 * =========================================================================
 * ==  ุงูููุฏ ุงูุฌุฏูุฏ ููุชุญูู ูู ุงูุฃุญุฌุงู ูุงูุฃููุงุท ุงูุฏููุงููููุฉ (ุงูุฅุตุฏุงุฑ 2.0)  ==
 * =========================================================================
 */

// ุฏุงูุฉ ูุชุทุจูู ุฃุญุฌุงู ุงููุตูุต ูุงูุตูุฑ ุจูุงุกู ุนูู ููู ุงูููุฒููุงุช
function applyDynamicSizes() {
    const cvContainer = document.getElementById('cv-container');
    if (!cvContainer) return;

    // ูุฑุงุกุฉ ููู ุงูููุฒููุงุช
    const nameSize = document.getElementById('name-size-slider')?.value;
    const titleSize = document.getElementById('title-size-slider')?.value;
    const contactSize = document.getElementById('contact-size-slider')?.value;
    const sectionTitleSize = document.getElementById('section-title-size-slider')?.value;
    const subsectionTitleSize = document.getElementById('subsection-title-size-slider')?.value;
    const bodyTextSize = document.getElementById('body-text-size-slider')?.value;
    const imageSize = document.getElementById('image-size-slider')?.value;
    const imageRadius = document.getElementById('image-radius-slider')?.value;

    // ุชุทุจูู ุงูููู ููุชุบูุฑุงุช CSS ุนูู ุญุงููุฉ ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ
    cvContainer.style.setProperty('--font-size-name', `${nameSize}em`);
    cvContainer.style.setProperty('--font-size-title', `${titleSize}em`);
    cvContainer.style.setProperty('--font-size-contact', `${contactSize}em`);
    cvContainer.style.setProperty('--font-size-section-title', `${sectionTitleSize}em`);
    cvContainer.style.setProperty('--font-size-subsection-title', `${subsectionTitleSize}em`);
    cvContainer.style.setProperty('--font-size-body', `${bodyTextSize}em`);
    cvContainer.style.setProperty('--image-size', `${imageSize}px`);
    cvContainer.style.setProperty('--image-radius', `${imageRadius}%`);
}

// ุฏุงูุฉ ูุฑุจุท ุงูุฃุญุฏุงุซ ุจุงูููุฒููุงุช ุงูุฌุฏูุฏุฉ
function setupDynamicControlListeners() {
    const sliders = [
        'image-size-slider', 'image-radius-slider',
        'name-size-slider', 'title-size-slider', 'contact-size-slider',
        'section-title-size-slider', 'subsection-title-size-slider', 'body-text-size-slider'
    ];
    
    sliders.forEach(sliderId => {
        const slider = document.getElementById(sliderId);
        if (slider) {
            slider.addEventListener('input', applyDynamicSizes);
        }
    });
}


/**
 * === ุงูุฏุงูุฉ ุงูููุงุฆูุฉ: ูุตุฏุฑ ุงูุญูููุฉ ุงููุญูุฏ ููุฃููุงู ===
 * ุชูุฑุฃ ูู ุงูุฃููุงู ูู ููุญุฉ ุงูุชุญูู ูุชุนูุฏูุง ููุต CSS ุฌุงูุฒ ููุงุณุชุฎุฏุงู.
 */
function getColorVariablesAsCssText() {
    let cssText = '#cv-container {';
    // ุฌูุน ุฃููุงู ุงูุฎูููุงุช
    document.querySelectorAll('.color-control-component').forEach(component => {
        const colorName = component.dataset.colorName;
        const toggle = component.querySelector('.gradient-toggle');
        let finalValue;
        if (toggle && toggle.checked) {
            const start = component.querySelector(`#color-picker-${colorName}-start`).value;
            const end = component.querySelector(`#color-picker-${colorName}-end`).value;
            const direction = component.querySelector('.gradient-direction').value;
            finalValue = `linear-gradient(${direction}, ${start}, ${end})`;
        } else {
            finalValue = component.querySelector(`#color-picker-${colorName}`).value;
        }
        cssText += `--${colorName}: ${finalValue};`;
    });
    // ุฌูุน ุฃููุงู ุงููุตูุต
    cssText += `--header-text: ${document.getElementById('color-picker-header-text').value};`;
    cssText += `--title-text: ${document.getElementById('color-picker-title-text').value};`;
    cssText += `--body-text: ${document.getElementById('color-picker-body-text').value};`;
    cssText += `--subtle-text: ${document.getElementById('color-picker-subtle-text').value};`;
    cssText += '}';
    return cssText;
}


/**
 * ููุฑุฃ ุงูุฃููุงู ุงููุฎุชุงุฑุฉ ูู ุงููุงุฌูุฉ ููุทุจููุง ููุชุบูุฑุงุช CSS ุนูู ุญุงููุฉ ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ.
 */
function applySelectedColors() {
    let livePreviewStyle = document.getElementById('live-color-styles');
    if (!livePreviewStyle) {
        livePreviewStyle = document.createElement('style');
        livePreviewStyle.id = 'live-color-styles';
        document.head.appendChild(livePreviewStyle);
    }
    livePreviewStyle.textContent = getColorVariablesAsCssText();
}

/**
 * ุฅุนุฏุงุฏ ูุธุงุฆู ููููุงุช ุงูุชุญูู ุจุงูุฃููุงู (ุงูุชุจุฏูู ุจูู ุงูููู ุงูุซุงุจุช ูุงููุชุฏุฑุฌ).
 */
function setupColorControls() {
    // ุฑุจุท ุงูุฃุญุฏุงุซ ูููููุงุช ุงูุฎูููุงุช ุงููุงุจูุฉ ููุชุฏุฑุฌ
    document.querySelectorAll('.color-control-component').forEach(component => {
        const toggle = component.querySelector('.gradient-toggle');
        const solidPicker = component.querySelector('.solid-color-picker');
        const gradientControls = component.querySelector('.gradient-controls');

        if (toggle && solidPicker && gradientControls) {
            toggle.addEventListener('change', () => {
                solidPicker.style.display = toggle.checked ? 'none' : 'block';
                gradientControls.style.display = toggle.checked ? 'block' : 'none';
                applySelectedColors(); // ุฃุนุฏ ุชุทุจูู ุงูุฃููุงู ุนูุฏ ุงูุชุจุฏูู
            });
        }
        component.querySelectorAll('input[type="color"], select').forEach(input => {
            input.addEventListener('input', applySelectedColors);
        });
    });

    // ุฑุจุท ุงูุฃุญุฏุงุซ ูุฃุฏูุงุช ุฃููุงู ุงููุตูุต ุงูุซุงุจุชุฉ (ูุฐุง ุงูุฌุฒุก ูุงู ูุงูุตุงู)
    document.getElementById('color-picker-header-text').addEventListener('input', applySelectedColors);
    document.getElementById('color-picker-title-text').addEventListener('input', applySelectedColors);
    document.getElementById('color-picker-body-text').addEventListener('input', applySelectedColors);
    document.getElementById('color-picker-subtle-text').addEventListener('input', applySelectedColors);
}



// --- ุฃุถู ูุฐู ุงูุฏุงูุฉ ุงูุฌุฏูุฏุฉ ุจุงููุงูู ---
/**
 * ุชุชุญูู ูู ุฅุธูุงุฑ ุฃู ุฅุฎูุงุก ุฃุฏูุงุช ุงูุชุญูู ูู ุงูุฃููุงู ุจูุงุกู ุนูู ูุฆุฉ ุงููุงูุจ ุงูุญุงููุฉ.
 */
function updateColorControlVisibility() {
    // ุงูุญุตูู ุนูู ูุงุฆูุฉ ุนูุงุตุฑ ุงูุชุญูู ุงููุณููุญ ุจูุง ูููุฆุฉ ุงูุญุงููุฉ
    const allowedControls = CONTROL_VISIBILITY_CONFIG[selectedTemplateCategory] || [];

    // ุฅุฎูุงุก ุฌููุน ุนูุงุตุฑ ุงูุชุญูู ุฃููุงู
    document.querySelectorAll('#color-picker-container [data-control-for]').forEach(control => {
        control.style.display = 'none';
    });

    // ุฅุธูุงุฑ ุนูุงุตุฑ ุงูุชุญูู ุงููุณููุญ ุจูุง ููุท
    allowedControls.forEach(controlName => {
        const controlElement = document.querySelector(`#color-picker-container [data-control-for="${controlName}"]`);
        if (controlElement) {
            controlElement.style.display = 'block'; // ุฃู 'flex' ุฅุฐุง ูุงู ูุณุชุฎุฏู flexbox
        }
    });
}

/**
 * ุชุชุญูู ูู ุฅุธูุงุฑ ุฃู ุฅุฎูุงุก ุฎูุงุฑ "ุงูุชุฏุฑุฌ" ุจูุงุกู ุนูู ูุฆุฉ ุงููุงูุจ ุงูุญุงููุฉ.
 */
function updateControlsForCategory() {
    const cvContainer = document.getElementById('cv-container');
    if (!cvContainer) return;

    const isAdvancedCategory = cvContainer.classList.contains('professional-layout') ||
                               cvContainer.classList.contains('ast-layout') ||
                               cvContainer.classList.contains('creative-layout');

    document.querySelectorAll('.gradient-toggle-wrapper').forEach(wrapper => {
        wrapper.style.display = isAdvancedCategory ? 'flex' : 'none';
        
        // ุฅุฐุง ูุงูุช ุงููุฆุฉ ุจุณูุทุฉุ ุชุฃูุฏ ูู ุฅููุงู ุงูุชุฏุฑุฌ ูุฅุนุงุฏุฉ ุงููุงุฌูุฉ ููุญุงูุฉ ุงูุงูุชุฑุงุถูุฉ
        if (!isAdvancedCategory) {
            const toggle = wrapper.querySelector('.gradient-toggle');
            if (toggle.checked) {
                toggle.checked = false;
                // ูู ุจุชุดุบูู ุญุฏุซ "change" ูุฏูููุง ูุชุญุฏูุซ ุงููุงุฌูุฉ
                toggle.dispatchEvent(new Event('change'));
            }
        }
    });
}

document.addEventListener('DOMContentLoaded', () => {
    // โญ ุชู ุชุตุญูุญ ุทุฑููุฉ ุงูุนุซูุฑ ุนูู ุงูุนูุงุตุฑ ููุง
    loadingOverlayGlobal = document.getElementById('loading-overlay');
    loadingTextGlobal = document.querySelector('#loading-overlay p'); // ุงุณุชุฎุฏููุง ูุญุฏุฏ ุฃุจุณุท ูุฃูุซุฑ ุฏูุฉ

    // ุจููุฉ ุงูููุฏ ูู ูุฐุง ุงูุฌุฒุก ูุจูู ููุง ูู
    createPaletteControls();
    loadCvDataFromLocalStorage();
    updateControlsForCategory();
    applySelectedColors();
    setupColorControls();
    setupDynamicControlListeners();
    
    document.getElementById('color-picker-header-text').addEventListener('input', applySelectedColors);
    document.getElementById('color-picker-title-text').addEventListener('input', applySelectedColors);
    document.getElementById('color-picker-body-text').addEventListener('input', applySelectedColors);
    document.getElementById('color-picker-subtle-text').addEventListener('input', applySelectedColors);
    
    const nameFontSelector = document.getElementById('font-selector-name');
    const headingsFontSelector = document.getElementById('font-selector-headings');
    const bodyFontSelector = document.getElementById('font-selector-body');

    if (nameFontSelector) nameFontSelector.addEventListener('change', applySelectedFonts);
    if (headingsFontSelector) headingsFontSelector.addEventListener('change', applySelectedFonts);
    if (bodyFontSelector) bodyFontSelector.addEventListener('change', applySelectedFonts);

    document.addEventListener('keydown', function(event) {
        if ((event.ctrlKey || event.metaKey) && event.key === 'p') {
            event.preventDefault();
            console.log("Ctrl+P pressed. Triggering custom print dialog.");
            window.print();
        }
    });

    const promoBar = document.getElementById('promo-bar');
    if (promoBar) {
        const promoBarHeight = promoBar.offsetHeight;
        document.body.style.paddingTop = `${promoBarHeight}px`;
    }

    siteHeaderGlobal = document.querySelector('.site-header');
    cvContainer = document.getElementById('cv-container');

    paymentNameInput = document.getElementById("payment-name");
    paymentEmailInput = document.getElementById("payment-email");
    paymentPhoneInput = document.getElementById("payment-phone");
    paymentMessagesInput = document.getElementById("payment-messages");
    paymentFileInput = document.getElementById("payment-file");
    qrPaymentResultDiv = document.getElementById("qr-payment-result");
    submitPaymentProofButton = document.getElementById("submit-payment-proof");
    document.getElementById('lemon-squeezy-btn').addEventListener('click', handleLemonSqueezyPurchase);

    document.getElementById('remove-discount-btn').addEventListener('click', (e) => {
        e.preventDefault();
        removeDiscount();
    });
    
    if (submitPaymentProofButton) {
        submitPaymentProofButton.addEventListener('click', submitPaymentProof);
    }

    const cvDataEntryPage = document.getElementById('cv-data-entry-page');
    if (cvDataEntryPage) {
        cvDataEntryPage.addEventListener('input', () => {
            saveCvDataToLocalStorage();
        }, true);
    }

    setInitialLanguage();
    initializeDiscountCards();
    populateFontSelectors();
    startSalesNotifications();
    updateCounters();
    updateLanguage();
    showPage('landing-page');
    lazyLoadImages();
});

function addCustomSection() {
    let customSectionsContainer = document.getElementById('custom-sections-container');
    if (!customSectionsContainer) {
        customSectionsContainer = document.createElement('div');
        customSectionsContainer.id = 'custom-sections-container';
        const formNavigationButtons = document.getElementById('form-navigation-buttons');
        formNavigationButtons.parentNode.insertBefore(customSectionsContainer, formNavigationButtons);
    }

    const sectionWrapper = document.createElement('div');
    sectionWrapper.className = 'custom-section-wrapper mb-3 p-3 border rounded';

    const titleInput = document.createElement('input');
    titleInput.type = 'text';
    titleInput.placeholder = translations[currentLang]['custom_section_placeholder'];
    titleInput.className = 'form-control form-control-lg mb-2 custom-section-title';
    titleInput.oninput = () => generateCV(document.getElementById('cv-container'));

    const subSectionsContainer = document.createElement('div');
    subSectionsContainer.className = 'sub-sections-container';

    const buttonContainer = document.createElement('div');
    buttonContainer.className = 'mt-2';

    const addSubSectionButton = document.createElement('button');
    addSubSectionButton.type = 'button';
    addSubSectionButton.className = 'btn btn-sm btn-outline-primary me-2';
    addSubSectionButton.innerHTML = translations[currentLang]['add_subsection_btn'];
    
    // --- ุชุนุฏูู: ุจูุงุก ุงูุนูุงุตุฑ ุงููุฑุนูุฉ ุจุฑูุฌูุงู ุฃูุถุงู ---
    addSubSectionButton.onclick = function() {
        const subSectionEntry = document.createElement('div');
        subSectionEntry.className = 'custom-subsection-entry border p-2 mb-2 rounded position-relative';

        const removeSubButton = document.createElement('button');
        removeSubButton.type = 'button';
        removeSubButton.className = 'remove-field';
        removeSubButton.innerHTML = '&times;';
        removeSubButton.title = translations[currentLang]['remove_subsection_title'];
        removeSubButton.onclick = () => { subSectionEntry.remove(); generateCV(document.getElementById('cv-container')); };

        const subTitleInput = document.createElement('input');
        subTitleInput.type = 'text';
        subTitleInput.className = 'form-control mb-2 custom-subsection-title';
        subTitleInput.placeholder = translations[currentLang]['subsection_title_placeholder'];
        subTitleInput.oninput = () => generateCV(document.getElementById('cv-container'));

        const subDescriptionTextarea = document.createElement('textarea');
        subDescriptionTextarea.className = 'form-control custom-subsection-description';
        subDescriptionTextarea.placeholder = translations[currentLang]['subsection_desc_placeholder'];
        subDescriptionTextarea.rows = 3;
        subDescriptionTextarea.oninput = () => generateCV(document.getElementById('cv-container'));

        subSectionEntry.appendChild(removeSubButton);
        subSectionEntry.appendChild(subTitleInput);
        subSectionEntry.appendChild(subDescriptionTextarea);
        subSectionsContainer.appendChild(subSectionEntry);
    };

    const removeSectionButton = document.createElement('button');
    removeSectionButton.type = 'button';
    removeSectionButton.className = 'btn btn-sm btn-danger';
    removeSectionButton.textContent = translations[currentLang]['remove_section_btn'];
    removeSectionButton.onclick = function() {
        if (confirm(translations[currentLang]['confirm_delete_section'])) {
            sectionWrapper.remove();
            generateCV(document.getElementById('cv-container'));
        }
    };
    
    buttonContainer.appendChild(addSubSectionButton);
    buttonContainer.appendChild(removeSectionButton);

    sectionWrapper.appendChild(titleInput);
    sectionWrapper.appendChild(subSectionsContainer);
    sectionWrapper.appendChild(buttonContainer);
    
    customSectionsContainer.appendChild(sectionWrapper);
    addSubSectionButton.click();
    sectionWrapper.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function updateTemplateImageSources() {
    const templateImages = document.querySelectorAll('.template-preview');
    console.log("Updating template image sources for language:", currentLang); // Debug
    templateImages.forEach(img => {
        const templateId = parseInt(img.getAttribute('data-template-id'));
        const templateCategory = img.getAttribute('data-template-category');
        if (!isNaN(templateId) && translations[currentLang]["image-paths"][templateCategory]) {
            const newSrc = translations[currentLang]["image-paths"][templateCategory](templateId);
            img.src = newSrc;
            console.log(`Setting image src for id ${templateId} (${templateCategory}) to: ${newSrc}`); // Debug
        } else {
            console.warn(`Could not set src for image. templateId: ${templateId}, category: ${templateCategory}, lang: ${currentLang}`); // Debug
        }
    });
}
/**
 * =========================================================================
 * == ุฏุงูุฉ setInitialLanguage ุงููุนุฏูุฉ - ุจุฏูู ุฅุนุงุฏุฉ ุชูุฌูู ุชููุงุฆูุฉ ูููุณุชุฎุฏู ==
 * =========================================================================
 * ุชุญุฏุฏ ุงููุบุฉ ุงูุฃูููุฉ ูููููุน ุจูุงุกู ุนูู ุงูู URL ุฃู ุงุฎุชูุงุฑ ุงููุณุชุฎุฏู ุงูุณุงุจูุ
 * ูุชุชุฌุงูู ูุบุฉ ุงููุชุตูุญ ุชูุงููุง ูุชุฌูุจ ุฅุนุงุฏุฉ ุงูุชูุฌูู ุงูุชููุงุฆู.
 */
function setInitialLanguage() {
    const userChosenLang = sessionStorage.getItem('userLang');
    const path = window.location.pathname;

    // 1. ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุฏ ุงุฎุชุงุฑ ูุบุฉ ุจุงููุนู (ูู ุงูุฒุฑ ูุซูุงู)ุ ุงุณุชุฎุฏููุง ููุฑูุง
    if (userChosenLang) {
        currentLang = userChosenLang;
        return;
    }

    // 2. ุชุญุฏูุฏ ุงููุบุฉ ุจูุงุกู ุนูู ุงูู URL ุงูุญุงูู ููุท
    // ุฅุฐุง ูุงูุช ุงูุตูุญุฉ ุชูุชูู ุจู 'en.html'ุ ุชููู ุงููุบุฉ ุฅูุฌููุฒูุฉ
    if (path.endsWith('en.html')) {
        currentLang = 'en';
    }
    // ุฅุฐุง ูุงูุช ุงูุตูุญุฉ ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ (index.html ุฃู ุงููุณุงุฑ ุงูุฌุฐุฑู '/'), ุชููู ุงููุบุฉ ุนุฑุจูุฉ
    else if (path.endsWith('index.html') || path.endsWith('/')) {
        currentLang = 'ar';
    }
    // ูู ุฃู ุญุงูุฉ ุฃุฎุฑู (ูุซูุงูุ ุฅุฐุง ูุงู URL ุบูุฑ ูุชููุน)ุ ุงุฌุนู ุงููุบุฉ ุนุฑุจูุฉ ูุงูุชุฑุงุถู
    else {
        currentLang = 'ar';
    }

    // 3. (ุงุฎุชูุงุฑู) ุฅุฐุง ููุช ุชุฑูุฏ ุญูุธ ูุฐู ุงููุบุฉ ุงูุงูุชุฑุงุถูุฉ ูู sessionStorage
    // ูููุน ุฅุนุงุฏุฉ ุงูุญุณุงุจ ุนูุฏ ูู ุชุญููู ููุตูุญุฉ ูููุณ ุงูุฌูุณุฉ
    sessionStorage.setItem('userLang', currentLang);

    console.log(`[setInitialLanguage] Language set to: ${currentLang}`);
}

/**
 * ุฏุงูุฉ ูุฑูุฒูุฉ ูุชุญุฏูุซ ุนุฑุถ ุงูุฃุณุนุงุฑ ูู ุตูุญุฉ ุงูุฏูุน.
 * ุชููู ุจุญุณุงุจ ุงูุฃุณุนุงุฑ ุจุนุฏ ุงูุฎุตู ูุนุฑุถูุง ุฏุงุฆูุงู ุจุงูุฑูุงู ุงูุณุนูุฏู.
 */
function updateAllPriceDisplays() {
    const category = selectedTemplateCategory;
    if (!category) return;

    // ุงูุฃุณุนุงุฑ ุจุงูุฑูุงู ุงูุณุนูุฏู ุฏุงุฆูุงู
    const originalLocalPrice = PRICES.local[category];
    const originalLsPrice = PRICES.lemonSqueezy[category];

    // ุญุณุงุจ ุงูุฃุณุนุงุฑ ุงูููุงุฆูุฉ ุจูุงุกู ุนูู ูุณุจุฉ ุงูุฎุตู ุงููุทุจูุฉ
    const finalLocalPrice = Math.max(0, Math.round(originalLocalPrice * (1 - discountApplied / 100)));
    const finalLsPrice = Math.max(0, Math.round(originalLsPrice * (1 - discountApplied / 100)));

    // ุชุญุฏูุซ ูุงุฌูุฉ ุงูุฏูุน ุงููุญูู
    const localPriceElement = document.getElementById('local-price-display');
    const localCurrencyElement = localPriceElement.nextElementSibling;
    if (localPriceElement) {
        if (discountApplied > 0 && finalLocalPrice < originalLocalPrice) {
            // ุนุฑุถ ุงูุณุนุฑ ุงูุฃุตูู ูุดุทูุจุงู ุจุฌุงูุจ ุงูุณุนุฑ ุงูุฌุฏูุฏ
            localPriceElement.innerHTML = `<del style="color: #999; font-size: 0.8em;">${originalLocalPrice}</del> ${finalLocalPrice}`;
        } else {
            localPriceElement.textContent = originalLocalPrice;
        }
        // ุชุญุฏูุซ ุฑูุฒ ุงูุนููุฉ (ุณููุฑุฃ ุงูุขู "SAR" ุฃู "ุฑูุงู ุณุนูุฏู" ุจุดูู ุตุญูุญ)
        if (localCurrencyElement) {
            localCurrencyElement.textContent = translations[currentLang]['sar-currency'];
        }
    }

    // ุชุญุฏูุซ ูุงุฌูุฉ ุงูุฏูุน ุนุจุฑ Lemon Squeezy
    const lsPriceElement = document.getElementById('ls-price-display');
    const lsCurrencyElement = lsPriceElement.nextElementSibling;
    if (lsPriceElement) {
        if (discountApplied > 0 && finalLsPrice < originalLsPrice) {
            lsPriceElement.innerHTML = `<del style="color: #999; font-size: 0.8em;">${originalLsPrice}</del> ${finalLsPrice}`;
        } else {
            lsPriceElement.textContent = originalLsPrice;
        }
        // ุชุญุฏูุซ ุฑูุฒ ุงูุนููุฉ
        if (lsCurrencyElement) {
            lsCurrencyElement.textContent = translations[currentLang]['sar-currency'];
        }
    }

    // ุชุญุฏูุซ ุงููุชุบูุฑ ุงูุนุงู ุงูุฐู ุณููุณุชุฎุฏู ุนูุฏ ุงูุฏูุน ุงููุฏูู
    finalPriceToPay = finalLocalPrice;
}
function toggleSiteHeader(show) {
    if (siteHeaderGlobal) {
        siteHeaderGlobal.style.display = show ? 'flex' : 'none';
    }
}

function startSalesNotifications() {
    const notificationElement = document.getElementById('sales-notification');
    const nameElement = document.getElementById('sales-name');
    const cityElement = document.getElementById('sales-city');

    if (!notificationElement || !nameElement || !cityElement) return;

    // ุฌูุจ ุจูุงูุงุช ุญููููุฉ ูุชุญุฏูุซ ุงููุงุฆูุฉ
    fetchRecentSales();

    setInterval(() => {
        if (salesQueue.length === 0) return;

        // ุงุฎุชูุงุฑ ุนูุตุฑ ุนุดูุงุฆู ูุนุฑุถู
        const sale = salesQueue[Math.floor(Math.random() * salesQueue.length)];
        nameElement.textContent = sale.name;
        cityElement.textContent = sale.city;

        notificationElement.classList.add('show');

        // ุฅุฎูุงุก ุงูุฅุดุนุงุฑ ุจุนุฏ 5 ุซูุงูู
        setTimeout(() => {
            notificationElement.classList.remove('show');
        }, 5000);

    }, 8000); // ุนุฑุถ ุฅุดุนุงุฑ ุฌุฏูุฏ ูู 8 ุซูุงูู
}

async function fetchRecentSales() {
    try {
        const response = await fetch(`${GOOGLE_APPS_SCRIPT_WEB_APP_URL_PAYMENT_PROCESSOR}?action=getRecentSales`);
        const data = await response.json();
        if (data.status === 'success' && data.sales.length > 0) {
            salesQueue = data.sales; // ุชุญุฏูุซ ุงููุงุฆูุฉ ุจุงูุจูุงูุงุช ุงูุญููููุฉ
        }
    } catch (error) {
        console.error("Could not fetch recent sales:", error);
    }
}

function toggleLoadingOverlay(show, messageKey = 'Generating CV, please wait...') {
    if (loadingOverlayGlobal && loadingTextGlobal) {
        if (show) {
            loadingTextGlobal.setAttribute('data-current-key', messageKey);
            loadingTextGlobal.textContent = translations[currentLang][messageKey] || messageKey;
            loadingOverlayGlobal.style.display = 'flex';
            console.log(`[toggleLoadingOverlay] SHOWN with message key: ${messageKey}`);
        } else {
            loadingOverlayGlobal.style.display = 'none';
            loadingTextGlobal.removeAttribute('data-current-key');
            console.log("[toggleLoadingOverlay] HIDDEN.");
        }
    } else {
        console.error("[toggleLoadingOverlay] loadingOverlayGlobal or loadingTextGlobal is null.");
    }
}

function updatePaymentOptionsUI(category) {
    if (!category || !PRICES.local[category] || !PRICES.lemonSqueezy[category]) {
        console.error("Invalid category or prices not defined for:", category);
        return;
    }

    // ุฌูุจ ุนูุงุตุฑ ุนุฑุถ ุงูุณุนุฑ ูู ุงูู HTML
    const localPriceElement = document.getElementById('local-price-display');
    const lsPriceElement = document.getElementById('ls-price-display');

    // ุชุญุฏูุซ ุงููุตูุต ุจุงูุฃุณุนุงุฑ ุงูุตุญูุญุฉ
    if (localPriceElement) {
        localPriceElement.textContent = PRICES.local[category];
    }
    if (lsPriceElement) {
        lsPriceElement.textContent = PRICES.lemonSqueezy[category];
    }
}

/**
 * ุฏุงูุฉ ูุฅูุบุงุก ุชุทุจูู ุฃู ุฎุตู ุญุงูู.
 */
function removeDiscount() {
    // 1. ุฅุนุงุฏุฉ ุชุนููู ูุชุบูุฑุงุช ุงูุฎุตู ุงูุนุงูุฉ
    discountApplied = 0;
    appliedCode = "";
    
    // 2. ูุณุญ ูููุฉ ุญูู ููุฏ ุงูุฎุตู ุงููุฎูู
    const codeInput = document.getElementById('discount-code');
    if (codeInput) codeInput.value = "";
    
    // 3. ุฅุฒุงูุฉ ุงูุชุญุฏูุฏ ูู ุฃู ุจุทุงูุฉ ุฎุตู ูุฎุชุงุฑุฉ
    document.querySelectorAll('.discount-card.selected').forEach(card => {
        card.classList.remove('selected');
    });

    // 4. ุชุญุฏูุซ ุนุฑุถ ุงูุฃุณุนุงุฑ ูุชุนูุฏ ุฅูู ูููุชูุง ุงูุฃุตููุฉ
    updateAllPriceDisplays();
    
    // 5. ุฅุฎูุงุก ุฒุฑ "ุฅุฒุงูุฉ ุงูุฎุตู" ููุณู
    document.getElementById('remove-discount-container').style.display = 'none';
}

// โ ุงุณุชุจุฏู ุงูุฏุงูุฉ ุงููุฏููุฉ ุจุงููุงูู ุจูุฐู ุงููุณุฎุฉ ุงููุจุณุทุฉ โ
function showPage(pageId) {
    const pages = document.querySelectorAll('.page-section');
    pages.forEach(page => {
        page.classList.remove('active-page');
    });

    const targetPage = document.getElementById(pageId);
    if (targetPage) {
        targetPage.classList.add('active-page');
        window.scrollTo(0, 0);
        toggleSiteHeader(pageId === 'landing-page');

        updatePageContentLanguage();

        // โญ ุงูุชุนุฏูู ุงูุฃุณุงุณู: ููุทู ุฐูู ูุชุญููู ุงูุจูุงูุงุช ุฃู ุนุฑุถ ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ
        if (pageId === 'cv-data-entry-page') {
            // ุฃููุงูุ ุญุงูู ุชุญููู ุงูุจูุงูุงุช ุงููุญููุธุฉ ูููุณุชุฎุฏู
            const dataWasLoaded = loadCvDataFromLocalStorage();

            // ุฅุฐุง ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃู ุจูุงูุงุช ูุญููุธุฉ ููุฐู ุงููุบุฉุ ูู ุจุนุฑุถ ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ
            if (!dataWasLoaded) {
                populateWithTestData();
            }
            
            // ูู ูู ุงูุฃุญูุงูุ ูู ุจุชุญุฏูุซ ุงููุนุงููุฉ ูุดุฑูุท ุงูุชูุฏู
            generateCV(cvContainer);
            updateProgress();
        }
    } else {
        console.error(`[showPage] Target page with ID "${pageId}" not found.`);
    }
}

function toggleLanguage() {
    currentLang = currentLang === 'ar' ? 'en' : 'ar';
    console.log(`[toggleLanguage] Language toggled to: ${currentLang}`);
    updateLanguage();
    updateCounters(); 
    if (cvContainer && (document.getElementById('cv-preview-page').classList.contains('active-page') ||
                        document.getElementById('cv-template-selection-page').classList.contains('active-page') ||
                        document.getElementById('cv-data-entry-page').classList.contains('active-page'))) {
        generateCV(cvContainer);
    }
}

function updateLanguage() {
    const isArabic = currentLang === 'ar';
    document.documentElement.lang = currentLang;
    document.documentElement.dir = isArabic ? 'rtl' : 'ltr';

    if (cvContainer) {
        cvContainer.dir = isArabic ? 'rtl' : 'ltr';
    }

    document.body.classList.toggle('rtl', isArabic);
    document.body.classList.toggle('ltr', !isArabic);

    updateNavbarLinks();
    updatePageContentLanguage();
    updateTemplateImageSources();
    // ุฅุนุงุฏุฉ ุชุญููู PayPal SDK ุนูุฏ ุชุบููุฑ ุงููุบุฉ
    populateFontSelectors();
    setupLanguageToggle();
    updateTranslationsForPalette();


    // **ุฃุถู ูุฐุง ุงูุณุทุฑ:**
    // ูู ุจุฅุนุงุฏุฉ ุชุนุจุฆุฉ ุงูุจูุงูุงุช ุงููุชุฑุฌูุฉ ุฅุฐุง ูุงูุช ูู ุตูุญุฉ ุฅุฏุฎุงู ุงูุจูุงูุงุช
    if (document.getElementById('cv-data-entry-page')?.classList.contains('active-page')) {
         // ุณุชููู ูุฐู ุงูุฏุงูุฉ ุจุฅุนุงุฏุฉ ุชุนุจุฆุฉ ุงูุญููู ุจุงูุจูุงูุงุช ุงููุชุฑุฌูุฉ
    }
}

function updateNavbarLinks() {
    const links = document.querySelectorAll('nav [data-translate]');
    links.forEach(link => {
        const key = link.getAttribute('data-translate');
        if (translations[currentLang] && translations[currentLang][key] !== undefined) {
            link.textContent = translations[currentLang][key];
        }
    });
    const langToggleSpan = document.getElementById('currentLangText');
    if (langToggleSpan) {
        langToggleSpan.textContent = currentLang === 'ar' ? translations.en.English : translations.ar.ุงูุนุฑุจูุฉ;
    }
}

// ุงุณุชุจุฏู ุงูุฏุงูุฉ ุจุงููุงูู ุจูุฐู ุงููุณุฎุฉ ุงููุตุญุญุฉ
function updatePageContentLanguage() {
    const isArabic = currentLang === 'ar';
    const allTranslatableElements = document.querySelectorAll('[data-en], [data-ar], [data-translate-id], [data-translate]');

    if (loadingOverlayGlobal && loadingOverlayGlobal.style.display === 'flex' && loadingTextGlobal) {
        const currentMessageKey = loadingTextGlobal.getAttribute('data-current-key') || 'Generating CV, please wait...';
        loadingTextGlobal.textContent = translations[currentLang][currentMessageKey] || currentMessageKey;
    }

    allTranslatableElements.forEach(element => {
        let newContent = null;
        const translateIdKey = element.getAttribute('data-translate-id');
        const translateKey = element.getAttribute('data-translate');

        if (translateIdKey && translations[currentLang] && translations[currentLang][translateIdKey] !== undefined) {
            newContent = translations[currentLang][translateIdKey];
        } else if (translateKey && translations[currentLang] && translations[currentLang][translateKey] !== undefined) {
            newContent = translations[currentLang][translateKey];
        } else {
            const textKeyAttr = isArabic ? element.getAttribute('data-ar') : element.getAttribute('data-en');
            if (textKeyAttr) {
                if (translations[currentLang] && translations[currentLang][textKeyAttr] !== undefined) {
                    newContent = translations[currentLang][textKeyAttr];
                } else {
                    newContent = textKeyAttr;
                }
            }
        }

        if (newContent !== null) {
            if (Array.isArray(newContent) && element.tagName === 'UL') {
                let listHtml = '';
                newContent.forEach(itemHtml => {
                    listHtml += `<li>${itemHtml}</li>`;
                });
                element.innerHTML = listHtml;
            } else if (typeof newContent === 'string') {
                
                // --- ุจุฏุงูุฉ ุงูุชุนุฏูู ุงูุฌููุฑู ---
                // ูุณุชุฎุฏู ุชุนุจูุฑุงู ููุทูุงู ููุชุญูู ูู ูุฌูุฏ ุฃู ูุณู HTML ูู ุงููุต
                const containsHtml = /<[a-z][\s\S]*>/i.test(newContent);

                if (containsHtml) {
                    // ุฅุฐุง ูุงู ุงููุต ูุญุชูู ุนูู HTMLุ ุงุณุชุฎุฏู innerHTML ูุชูุณูุฑู
                    element.innerHTML = newContent;
                } else {
                    // ุฅุฐุง ูุงู ุงููุต ุนุงุฏูุงูุ ุงุณุชุฎุฏู textContent (ุฃูุซุฑ ุฃูุงูุงู)
                    if (element.tagName !== 'IMG' && element.tagName !== 'INPUT' && element.tagName !== 'TEXTAREA') {
                        element.textContent = newContent;
                    }
                }
                // --- ููุงูุฉ ุงูุชุนุฏูู ุงูุฌููุฑู ---

            }
        }
    });

    // ... ุจุงูู ุฃุฌุฒุงุก ุงูุฏุงูุฉ (placeholder, alt, links) ุชุจูู ููุง ูู ุฏูู ุชุบููุฑ ...
    const placeholderElements = document.querySelectorAll('[data-en-placeholder], [data-ar-placeholder]');
    placeholderElements.forEach(element => {
        const placeholderKey = isArabic ? element.getAttribute('data-ar-placeholder') : element.getAttribute('data-en-placeholder');
        if (placeholderKey && translations[currentLang] && translations[currentLang][placeholderKey] !== undefined) {
            element.placeholder = translations[currentLang][placeholderKey];
        } else if (placeholderKey) {
            element.placeholder = placeholderKey;
        }
    });

    const altElements = document.querySelectorAll('[data-en-alt], [data-ar-alt]');
    altElements.forEach(element => {
        if (element.tagName === 'IMG') {
            const altKey = isArabic ? element.getAttribute('data-ar-alt') : element.getAttribute('data-en-alt');
            if (altKey && translations[currentLang] && translations[currentLang][altKey] !== undefined) {
                element.alt = translations[currentLang][altKey];
            } else if (altKey) {
                element.alt = altKey;
            }
        }
    });

    const footerLinks = document.querySelectorAll('footer .list-inline-item a');
    footerLinks.forEach(link => {
        const key = link.getAttribute('data-translate');
        if (key && translations[currentLang] && translations[currentLang][key] !== undefined) {
            link.textContent = translations[currentLang][key];
        }
    });

    const contactEmailLinks = document.querySelectorAll('#contact p strong a, #terms-of-service-page a[href^="mailto:"], #refund-policy a[href^="mailto:"], #privacy-policy a[href^="mailto:"]');
    contactEmailLinks.forEach(link => {
        let key;
        if (link.closest('#contact')) {
            key = 'email-address-contact';
        } else if (link.closest('#terms-of-service-page')) {
            key = 'terms-of-service-email-contact';
        } else if (link.closest('#refund-policy')) {
            key = 'refund-policy-email-contact';
        } else if (link.closest('#privacy-policy')) {
            key = 'privacy-policy-email-contact';
        }
        if (key && translations[currentLang] && translations[currentLang][key] !== undefined) {
            link.textContent = translations[currentLang][key];
        }
    });

    if (document.getElementById('payment-options-page')?.classList.contains('active-page')) {
        updateAllPriceDisplays(); // ุชู ุงูุชุนุฏูู ูุงุณุชุฏุนุงุก ุงูุฏุงูุฉ ุงูุตุญูุญุฉ
    }
}   

function collectCvData() {
    // ูุฐู ุงูุฏุงูุฉ ุชุฌูุน ูู ุงูุจูุงูุงุช ูู ุญููู ุงูุฅุฏุฎุงู ูุชุนูุฏูุง ููุงุฆู ูุงุญุฏ
    const cvData = {
        name: document.getElementById('name-input')?.value.trim(),
        jobTitle: document.getElementById('title-input')?.value.trim(),
        email: document.getElementById('email-input')?.value.trim(),
        phone: document.getElementById('phone-input')?.value.trim(),
        website: document.getElementById('website-input')?.value.trim(),
        profilePicDataUrl: profilePicDataUrl,
        objective: document.getElementById('objective-input')?.value.trim(),
        experiences: getExperiencesData(),
        educations: getEducationsData(),
        skills: getSkillsData(),
        languages: getLanguagesData(),
        references: getReferencesData(),
        templateCategory: selectedTemplateCategory,
        templateNumber: selectedTemplate,
        language: currentLang,
        // ูุง ููุฑุฑ isPaid ููุงุ ุณูุชู ุชุญุฏูุฏูุง ูุงุญููุง
        templateCss: getSelectedTemplateCss() // ุฅุฑุณุงู ุงูู CSS ุงููุญุฏุฏ
    };
    return cvData;
}

// ุงุณุชุจุฏู ุงูุฏุงูุฉ ุงููุฏููุฉ ุจุงููุงูู ุจูุฐู ุงููุณุฎุฉ ุงููุตุญุญุฉ
async function handleLemonSqueezyPurchase() {
    toggleLoadingOverlay(true, 'Preparing secure payment...');
    try {
        // 1. ุฌูุน ุจูุงูุงุช ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ
        const cvData = collectCvData();
        
        // 2. ุงุณุชุฏุนุงุก ุงูุฎุงุฏู ูุชุญุถูุฑ ุงูุฌูุณุฉ ูุชุฎุฒูู ุงูุจูุงูุงุช ูุคูุชุงู
        const prepareResponse = await fetch(`${NODE_SERVER_URL}/api/prepare-checkout`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(cvData)
        });

        if (!prepareResponse.ok) {
            const errorText = await prepareResponse.text();
            throw new Error(`Server failed to prepare session: ${errorText}`);
        }
        
        const { sessionId } = await prepareResponse.json();

        if (!sessionId) {
            throw new Error('Could not retrieve session ID from the server.');
        }

        // 3. ุงุญุตู ุนูู ุฑุงุจุท ุงูุฏูุน ุงูุฃุณุงุณู ูู ูุงุฆู ุงูุฅุนุฏุงุฏุงุช
        const checkoutConfig = CHECKOUT_CONFIG[selectedTemplateCategory];
        if (!checkoutConfig || !checkoutConfig.link) {
            throw new Error('Checkout link for the selected category is not configured.');
        }

        // --- ุจุฏุงูุฉ ุงูุชุนุฏูู: ุชู ุฅุนุงุฏุฉ ุชุฑุชูุจ ูุฐุง ุงูุฌุฒุก ---

        // 4. ุฃูุดุฆ ุงูุฑุงุจุท ุฃููุงู
        const finalUrl = new URL(checkoutConfig.link);
        
        // 5. ุฃุถู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ููุฑุงุจุท (ูุนุฑู ุงูุฌูุณุฉุ ุงูุจุฑูุฏ ุงูุฅููุชุฑูููุ ุงูุงุณู)
        finalUrl.searchParams.set('checkout[custom][session_id]', sessionId);
        
        if (cvData.email) {
            finalUrl.searchParams.set('checkout[email]', cvData.email);
        }
        if (cvData.name) {
            finalUrl.searchParams.set('checkout[name]', cvData.name);
        }
        
        // 6. ุงูุขูุ ุจุนุฏ ุฅูุดุงุก ุงูุฑุงุจุทุ ุชุญูู ูู ูุฌูุฏ ููุฏ ุฎุตู ูุฃุถูู
        const codeInput = document.getElementById("discount-code");
        const code = codeInput ? codeInput.value.trim() : "";
        if (code) {
            // ูุฐุง ุงูุณุทุฑ ุงูุขู ูุนูู ุจุดูู ุตุญูุญ ูุฃู finalUrl ููุฌูุฏ ุจุงููุนู
            finalUrl.searchParams.set('discount_code', code); // ุงูุชุบููุฑ ููุง: ูู 'discount' ุฅูู 'discount_code'
        }
        
        // --- ููุงูุฉ ุงูุชุนุฏูู ---

        // 7. ูุฌู ุงููุณุชุฎุฏู ุฅูู ุตูุญุฉ ุงูุฏูุน ุงูููุงุฆูุฉ ูู Lemon Squeezy
        console.log('Redirecting to Lemon Squeezy:', finalUrl.toString());
        window.location.href = finalUrl.toString();

    } catch (error) {
        console.error('Lemon Squeezy purchase error:', error);
        alert('An error occurred while preparing your payment. Please try again or contact support.');
        toggleLoadingOverlay(false);
    }
}


/**
 * ุฏุงูุฉ ูุฌูุจ ูุชุญุฏูุซ ุนุฏุงุฏ ุงูุณูุฑ ุงูุฐุงุชูุฉ ูุนุฏุงุฏ ุงูุฒูุงุฑ
 * ูุน ุฏุนู ุงููุบุชูู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ
 */
async function updateCounters() {
  const cvCounterElement = document.getElementById('cv-counter-span');
  const visitorCounterElement = document.getElementById('visitor-counter-span');

  // ูุชุฃูุฏ ูู ูุฌูุฏ ุงูุนูุงุตุฑ ูู ุงูุตูุญุฉ ูุจู ุฅุฑุณุงู ุงูุทูุจ
  if (!cvCounterElement || !visitorCounterElement) {
    return;
  }

  try {
    // ูุณุชุฎุฏู ููุณ ุฑุงุจุท ุงูู Web App ููู ูุน ุฅุถุงูุฉ ูุนุงูู 'action'
    const response = await fetch(`${GOOGLE_APPS_SCRIPT_WEB_APP_URL_PAYMENT_PROCESSOR}?action=getCounters`);
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    const data = await response.json();

    if (data.status === 'success') {
      // --- ุจุฏุงูุฉ ุงูุชุนุฏูู ุงูุฌููุฑู ---

      // 1. ุชุญุฏูุฏ ูุบุฉ ุชูุณูู ุงูุฃุฑูุงู ุจูุงุกู ุนูู ูุชุบูุฑ ุงููุบุฉ ุงูุญุงูู
      const locale = currentLang === 'ar' ? 'ar-EG' : 'en-US';

      // 2. ุชุญุฏูุซ ุนุฏุงุฏ ุงูุณูุฑ ุงูุฐุงุชูุฉ ุจุงุณุชุฎุฏุงู ุงูุชูุณูู ุงูุตุญูุญ
      cvCounterElement.textContent = `+${data.cvCount.toLocaleString(locale)}`;

      // 3. ุชุญุฏูุซ ุนุฏุงุฏ ุงูุฒูุงุฑ ุจุงุณุชุฎุฏุงู ุงูุชูุณูู ุงูุตุญูุญ
      visitorCounterElement.textContent = `+${data.visitorCount.toLocaleString(locale)}`;
      
      // --- ููุงูุฉ ุงูุชุนุฏูู ุงูุฌููุฑู ---
    }
  } catch (error) {
    console.error('Failed to fetch counters:', error);
    // ูู ุญุงู ูุดู ุงูุทูุจุ ุชุจูู ุงูุฃุฑูุงู ุงูุงูุชุฑุงุถูุฉ ููุง ูู
  }
}



function lazyLoadImages() {
    const lazyImages = document.querySelectorAll('img[data-src]');
    if ('IntersectionObserver' in window) {
        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const lazyImage = entry.target;
                    lazyImage.src = lazyImage.dataset.src;
                    if (lazyImage.dataset.srcset) {
                        lazyImage.srcset = lazyImage.dataset.srcset;
                    }
                    lazyImage.removeAttribute('data-src');
                    lazyImage.removeAttribute('data-srcset');
                    observer.unobserve(lazyImage);
                }
            });
        }, { rootMargin: '0px 0px 200px 0px', threshold: 0.01 });
        lazyImages.forEach(image => { observer.observe(image); });
    } else {
        lazyImages.forEach(image => {
            image.src = image.dataset.src;
            if (image.dataset.srcset) { image.srcset = image.dataset.srcset; }
            image.removeAttribute('data-src');
            image.removeAttribute('data-srcset');
        });
    }
}

/**
 * ููุชูู ุฅูู ุตูุญุฉ ุงุฎุชูุงุฑ ุงููุงูุจ.
 * ุชู ุชุนุทูู ุงูุชุญูู ุงูุตุงุฑู ููุณูุงุญ ูููุณุชุฎุฏู ุจุงูุงูุชูุงู ุญุชู ูุน ูุฌูุฏ ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ.
 */
function validateAndShowTemplatePage() {
    
    // ุชู ุชุนุทูู ุงูุชุญูู ูู ูุฐู ุงููุฑุญูุฉ ุนูุฏุงู.
    // ุจูุง ุฃููุง ูุนุฑุถ ูุนุงููุฉ ูุงููุฉ ุจุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉุ ูููู ูููุณุชุฎุฏู
    // ุงุณุชุนุฑุงุถ ุงูููุงูุจ ุงููุฎุชููุฉ ุซู ุงูุนูุฏุฉ ูุงุญูุงู ูููุก ุจูุงูุงุชู ุงูุฎุงุตุฉ.
    /* const name = document.getElementById('name-input');
    const title = document.getElementById('title-input');
    const email = document.getElementById('email-input');

    if (!name.value.trim() || !title.value.trim() || !email.value.trim()) {
        // ุฑุณุงูุฉ ุงูุชูุจูู ุงูุชู ุชุธูุฑ ูู
        alert(translations[currentLang]['Please fill in all fields.'] || 'Please fill in the basic fields (Name, Job Title, Email) before proceeding.');
        return;
    }
    */
    
    // ุงูุขูุ ุณููุชูู ูุจุงุดุฑุฉ ุฅูู ุตูุญุฉ ุงูููุงูุจ ุฏูู ุฅุธูุงุฑ ุฑุณุงูุฉ ุงูุชูุจูู
    showPage('cv-template-selection-page');
}

function initializeDiscountCards() {
    const discountCards = document.querySelectorAll('.discount-card');
    const codeInput = document.getElementById('discount-code');

    discountCards.forEach(card => {
        card.addEventListener('click', () => {
            // ุฅุฒุงูุฉ ุงูุชุญุฏูุฏ ูู ูู ุงูุจุทุงูุงุช
            discountCards.forEach(c => c.classList.remove('selected'));
            // ุฅุถุงูุฉ ุงูุชุญุฏูุฏ ููุจุทุงูุฉ ุงููุฎุชุงุฑุฉ
            card.classList.add('selected');
            
            const code = card.getAttribute('data-code');
            codeInput.value = code; // ุชุนุจุฆุฉ ุงูุญูู ุงููุฎูู
            applyDiscountCode(); // ุงุณุชุฏุนุงุก ุฏุงูุฉ ุชุทุจูู ุงูุฎุตู
        });
    });
}

/**
 * ูุนุงูุฌ ุงูุถุบุท ุนูู ุฒุฑ "ุชุทุจูู ุงูุฎุตู".
 * ูุญุฏูุซ ุงูุฃุณุนุงุฑ ุงููุนุฑูุถุฉ ูููุธูุฑ ุฑุณุงูุฉ ุฅุฑุดุงุฏูุฉ ูููุณุชุฎุฏู.
 */
async function applyDiscountCode() {
    const codeInput = document.getElementById("discount-code");
    if (!codeInput) return;
    const code = codeInput.value.trim().toUpperCase();

    if (code && discountCodes[code] !== undefined) {
        discountApplied = discountCodes[code];
        appliedCode = code;
        
        const alertMessage = currentLang === 'ar' ? 
            `ุชู ุชุทุจูู ููุฏ ุงูุฎุตู "${code}".\n\n- ุชู ุชุญุฏูุซ ุณุนุฑ ุงูุฏูุน ุงููุญูู.\n- ููุฏูุน ุจุงูุจุทุงูุฉุ ุงูุฑุฌุงุก ุฅุฏุฎุงู ููุณ ุงูููุฏ ูุฑุฉ ุฃุฎุฑู ูู ุตูุญุฉ ุงูุฏูุน ุงูุชุงููุฉ ูุชุฃููุฏ ุงูุฎุตู.` :
            `Discount code "${code}" applied.\n\n- The price for local payment has been updated.\n- For card payment, please re-enter the code on the next page to confirm your discount.`;
        alert(alertMessage);
        
        // --- ุชุนุฏูู: ุฅุธูุงุฑ ุฒุฑ ุงูุฅุฒุงูุฉ ---
        document.getElementById('remove-discount-container').style.display = 'block';

    } else if (code) {
        removeDiscount(); // ุฅุฐุง ูุงู ุงูููุฏ ุฎุงุทุฆุ ูู ุจุฅุฒุงูุฉ ุฃู ุฎุตู ุณุงุจู
        alert(currentLang === 'ar' ? 'ููุฏ ุงูุฎุตู ุบูุฑ ุตุงูุญ.' : 'Invalid discount code.');
    } else {
        removeDiscount(); // ุฅุฐุง ูุงู ุงูุญูู ูุงุฑุบุงูุ ูู ุจุฅุฒุงูุฉ ุฃู ุฎุตู ุณุงุจู
    }
    
    updateAllPriceDisplays();

    // ุงูุชุญูู ููุง ุฅุฐุง ูุงู ุงูุณุนุฑ ุฃุตุจุญ ูุฌุงููุงู ุจุนุฏ ุงูุชุญุฏูุซ
    if (finalPriceToPay === 0 && discountApplied > 0) {
        alert(currentLang === 'ar' ? 'ูุฐู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ูุฌุงููุฉ! ุณูุชู ุฅุฑุณุงููุง ุฅูู ุจุฑูุฏู ุงูุฅููุชุฑููู.' : 'This CV is free! It will be sent to your email shortly.');
        toggleLoadingOverlay(true, 'Processing your free CV...');
        try {
            const pdfData = await generatePdfFromNode(true);
            if (pdfData && pdfData.base64Pdf) {
                await sendPaymentDataToAppsScript('Discounted/Free', 0, pdfData.base64Pdf, null);
                showPage('landing-page');
            } else {
                throw new Error("Failed to generate PDF for free CV.");
            }
        } catch (error) {
            console.error("Error processing free CV:", error);
            alert("Error: " + error.message);
        } finally {
            toggleLoadingOverlay(false);
        }
    }
}

// --- Payment Related Functions (for UI) ---
// ุงุณุชุจุฏู ูุฐู ุงูุฏุงูุฉ ุจุงููุงูู
function openPaymentForCV_appsScript() {
    // ... ุงูููุฏ ุงูุญุงูู ูุฅุนุงุฏุฉ ุชุนููู ุงููุชุบูุฑุงุช ...
    discountApplied = 0;
    appliedCode = "";
    selectedPriceToPay = PRICES.local[selectedTemplateCategory];
    finalPriceToPay = selectedPriceToPay;
    
    document.querySelectorAll('.discount-card').forEach(c => c.classList.remove('selected'));
    
    const codeInput = document.getElementById("discount-code");
    if (codeInput) codeInput.value = "";

    // --- ุชุนุฏูู: ุงูุชุฃูุฏ ูู ุฅุฎูุงุก ุฒุฑ ุงูุฅุฒุงูุฉ ---
    document.getElementById('remove-discount-container').style.display = 'none';

    updateAllPriceDisplays();
    showPage('payment-options-page');
}

function updatePriceDisplay(discountedPrice) {
    const finalPriceText = document.getElementById("final-price-text");
    if (finalPriceText) {
        const currency = currentLang === 'ar' ? ' ุฑูุงู' : ' SAR';
        finalPriceText.textContent = (translations[currentLang]['messages'] || "Price Paid") + ": " + discountedPrice + currency;
    }
}

function getDiscountedPrice() {
    if (discountApplied > 0 && discountApplied <= 100) {
        return Math.max(0, Math.round(selectedPriceToPay * (1 - discountApplied / 100)));
    }
    return selectedPriceToPay;
}


/**
 * ูุนุงูุฌ ูุชุญ ุตูุญุฉ ุงูุฏูุน ุงููุฏูู (ุงูุฑุงุฌุญู ุฃู STC Pay).
 * ูุฐู ุงูุฏุงูุฉ ุงูุขู ูุณุคููุฉ ุนู ุญุณุงุจ ุงูุณุนุฑ ุงูููุงุฆู ุจูุงุกู ุนูู ููุฏ ุงูุฎุตู ุงููุฏุฎู ูู ูุญุธุฉ ุงูุถุบุท.
 * @param {string} method - ุทุฑููุฉ ุงูุฏูุน ุงููุฎุชุงุฑุฉ ('Rajhi' ุฃู 'STC Pay').
 * @param {string} templateCategory - ูุฆุฉ ุงููุงูุจ ุงููุฎุชุงุฑ ('normal', 'standard', etc.).
 */
function openQrPaymentPage(method, templateCategory) {
    // 1. ุฌูุจ ุงูุณุนุฑ ุงูุฃุตูู ูู ูุงุฆู ุงูุฃุณุนุงุฑ ุจูุงุกู ุนูู ูุฆุฉ ุงููุงูุจ
    const originalPrice = PRICES.local[templateCategory];
    if (originalPrice === undefined) {
        console.error("Price for category not found:", templateCategory);
        alert("ุญุฏุซ ุฎุทุฃุ ุงูุณุนุฑ ููุฐู ุงููุฆุฉ ุบูุฑ ูุญุฏุฏ.");
        return;
    }

    // 2. ุญุณุงุจ ุงูุณุนุฑ ุงูููุงุฆู ูุน ุงูุฎุตู ูู ูุญุธุฉ ุงูุถุบุท
    const codeInput = document.getElementById("discount-code");
    const code = codeInput ? codeInput.value.trim().toUpperCase() : "";
    let finalPrice = originalPrice;
    let appliedDiscountCode = ""; // ุณูุชู ุญูุธ ุงูููุฏ ุงููุนูู ููุง

    if (code && discountCodes[code] !== undefined) {
        const discountPercentage = discountCodes[code];
        finalPrice = Math.max(0, Math.round(originalPrice * (1 - discountPercentage / 100)));
        appliedDiscountCode = code; // ุญูุธ ุงูููุฏ ุงูุตุญูุญ ุงูุฐู ุชู ุงุณุชุฎุฏุงูู
    }

    // 3. ุงูุญุตูู ุนูู ุนูุงุตุฑ ูุงุฌูุฉ ุงููุณุชุฎุฏู ูุชุฌููุฒูุง
    const qrPaymentImage = document.getElementById("qr-payment-image");
    const manualPaymentForm = document.getElementById("manual-payment-form");
    const submitBtn = document.getElementById("submit-payment-proof");
    const qrPaymentResultDiv = document.getElementById("qr-payment-result");

    // ุฅุนุงุฏุฉ ุชุนููู ุงููุงุฌูุฉ ุนูุฏ ูู ูุชุญ
    if(qrPaymentImage) qrPaymentImage.style.display = "none";
    if(manualPaymentForm) manualPaymentForm.style.display = "none";
    if(submitBtn) submitBtn.style.display = "none";
    if(qrPaymentResultDiv) qrPaymentResultDiv.textContent = '';

    // 4. ุชุนุจุฆุฉ ูููุฐุฌ ุงูุฏูุน ุงููุฏูู ุจุงูุจูุงูุงุช ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ูุงูุณุนุฑ ุงููุญุณูุจ
    const mainName = document.getElementById('name-input')?.value.trim();
    const mainEmail = document.getElementById('email-input')?.value.trim();
    const mainPhone = document.getElementById('phone-input')?.value.trim();

    if (paymentNameInput) paymentNameInput.value = mainName;
    if (paymentEmailInput) paymentEmailInput.value = mainEmail;
    if (paymentPhoneInput) paymentPhoneInput.value = mainPhone;
    
    // ุงุณุชุฎุฏุงู ุงูุณุนุฑ ุงูููุงุฆู ุงููุญุณูุจ ูุชุนุจุฆุฉ ุญูู ุงูุณุนุฑ
    if(paymentMessagesInput) paymentMessagesInput.value = finalPrice; 

    // 5. ุญูุธ ุงูุจูุงูุงุช ุงููุงูุฉ ูู ุณูุงุช (attributes) ุงูุตูุญุฉ ูุชุณุชุฎุฏููุง ุฏุงูุฉ ุงูุฅุฑุณุงู ูุงุญููุง
    const qrManualPaymentPage = document.getElementById('qr-manual-payment-page');
    if (qrManualPaymentPage) {
        qrManualPaymentPage.setAttribute("data-payment-method", method);
        qrManualPaymentPage.setAttribute("data-discount-code", appliedDiscountCode); // ุญูุธ ุงูููุฏ ุงููุนูู
        qrManualPaymentPage.setAttribute("data-cv-template-category", templateCategory);
        qrManualPaymentPage.setAttribute("data-price-paid", finalPrice.toString());
    }

    // 6. ุนุฑุถ ุฑูุฒ QR ุงูุตุญูุญ ููููุฐุฌ ุงูุฏูุน
    if (method.toLowerCase() === "stc pay" || method.toLowerCase() === "rajhi") {
        if(qrPaymentImage) {
            qrPaymentImage.src = (method.toLowerCase() === "stc pay") ? "QRstcpay.png.webp" : "QRalrajhi.png.webp";
            qrPaymentImage.alt = (method.toLowerCase() === "stc pay") ? "STC Pay QR Code" : "Al Rajhi QR Code";
            qrPaymentImage.style.display = "block";
        }
        if(manualPaymentForm) manualPaymentForm.style.display = "block";
        if(submitBtn) submitBtn.style.display = "block";
    }

    // 7. ุงูุงูุชูุงู ุฅูู ุตูุญุฉ ุงูุฏูุน
    showPage('qr-manual-payment-page');
}

function isMobileDevice() {
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
}

/**
 * ูุนุงูุฌ ุฅุฑุณุงู ุฅุซุจุงุช ุงูุฏูุน ุงููุฏูู (STC Pay / Al Rajhi).
 * ุชู ุชุญุฏูุซ ูุฐู ุงูุฏุงูุฉ ุจุงููุงูู ูุฅุตูุงุญ ูุดุงูู ุฅุฑุณุงู ุงูุจูุงูุงุช.
 * @param {Event} event - ูุงุฆู ุงูุญุฏุซ ูููุน ุงูุณููู ุงูุงูุชุฑุงุถู ูููููุฐุฌ.
 */
async function submitPaymentProof(event) {
    event.preventDefault(); // ููุน ุฃู ุณููู ุงูุชุฑุงุถู ูููููุฐุฌ

    const submitButton = document.getElementById("submit-payment-proof");
    if (submitButton.disabled) {
        return; // ููุน ุงูุฅุฑุณุงู ุงููุชุนุฏุฏ ุฅุฐุง ูุงู ุงูุฒุฑ ูุนุทูุงู ุจุงููุนู
    }

    // ุชุนุทูู ุงูุฒุฑ ูุชุบููุฑ ูุตู ูุฅุนุทุงุก ูุคุดุฑ ูููุณุชุฎุฏู
    submitButton.disabled = true;
    submitButton.innerHTML = `<span class="spinner-border spinner-border-sm"></span> ${translations[currentLang]['Submitting...'] || 'Submitting...'}`;
    
    const qrPaymentResultDiv = document.getElementById("qr-payment-result");
    qrPaymentResultDiv.textContent = ''; // ูุณุญ ุฃู ุฑุณุงุฆู ุณุงุจูุฉ

    try {
        // 1. ุฌูุน ุงูุจูุงูุงุช ูู ูููุฐุฌ ุงูุฏูุน ุงููุฏูู
        const name = paymentNameInput.value.trim();
        const email = paymentEmailInput.value.trim();
        const phoneNumber = paymentPhoneInput.value.trim();
        const file = paymentFileInput.files[0];

        // 2. ุฌูุน ุงูุจูุงูุงุช ุงููุฎุฒูุฉ ูู ุณูุงุช ุงูุตูุญุฉ (data-attributes)
        const qrManualPaymentPage = document.getElementById('qr-manual-payment-page');
        const paymentMethod = qrManualPaymentPage.getAttribute("data-payment-method");
        const cvTemplateCategory = qrManualPaymentPage.getAttribute("data-cv-template-category");
        const pricePaid = qrManualPaymentPage.getAttribute("data-price-paid");
        
        // --- ุฅุตูุงุญ ูุดููุฉ ููุฏ ุงูุฎุตู ---
        // ูุฑุงุกุฉ ููุฏ ุงูุฎุตู ููุต ูุจุงุดุฑุฉ ูู ุงูุณูุฉ ุงููุญููุธุฉ
        const actualDiscountCodeStr = qrManualPaymentPage.getAttribute("data-discount-code") || 'N/A';

        // 3. ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ุงููุฏุฎูุฉ
        if (!name || !email || !phoneNumber) {
            throw new Error(translations[currentLang]['Please fill in all fields.'] || 'Please fill in all required fields.');
        }
        if (!validateEmail(email)) {
            throw new Error(translations[currentLang]['Please enter a valid email.'] || 'Please enter a valid email address.');
        }
        if (file) {
            if (file.size > MAX_FILE_SIZE) {
                throw new Error(translations[currentLang]['File size exceeds the limit (3MB).'] || 'File size exceeds the 3MB limit.');
            }
            if (!ALLOWED_FILE_TYPES.includes(file.type)) {
                throw new Error(translations[currentLang]['Please attach only image or PDF files.'] || 'Please attach only image or PDF files.');
            }
        }

        toggleLoadingOverlay(true, 'Payment processing, please wait...');

        // 4. ุชุญููู ููู ุงูุฅูุตุงู ุฅูู Base64 (ุฅู ูุฌุฏ)
        const fileBase64 = file ? await fileToBase64(file) : null;

        // 5. ุชูููุฏ ูุณุฎุฉ PDF ูู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ (ูุน ุนูุงูุฉ ูุงุฆูุฉ ูุฃู ุงูุฏูุน ูู ุชุชู ุงูููุงููุฉ ุนููู ุจุนุฏ)
        const pdfData = await generatePdfFromNode(true); // isPaid: false
        if (!pdfData || !pdfData.base64Pdf) {
            throw new Error('Failed to generate CV PDF for submission.');
        }

        // 6. ุชุฌููุฒ ูุงูุฉ ุงูุจูุงูุงุช ููุฅุฑุณุงู ุฅูู Apps Script
        const formData = new URLSearchParams();
        formData.append('name', name);
        formData.append('email', email);
        formData.append('phoneNumber', phoneNumber);
        formData.append('pricePaid', pricePaid);
        formData.append('paymentMethod', paymentMethod);
        formData.append('cvTemplateCategory', cvTemplateCategory);
        formData.append('discountCode', actualDiscountCodeStr); // ุงุณุชุฎุฏุงู ุงูููุฏ ุงููุตู ุงูุตุญูุญ
        formData.append('language', currentLang);
        
        // --- ุฅุตูุงุญ ูุดููุฉ ุจูุงูุงุช ุงููุฏููุฉ/ุงููููุน ---
        // ุฌูุจ ูููุฉ ุญูู "ุงููููุน" ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ูุฅุถุงูุชูุง ููุทูุจ
        const website = document.getElementById('website-input')?.value.trim();
        formData.append('website', website || '');
        
        formData.append('paymentFileBase64', fileBase64 || '');
        formData.append('paymentFileType', file?.type || '');
        formData.append('cvPdfFileBase64', pdfData.base64Pdf);
        formData.append('cvPdfFileName', `CV_Preview_${name.replace(/\s/g, '_')}.pdf`);

        // 7. ุฅุฑุณุงู ุงูุทูุจ ุฅูู Google Apps Script
        const response = await fetch(GOOGLE_APPS_SCRIPT_WEB_APP_URL_PAYMENT_PROCESSOR, {
            method: 'POST',
            body: formData,
        });

        const data = await response.json();

        if (data.status === 'success') {
            qrPaymentResultDiv.style.color = "green";
            qrPaymentResultDiv.textContent = data.message || (translations[currentLang]["payment-success"]);
            // ูุง ููุนูุฏ ุชูุนูู ุงูุฒุฑ ููุง ูุฃูู ุณููุชูู ูุตูุญุฉ ุฃุฎุฑู ุจุนุฏ 5 ุซูุงูู
            setTimeout(() => { showPage('landing-page'); }, 5000);
        } else {
            // ุฅุฐุง ูุดู ุงูุทูุจ ูู ุฌูุฉ ุงูุฎุงุฏูุ ูู ุจุฑูู ุฎุทุฃ ููุชู ุงูุชูุงุทู ูู catch
            throw new Error(data.error || 'An unknown error occurred on the server.');
        }

    } catch (err) {
        // ุนุฑุถ ุฃู ุฎุทุฃ ูููุณุชุฎุฏู (ุณูุงุก ูู ุงูุชุญูู ุฃู ูู ุงูุฅุฑุณุงู)
        console.error("Error in submitPaymentProof:", err);
        qrPaymentResultDiv.style.color = "red";
        qrPaymentResultDiv.textContent = err.message;
    } finally {
        // ูุฐุง ุงูุฌุฒุก ุณูุนูู ุฏุงุฆููุงุ ุณูุงุก ูุฌุญ ุงูุทูุจ ุฃู ูุดู
        toggleLoadingOverlay(false);

        // ุฅุนุงุฏุฉ ุชูุนูู ุงูุฒุฑ ููุท ูู ุญุงู ุญุฏูุซ ุฎุทุฃ ูุจูุงุก ุงููุณุชุฎุฏู ูู ุงูุตูุญุฉ
        if (!qrPaymentResultDiv.textContent.includes("ูุฌุงุญ") && !qrPaymentResultDiv.textContent.includes("Success")) {
            submitButton.disabled = false;
            submitButton.innerHTML = translations[currentLang]['submit'] || 'Submit';
        }
    }
}
function fileToBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = error => reject(error);
    });
}
function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(String(email).toLowerCase());
}

function getExperiencesData() {
    const experiences = [];
    document.querySelectorAll('#experience-input .experience-entry').forEach(entry => {
        const title = entry.querySelector('.experience-title')?.value.trim();
        const company = entry.querySelector('.experience-company')?.value.trim();
        const duration = entry.querySelector('.experience-duration')?.value.trim();
        const description = entry.querySelector('.experience-description')?.value.trim();
        if (title || company || duration || description) {
            experiences.push({ title, company, duration, description });
        }
    });
    return experiences;
}

function getEducationsData() {
    const educations = [];
    document.querySelectorAll('#education-input .education-entry').forEach(entry => {
        const degree = entry.querySelector('.education-degree')?.value.trim();
        const institution = entry.querySelector('.education-institution')?.value.trim();
        const duration = entry.querySelector('.education-duration')?.value.trim();
        if (degree || institution || duration) {
            educations.push({ degree, institution, duration });
        }
    });
    return educations;
}

// ููุง ุชูุณ ุชุนุฏูู ุฏุงูุฉ ุฌูุจ ุจูุงูุงุช ุงูููุงุฑุงุช ูุชูุฑุฃ ุงููุณุชูู ุฃูุถุงู
function getSkillsData() {
    const skills = [];
    document.querySelectorAll('#skills-input .skill-entry').forEach(entry => {
        const name = entry.querySelector('.skill-item-input').value.trim();
        const level = entry.querySelector('.skill-level-select').value;

        // โญ ุงูุชุนุฏูู ุงูุฑุฆูุณู ููุง: ูุญูุธ ุงูููุงุฑุฉ ุทุงููุง ุฃู ุญูู ุงูุงุณู ููุณ ูุงุฑุบูุง
        if (name) {
            skills.push({ name, level });
        }
    });
    return skills;
}

function getLanguagesData() {
    const languages = [];
    document.querySelectorAll('#languages-input .language-item-input').forEach(input => {
        const lang = input.value.trim();
        if (lang) {
            languages.push(lang);
        }
    });
    return languages;
}

function getReferencesData() {
    const references = [];
    document.querySelectorAll('#references-input .reference-entry').forEach(entry => {
        const name = entry.querySelector('.reference-name')?.value.trim();
        const position = entry.querySelector('.reference-position')?.value.trim();
        const phone = entry.querySelector('.reference-phone')?.value.trim();
        const email = entry.querySelector('.reference-email')?.value.trim();
        if (name || position || phone || email) {
            references.push({ name, position, phone, email });
        }
    });
    return references;
}

/**
 * ูุฌูุน ุจูุงูุงุช ุฌููุน ุงูุฃูุณุงู ุงููุฎุตุตุฉ ูู ูููุฐุฌ ุงูุฅุฏุฎุงู.
 * @returns {Array} - ูุตูููุฉ ูู ูุงุฆูุงุช ุงูุฃูุณุงู ุงููุฎุตุตุฉ.
 */
function getCustomSectionsData() {
    const sections = [];
    // --- ุชุนุฏูู: ุงูุจุญุซ ุฏุงุฎู ุงูุญุงููุฉ ุงููุฎุตุตุฉ ููุท ---
    document.querySelectorAll('#custom-sections-container .custom-section-wrapper').forEach(sectionWrapper => {
        const sectionTitle = sectionWrapper.querySelector('.custom-section-title')?.value.trim();
        
        if (!sectionTitle) return;

        const subSections = [];
        sectionWrapper.querySelectorAll('.custom-subsection-entry').forEach(subSectionEntry => {
            const subTitle = subSectionEntry.querySelector('.custom-subsection-title')?.value.trim();
            const description = subSectionEntry.querySelector('.custom-subsection-description')?.value.trim();
            
            if (subTitle || description) {
                subSections.push({ title: subTitle, description: description });
            }
        });

        if (subSections.length > 0) {
            sections.push({
                title: sectionTitle,
                subSections: subSections
            });
        }
    });
    return sections;
}

function getSelectedTemplateCss() {
    let cssRules = [];
    const stylesheets = document.styleSheets;

    // ูุฌููุนุฉ ุดุงููุฉ ูู ุงููุญุฏุฏุงุช ุงูุนุงูุฉ ูุงููุฆุงุช ุงูุชู ูุฌุจ ุชุถููููุง ุฏุงุฆููุง
    // ุชุดูู ุนูุงุตุฑ HTML ุงูุฃุณุงุณูุฉุ ูุฆุงุช Bootstrapุ ููุฆุงุช ุงูุงุชุฌุงู
    const commonSelectors = [
        'body', 'html', '#cv-container', '.cv-content',
        '.cv-header', '.cv-name', '.cv-title', '.cv-contact-info', '.cv-contact-item', '.cv-profile-pic',
        '.cv-section', '.cv-section-title', '.cv-experience-item', '.cv-education-item',
        '.cv-job-title', '.cv-degree', '.cv-company', '.cv-institution', '.cv-duration',
        '.cv-skill-list', '.cv-skill-item', '.cv-language-list', '.cv-reference-item',
        '.cv-table-row', '.cv-two-column-layout', '.cv-professional-layout', '.ast-layout',
        '.cv-sidebar', '.cv-main-content', '.cv-end-marker', '.filler',
        'h1', 'h2', 'h3', 'h4', 'h5', 'p', 'ul', 'li', 'img', 'a', 'div', 'span',
        '.container', '.row', '.col-md-', '.d-flex', '.mb-', '.mt-', '.ms-', '.me-', // Bootstrap
        '.rtl', '.ltr', // ุงุชุฌุงู ุงููุบุฉ
        '.remove-field', // ูุฅุฒุงูุฉ ุฒุฑ ุงูุญุฐู
        // ุฃุถู ุฃู ูุฆุงุช ุฃู ูุนุฑูุงุช ุฃุฎุฑู ุชุธูุฑ ูู style.css ูุชุญุชุงุฌ ูุชุถููููุง ุจุดูู ุนุงู
    ];

    // ุชุนุจูุฑ ุนุงุฏู ููุชุญูู ูู ุชุทุงุจู ุงููุญุฏุฏุงุช ุงูุนุงูุฉ ุฃู ุฃุฌุฒุงุก ูููุง
    const commonSelectorsRegex = new RegExp(`(^|\\b)(<span class="math-inline">\{commonSelectors\.map\(s \=\> s\.replace\('\.', '\\\\\.'\)\)\.join\('\|'\)\}\)\(\\\\b\|</span>)`);


    for (let i = 0; i < stylesheets.length; i++) {
        try {
            const rules = stylesheets[i].cssRules || stylesheets[i].rules;
            if (!rules) continue;

            for (let j = 0; j < rules.length; j++) {
                const rule = rules[j];
                let ruleText = rule.cssText;

                // 1. ุชุถููู ููุงุนุฏ @font-face ุจุดูู ุตุฑูุญ
                if (rule.type === CSSRule.FONT_FACE_RULE) {
                    cssRules.push(ruleText);
                    continue;
                }

                // 2. ูุนุงูุฌุฉ ููุงุนุฏ @media print / screen ุจุดูู ุฎุงุต
                if (rule.type === CSSRule.MEDIA_RULE) {
                    // ุชุถููู ููุงุนุฏ ุงูุทุจุงุนุฉ ูุงูุงุณุชุฌุงุจุฉ
                    // ููุง ูุฃุฎุฐ ูู ููุงุนุฏ @media print (ุฎุงุตุฉ ุจููู style.css)
                    // ูุฃูุถุงู @media screen ุฃู max-width (ุงููููุฉ ูุถุจุท ุงูุนุฑุถ ุนูู ุงูุดุงุดุฉ ุซู ุฅุฎูุงุฆูุง)
                    if (rule.conditionText.includes('print') || rule.conditionText.includes('screen') || rule.conditionText.includes('(max-width:')) {
                        cssRules.push(ruleText); 
                    }
                    continue;
                }

                // 3. ุชุญููู ููุงุนุฏ CSS ุงูุนุงุฏูุฉ
                const selectorText = rule.selectorText;
                if (selectorText) {
                    const templateSpecificSelector = `.<span class="math-inline">\{selectedTemplateCategory\}\-layout\.template</span>{selectedTemplate}`;

                    const isGeneral = commonSelectorsRegex.test(selectorText);
                    const isTemplateSpecific = selectorText.includes(templateSpecificSelector);
                    const isCvRelated = selectorText.includes('.cv-'); // ูุฆุงุช ุชุจุฏุฃ ุจู .cv- (ูุซู .cv-header)

                    // ุฅุฐุง ูุงู ุงููุญุฏุฏ ุนุงูุงู ุฌุฏุงูุ ุฃู ุฎุงุตุงู ุจุงููุงูุจุ ุฃู ูุชุนูู ุจุงูู CV
                    // ู ูุง ูููู ูุญุฏุฏูุง ูุนูุงุตุฑ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ุงูุชู ูุฑูุฏ ุฅุฎูุงุกูุง (ูุซู .navbar)
                    // ูุฐุง ุงูุฌุฒุก ูุชุทูุจ ุฏูุฉ ูููุน ุชุถููู CSS ุบูุฑ ูุฑุบูุจ ููู
                    const isFrontendUI = selectorText.includes('.navbar') || selectorText.includes('.site-header') || selectorText.includes('.page-section:not') || selectorText.includes('.progress-container') || selectorText.includes('.language-toggle');

                    if ((isGeneral || isTemplateSpecific || isCvRelated) && !isFrontendUI) {
                        cssRules.push(ruleText);
                    }
                }
            }
        } catch (e) {
            console.warn(`Could not read CSS rules from stylesheet (possibly CORS issue): ${e.message}`);
        }
    }

    // ** ููุงุนุฏ CSS ุฅุถุงููุฉ ููุง ูุชุฌุงูุฒ ุงููุดุงูู ูุชุฃููุฏ ุงูุชูุณูู ููู PDF **
    // ูุฐู ุงูููุงุนุฏ ุณุชูุถุงู ุฏุงุฆููุง ูู ููุงูุฉ ุงูู CSSุ ููุง ูุถูู ุฃููุง ุชุทุบู ุนูู ุงูููุงุนุฏ ุงูุฃุฎุฑู.
    // ููู ุญููู ููุดุงูู ูุญุฏุฏุฉ ูู ุงูุฎุทูุทุ ุงูุงุชุฌุงูุ ุงูููุงูุดุ ุชุฎุทูุท ุงูุฃุนูุฏุฉุ ูุฅุฎูุงุก ุนูุงุตุฑ ุงูุนุงุฑุถ.
    cssRules.push(`
        /* 1. ููุงุนุฏ ุฃุณุงุณูุฉ ูู HTML/BODY ูุชุฃููุฏ ุงุชุฌุงู ุงูุตูุญุฉ ูุงูููุงูุด */
        html, body {
            margin: 0 !important;
            padding: 0 !important;
            width: 210mm !important; /* ุนุฑุถ A4 */
            min-height: 297mm !important; /* ุงุฑุชูุงุน A4 */
            background: white !important; /* ุฎูููุฉ ุจูุถุงุก ูุถูุงู ุนุฏู ุธููุฑ ุฎูููุฉ ุงูุนุงุฑุถ */
            color: #212529 !important; /* ููู ูุต ุงูุชุฑุงุถู */
            direction: ${currentLang === 'ar' ? 'rtl' : 'ltr'} !important;
            text-align: ${currentLang === 'ar' ? 'right' : 'left'} !important;
            box-sizing: border-box !important;
            overflow: hidden !important; /* ููู ุฌุฏุงู ูููุน ุฃู scrollbars ูู ุงูู PDF */
        }
        body.rtl { direction: rtl !important; text-align: right !important; }
        body.ltr { direction: ltr !important; text-align: left !important; }

        /* 2. ุฅุฎูุงุก ุฌููุน ุนูุงุตุฑ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ุบูุฑ ุงููุฑุบูุจุฉ (ุจุดูู ุดุงูู) */
        /* ูุฐู ุงููุญุฏุฏุงุช ูุฌุจ ุฃู ุชุณุชูุฏู ุนูุงุตุฑ ูุงุฌูุฉ ุงููุณุชุฎุฏู ุงูุชู ูุฏ ุชุธูุฑ ูู ุงูู PDF */
        .site-header, .navbar, .page-section:not(.active-page), .progress-container,
        .language-toggle, .btn-info, .btn-success, #cv-preview-area,
        .popup-box, .popup-close, .form-group, .remove-field,
        .template-preview-container, .template-category, .template-previews,
        /* ุฃู ุนูุงุตุฑ ุฃุฎุฑู ูู ูุงุฌูุฉ ุงููุณุชุฎุฏู ูุฏูู ูู ุงูู HTML ูุง ุชุฑูุฏ ุธููุฑูุง */
        .d-flex.justify-content-center.mt-4 { /* ุงูุฃุฒุฑุงุฑ ูู ุตูุญุฉ ุงููุนุงููุฉ */
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
            max-height: 0 !important;
            overflow: hidden !important;
            padding: 0 !important;
            margin: 0 !important;
        }

        /* 3. ุชุฃููุฏ ุชูุณูู ุงูู CV ููุญุงููุฉ ุงูุฑุฆูุณูุฉ */
        #cv-container {
            position: relative !important;
            width: 210mm !important; /* ุนุฑุถ A4 */
            min-height: 297mm !important; /* ุงุฑุชูุงุน A4 */
            height: auto !important; /* ูุชุณูุญ ุจุงูููู ุนูู ุนุฏุฉ ุตูุญุงุช */
            margin: 0 !important; /* ูุฅุฒุงูุฉ ุฃู ุฅุฒุงุญุฉ ุบูุฑ ูุฑุบูุจุฉ */
            padding: 0 !important; /* ุงูุญุดูุฉ ุชููู ุฏุงุฎู ุงูุฃูุณุงู */
            box-shadow: none !important; /* ุฅุฒุงูุฉ ุฃู ุธู ูุญุงููุฉ ุงููุนุงููุฉ */
            border: none !important; /* ุฅุฒุงูุฉ ุฃู ุญุฏูุฏ ูุญุงููุฉ ุงููุนุงููุฉ */
            background: white !important; /* ุฎูููุฉ ุจูุถุงุก ููุณูุฑุฉ ุงูุฐุงุชูุฉ */
            color: #212529 !important; /* ููู ูุต ุงูุชุฑุงุถู */
            overflow: visible !important; /* ููู ุฌุฏุงู ููุณูุงุญ ุจุงููุญุชูู ุนูู ุนุฏุฉ ุตูุญุงุช */
            direction: ${currentLang === 'ar' ? 'rtl' : 'ltr'} !important;
            text-align: ${currentLang === 'ar' ? 'right' : 'left'} !important;
            box-sizing: border-box !important;
        }

        /* 4. ูุนุงูุฌุฉ ุงูุฎุทูุท (ุถูุงู ุชุทุจูู Tajawal ููุนุฑุจูุฉ) */
        body, p, span, div, h1, h2, h3, h4, h5, h6, li {
            font-family: 'Tajawal', sans-serif !important;
        }
        /* ููุงุนุฏ ุงูุฎุทูุท ุงูุฎุงุตุฉ ุจูู ูุงูุจ (ุฃุถููุง ููุง ุฃูุถุงู ูุชุทุบู) */
        .normal-layout.template1 .cv-name, .normal-layout.template1 .cv-title, .normal-layout.template1 .cv-section-title { font-family: 'Roboto', sans-serif !important; }
        .normal-layout.template2 .cv-name, .normal-layout.template2 .cv-title, .normal-layout.template2 .cv-section-title { font-family: 'Lato', sans-serif !important; }
        /* ... ูุฑุฑ ูุฐุง ูุฌููุน ุงูููุงูุจ ูุงููุฆุงุช ุงูุชู ุชุญุฏุฏ ุงูุฎุทูุท ูู style.css */

        /* 5. ูุนุงูุฌุฉ ุชุฎุทูุท ุงูุฃุนูุฏุฉ (Standard, Professional, AST) */
        .cv-two-column-layout, .ast-layout {
            display: flex !important; /* Use flex for print */
            flex-direction: var(--print-flex-direction) !important; /* Apply correct flex direction from variable */
            gap: 10mm !important;
            page-break-inside: auto !important; /* Allow page breaks here */
            flex-wrap: nowrap !important; /* Prevent wrapping to next line */
        }
        .cv-professional-layout {
            display: grid !important;
            grid-template-columns: var(--print-grid-columns) !important; /* Apply grid columns from variable */
            grid-template-areas: var(--print-grid-areas) !important; /* Apply grid areas from variable */
            gap: 10mm !important;
            page-break-inside: auto !important; /* Allow page breaks here */
        }
        .cv-sidebar, .cv-main-content {
            display: flex !important; /* Revert to flex for individual columns */
            flex-direction: column !important; /* Ensure content stacks vertically within column */
            vertical-align: top !important; /* Align to top */
            padding: 8mm !important; /* Inner padding */
            box-sizing: border-box !important;
            height: auto !important; /* Allow height to adjust */
            min-height: 1px !important; /* Smallest possible height */
            page-break-inside: avoid !important; /* Crucial: prevent breaking content within individual columns */
            text-align: ${currentLang === 'ar' ? 'right' : 'left'} !important; /* Text alignment within the column */
        }

        /* 5.1. ุชุญุฏูุฏ ุนุฑุถ ุงูุฃุนูุฏุฉ (ุฅุฐุง ูู ููู ูู ุงููุงูุจ ุงูุฃุตูู) */
        .cv-two-column-layout .cv-sidebar, .ast-layout .cv-sidebar { width: 80mm !important; flex-shrink: 0 !important; } /* Make sidebar fixed width */
        .cv-professional-layout .cv-sidebar { width: 80mm !important; flex-shrink: 0 !important; }
        .cv-main-content { width: auto !important; flex-grow: 1 !important;} /* Main content takes remaining space */


        /* 5.2. ูุนุงูุฌุฉ Professional Layout (ุญุณุจ ุงูุชุบููุฑุงุช ูู style.css ุงูุฎุงุต ุจู) */
        /* ููู style.css ุงูุฎุงุต ุจู ูุญุชูู ุนูู Professional Layout ูุฌุนู ุงูุดุฑูุท ุงูุฌุงูุจู ุนูู ุงููุณุงุฑ ุฏุงุฆูุงู */
        /* ุณูุญุงูุธ ุนูู ูุฐุง ุงูุณููู ุนูุฏ ุงูุทุจุงุนุฉ */
        .cv-professional-layout[dir="rtl"], .cv-professional-layout[dir="ltr"] {
            /* These will be overridden by --print-grid-columns and --print-grid-areas */
            /* grid-template-columns: 80mm 1fr !important; */
            /* grid-template-areas: "sidebar main" !important; */
        }
        .cv-professional-layout .cv-sidebar { grid-area: sidebar !important; }
        .cv-professional-layout .cv-main-content { grid-area: main !important; }
        .cv-professional-layout .cv-header.professional-layout { grid-area: header !important; display: flex !important; flex-direction: column !important; } /* Use flex for header content within grid */


        /* 6. ุชุญุณููุงุช ุนุงูุฉ ุนูู ุงูุนูุงุตุฑ ุงููุตูุฉ ูุงูููุงุฆู */
        h1, h2, h3, h4, h5, h6, p, li {
            word-break: break-word !important;
            white-space: pre-wrap !important; /* ููุญูุงุธ ุนูู ุงูุฃุณุทุฑ ุงูุฌุฏูุฏุฉ ูู textarea */
            line-height: 1.6 !important;
            margin: 0 !important; /* ูุฅุฒุงูุฉ ุฃู ููุงูุด ุงูุชุฑุงุถูุฉ ุบูุฑ ูุฑุบูุจุฉ */
            padding: 0 !important;
        }
        ul {
            list-style: none !important;
            padding: 0 !important;
            margin: 0 !important;
            text-align: ${currentLang === 'ar' ? 'right' : 'left'} !important;
        }
        /* ุฅุฐุง ููุช ุชุณุชุฎุฏู ููุงุทุงู ููููุงุฆูุ ููููู ุฅุนุงุฏุชูุง ูุฏููุงู ูู RTL/LTR */
        html[dir="rtl"] ul li::before {
            content: "โข " !important; /* ููุทุฉ ุงููุงุฆูุฉ */
            color: inherit !important;
            display: inline-block !important;
            width: 1em !important;
            margin-left: 0.5em !important;
            text-align: left !important;
        }
        html[dir="ltr"] ul li::before {
            content: "โข " !important;
            color: inherit !important;
            display: inline-block !important;
            width: 1em !important;
            margin-right: 0.5em !important;
            text-align: right !important;
        }
        .cv-skill-item, .cv-language-list li {
            text-align: inherit !important;
            padding-right: ${currentLang === 'ar' ? '0' : '15px'} !important;
            padding-left: ${currentLang === 'ar' ? '15px' : '0'} !important;
        }
        .cv-contact-item i {
            margin-left: ${currentLang === 'ar' ? '8px' : '0'} !important;
            margin-right: ${currentLang === 'ar' ? '0' : '8px'} !important;
        }

        /* 7. ููุงุนุฏ ููุทุจุงุนุฉ / ุงูุชูููุฏ ุงูุชู ูุฌุจ ุฃู ุชุทุบู ูู ุณูุงู ุงูุทุจุงุนุฉ (ููุฑุฑุฉ ููู ูููุฉ) */
        @media print {
            html, body {
                margin: 0 !important; padding: 0 !important;
                width: 210mm !important;
                min-height: 297mm !important;
                background: white !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                direction: ${currentLang === 'ar' ? 'rtl' : 'ltr'} !important;
                text-align: ${currentLang === 'ar' ? 'right' : 'left'} !important;
            }
            #cv-container {
                box-shadow: none !important;
                border: none !important;
                min-height: 297mm !important;
                height: auto !important;
                overflow: visible !important;
                page-break-before: auto !important;
                page-break-after: auto !important;
                page-break-inside: auto !important; /* Allow page breaks inside container */
                margin: 0 !important;
                padding: 0 !important;
            }
            .cv-section { page-break-inside: avoid !important; }
            .cv-experience-item, .cv-education-item, .cv-reference-item { page-break-inside: avoid !important; }
        }
    `);

    return cssRules.join('\n');
}


/**
 * =========================================================================
 * == ุฏุงูุฉ generatePdfFromNode ุงูููุงุฆูุฉ (ุจุนุฏ ูุตู ูููุงุช CSS) ==
 * =========================================================================
 * ุชููู ุจุฌูุน ูุญุชูู ูููุงุช CSS ุงูุฎุงุฑุฌูุฉ ูุฏูุฌูุง ูุน HTML ูุจู ุฅุฑุณุงููุง ููุณูุฑูุฑ.
 * @param {boolean} isPaid - ูู ุงููุณุฎุฉ ูุฏููุนุฉ ูุจุฏูู ุนูุงูุฉ ูุงุฆูุฉ
 * @returns {Promise<Object|null>} - ูุงุฆู ูุญุชูู ุนูู ุจูุงูุงุช ุงูู PDF ุฃู null
 */
async function generatePdfFromNode(isPaid) {
    toggleLoadingOverlay(true, 'Preparing perfect layout...');
    try {
        const cvPreviewElement = document.getElementById('cv-container');
        if (!cvPreviewElement) throw new Error("CV container not found.");

        // โญ ุงูุฎุทูุฉ 1: ุฌูุจ ูุญุชูู ูููุงุช CSS ุงูุฎุงุฑุฌูุฉ ููุตูุต
        const fetchCss = async (url) => {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`Failed to fetch ${url}`);
            return response.text();
        };

        const [mainCss, templatesCss, responsiveCss] = await Promise.all([
            fetchCss('style.css'),
            fetchCss('templates.css'),
            fetchCss('responsive.css')
        ]);
        
        const fullCssText = mainCss + templatesCss + responsiveCss;

        // --- ุจููุฉ ุงูุฏุงูุฉ ุชุจูู ููุง ูู ุชูุฑูุจูุง ---
        const tempContainer = document.createElement('div');
        generateCV(tempContainer);
        const finalHtml = tempContainer.innerHTML;
        tempContainer.remove();

        const cvData = collectCvData();
        const direction = cvData.language === 'ar' ? 'rtl' : 'ltr';

        const colorVariablesCSS = getColorVariablesAsCssText();
        const dynamicStylesFromElement = cvPreviewElement.style.cssText;
        const dynamicStyleRule = `#cv-container { ${dynamicStylesFromElement} }`;
        
        const isArabic = currentLang === 'ar';
        const nameFont = document.getElementById('font-selector-name')?.value || (isArabic ? "'Cairo', sans-serif" : "'Playfair Display', serif");
        const headingsFont = document.getElementById('font-selector-headings')?.value || (isArabic ? "'Tajawal', sans-serif" : "'Montserrat', sans-serif");
        const bodyFont = document.getElementById('font-selector-body')?.value || (isArabic ? "'Almarai', sans-serif" : "'Roboto', sans-serif");

        const printCssOverrides = `
            body { padding-top: 0 !important; }
            ${colorVariablesCSS}
            ${dynamicStyleRule}
            #cv-container { font-family: ${bodyFont} !important; }
            #cv-container .cv-name, #cv-container .cv-title { font-family: ${nameFont} !important; }
            #cv-container .cv-section-title { font-family: ${headingsFont} !important; }
        `;

        // โญ ุงูุฎุทูุฉ 2: ุญูู ููุฏ CSS ุงููุฌูุน ุฏุงุฎู ุงูู HTML ุงูุฐู ุณูุชู ุฅุฑุณุงูู
        const fullPageHtml = `
            <!DOCTYPE html>
            <html lang="${cvData.language}" dir="${direction}">
            <head>
                <meta charset="UTF-8">
                <title>CV</title>
                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
                <link rel="preconnect" href="https://fonts.googleapis.com">
                <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
                <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@400;700&family=Cairo:wght@400;700&family=Tajawal:wght@400;700&family=Amiri:wght@400;700&family=Lalezar&family=Markazi+Text:wght@400;700&family=Roboto:wght@400;700&family=Lato:wght@400;700&family=Montserrat:wght@400;700&family=Open+Sans:wght@400;700&family=PT+Sans:wght@400;700&family=Playfair+Display:wght@400;700&family=Noto+Serif:wght@400;700&display=swap" rel="stylesheet">
                <style>
                    ${fullCssText}
                    ${printCssOverrides}
                </style>
            </head>
            <body class="${direction}">
                 <div id="cv-container" class="${isPaid ? '' : 'watermarked'} ${cvData.templateCategory}-layout template${cvData.templateNumber}" dir="${direction}">
                    ${finalHtml}
                 </div>
            </body>
            </html>
        `;

        const response = await fetch(`${NODE_SERVER_URL}/generate-cv`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ fullHtml: fullPageHtml }),
            mode: 'cors'
        });

        if (!response.ok) throw new Error(await response.text());
        
        const pdfData = await response.json();
        
        if (pdfData && pdfData.status === 'success') {
            return pdfData;
        } else {
            throw new Error(pdfData.message || "Failed to generate PDF on server.");
        }
    } catch (error) {
        console.error("Error in generatePdfFromNode:", error);
        alert('An error occurred while preparing the PDF: ' + error.message);
        return null;
    } finally {
        toggleLoadingOverlay(false);
    }
}
/**
 * ุฏุงูุฉ ูุณุงุนุฏุฉ ุชุฃุฎุฐ ุงูู HTML ุงูููุงุฆู ูุชุฑุณูู ููุฎุงุฏู.
 * @param {string} finalHtml - ููุฏ HTML ููุนูุตุฑ ุงูุฌุงูุฒ ููุทุจุงุนุฉ.
 * @param {boolean} isPaid - ูู ุงููุณุฎุฉ ูุฏููุนุฉ.
 * @returns {Promise<Object>}
 */
async function sendFinalHtmlToServer(finalHtml, isPaid) {
    const mainCssText = document.getElementById('main-stylesheet')?.textContent || '';
    if (!mainCssText) {
        throw new Error("Critical: Main stylesheet could not be found in the DOM.");
    }
    
    const cvData = collectCvData();
    const direction = cvData.language === 'ar' ? 'rtl' : 'ltr';

    const fullPageHtml = `
        <!DOCTYPE html>
        <html lang="${cvData.language}" dir="${direction}">
        <head>
            <meta charset="UTF-8">
            <title>CV</title>
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
            <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
            <style>
                ${mainCssText}
            </style>
        </head>
        <body class="${direction}">
             ${finalHtml.replace('class="', `class="${isPaid ? '' : 'watermarked'} `)}
        </body>
        </html>
    `;

    const response = await fetch(`${NODE_SERVER_URL}/generate-cv`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ fullHtml: fullPageHtml }),
        mode: 'cors'
    });

    if (!response.ok) {
        const errorBody = await response.json().catch(() => ({ message: 'Server error' }));
        throw new Error(`Node.js server error: ${response.status} - ${errorBody.message}`);
    }

    return await response.json();
}
/**
 * ุฏุงูุฉ ูุฑูุฒูุฉ ูุฅุฑุณุงู ุจูุงูุงุช ุงูุฏูุน ูุงูู PDF ุงูููุงุฆู ุฅูู Google Apps Script.
 * ูุฐู ุงูุฏุงูุฉ ูุง ุชููู ุจุชูููุฏ ุงูู PDF ุจููุณูุงุ ุจู ุชุณุชูุจูู ูุจูุงูุงุช ุฌุงูุฒุฉ.
 * @param {string} paymentMethod - ุทุฑููุฉ ุงูุฏูุน (ูุซุงู: 'PayPal', 'STC Pay', 'Discounted/Free').
 * @param {number} pricePaid - ุงููุจูุบ ุงููุฏููุน.
 * @param {string} cvPdfBase64 - ุจูุงูุงุช ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ุจุตูุบุฉ Base64 (ุชู ุชูููุฏูุง ูุณุจูุงู).
 * @param {File|null} paymentFile - ููู ุงูุฅูุตุงู (ููุฏูุน ุงููุฏูู)ุ ุฃู null ููุนูููุงุช ุงูุชููุงุฆูุฉ.
 */
async function sendPaymentDataToAppsScript(paymentMethod, pricePaid, cvPdfBase64, paymentFile) {
    toggleLoadingOverlay(true, 'Payment processing, please wait...');

    try {
        // 1. ุฌูุน ุจูุงูุงุช ุงููุณุชุฎุฏู ุงูุฃุณุงุณูุฉ ูู ุญููู ุงูุฅุฏุฎุงู ุงูุฑุฆูุณูุฉ
        const name = document.getElementById('name-input')?.value.trim() || 'Unnamed User';
        const email = document.getElementById('email-input')?.value.trim();
        const phoneNumber = document.getElementById('phone-input')?.value.trim();
        const website = document.getElementById('website-input')?.value.trim();

        // 2. ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
        if (!email || !validateEmail(email)) {
            // ุงุณุชุฎุฏุงู ุฑุณุงูุฉ ุฎุทุฃ ุนุงูุฉ ูุฃู ูุฐู ุงูุฏุงูุฉ ูุฏ ุชูุณุชุฏุนู ูู ุณูุงูุงุช ูุฎุชููุฉ
            throw new Error(translations[currentLang]['Please enter a valid email.'] || 'A valid email is required to send your CV.');
        }
        
        if (!cvPdfBase64) {
            throw new Error('CV PDF data was not provided to the submission function.');
        }

        // 3. ูุนุงูุฌุฉ ููู ุฅูุตุงู ุงูุฏูุน (ุฅู ูุฌุฏ)
        let paymentFileBase64 = null;
        if (paymentFile) {
            // ููููู ุฅุถุงูุฉ ุงูุชุญูู ูู ุญุฌู ูููุน ุงูููู ููุง ุฃูุถุงู ูุทุจูุฉ ุญูุงูุฉ ุฅุถุงููุฉ
            if (paymentFile.size > MAX_FILE_SIZE) {
                throw new Error(translations[currentLang]['File size exceeds the limit (3MB).']);
            }
            if (!ALLOWED_FILE_TYPES.includes(paymentFile.type)) {
                throw new Error(translations[currentLang]['Please attach only image or PDF files.']);
            }
            paymentFileBase64 = await fileToBase64(paymentFile);
        }

        // 4. ุชุฌููุฒ ุญูููุฉ ุงูุจูุงูุงุช (Payload) ุจุชูุณูู URLSearchParams
        const formData = new URLSearchParams();
        formData.append('name', name);
        formData.append('email', email);
        formData.append('phoneNumber', phoneNumber || '');
        formData.append('website', website || ''); // ุฅุฑุณุงู ุจูุงูุงุช ุงููููุน/ุงููุฏููุฉ
        formData.append('pricePaid', pricePaid.toString());
        formData.append('paymentMethod', paymentMethod);
        formData.append('cvTemplateCategory', selectedTemplateCategory); // ุงุณุชุฎุฏุงู ุงููุชุบูุฑ ุงูุนุงู
        formData.append('discountCode', appliedCode || 'N/A'); // ุงุณุชุฎุฏุงู ุงููุชุบูุฑ ุงูุนุงู ููููุฏ ุงููุทุจู
        formData.append('language', currentLang); // ุงุณุชุฎุฏุงู ุงููุชุบูุฑ ุงูุนุงู

        // ุจูุงูุงุช ุงููููุงุช
        formData.append('paymentFileBase64', paymentFileBase64 || '');
        formData.append('paymentFileType', paymentFile?.type || '');
        formData.append('cvPdfFileBase64', cvPdfBase64); // ุงุณุชุฎุฏุงู ุจูุงูุงุช ุงูู PDF ุงูุชู ุชู ุชูุฑูุฑูุง
        formData.append('cvPdfFileName', `CV_${name.replace(/\s/g, '_')}.pdf`);

        // 5. ุฅุฑุณุงู ุงูุทูุจ ุฅูู Google Apps Script
        const response = await fetch(GOOGLE_APPS_SCRIPT_WEB_APP_URL_PAYMENT_PROCESSOR, {
            method: 'POST',
            body: formData,
        });

        const data = await response.json();

        if (data.status === 'success') {
            alert(data.message || translations[currentLang]["payment-success"]);
            showPage('landing-page');
        } else {
            // ุฅุฐุง ูุดู ุงูุทูุจ ูู ุฌูุฉ ุงูุฎุงุฏูุ ูู ุจุฑูู ุฎุทุฃ ููุชู ุนุฑุถู
            throw new Error(data.error || 'An unknown error occurred on the server.');
        }

    } catch (err) {
        console.error("Error in sendPaymentDataToAppsScript:", err);
        // ุนุฑุถ ุฃู ุฎุทุฃ ูููุณุชุฎุฏู
        alert((translations[currentLang]["Error processing file."] || "Error: ") + err.message);
    } finally {
        // ุฅุฎูุงุก ุดุงุดุฉ ุงูุชุญููู ุฏุงุฆููุง ูู ุงูููุงูุฉ
        toggleLoadingOverlay(false);
    }
}


// ุงุณุชุจุฏุงู ุงุณุชุฏุนุงุกุงุช ุชูููุฏ ุงูู PDF ุงููุฏููุฉ ูู ููู index.html
// ูุฐุง ุงูุฒุฑ ูู ุตูุญุฉ ุงููุนุงููุฉ (ุชูุฒูู PDF (ูุจุงุดุฑ))
document.querySelector('#cv-preview-page .btn-info.ms-3').onclick = async function() {
    const pdfData = await generatePdfFromNode(false); // isPaid: false -> ูุน ุนูุงูุฉ ูุงุฆูุฉ
    if (pdfData && pdfData.base64Pdf) {
        const blob = base64toBlob(pdfData.base64Pdf, 'application/pdf');
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `CV_${document.getElementById('name-input')?.value.replace(/\s/g, '_') || 'ResailCV'}.pdf`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        alert(translations[currentLang]['CV downloaded successfully!']);
    } else {
        // ุฑุณุงูุฉ ุงูุฎุทุฃ ูุชู ุนุฑุถูุง ุจุงููุนู ุฏุงุฎู generatePdfFromNode
    }
};

// ูุฐุง ุงูุฒุฑ ูู ุตูุญุฉ ุงููุนุงููุฉ (ุทูุจ ุชูุฒูู / ุทุจุงุนุฉ)
document.querySelector('#cv-preview-page .btn-success.ms-3').onclick = function() {
    openPaymentForCV_appsScript(); // ูุฐุง ุณูุคุฏู ุฅูู ุตูุญุฉ ุฎูุงุฑุงุช ุงูุฏูุน
};


// ุฏุงูุฉ ูุณุงุนุฏุฉ ูุชุญููู Base64 ุฅูู Blob
function base64toBlob(base64, type = 'application/octet-stream') {
    const binStr = atob(base64);
    const len = binStr.length;
    const arr = new Uint8Array(len);
    for (let i = 0; i < len; i++) {
        arr[i] = binStr.charCodeAt(i);
    }
    return new Blob([arr], { type: type });
}


function selectTemplate(templateNumber, category) {
    const cvContainer = document.getElementById('cv-container');
    const previews = document.querySelectorAll('.template-preview-container .template-preview');
    previews.forEach(preview => preview.classList.remove('selected-template'));

    // --- ูุฐุง ูู ุงูุณุทุฑ ุงูุฃูู ุงูุฐู ูุฌุจ ุชุนุฏููู ---
    // ุจุฏูุงู ูู .classList.addุ ูุณุชุฎุฏู .className = '' ููุณุญ ูู ุดูุก ุฃููุงู
    cvContainer.className = ''; 
    // ------------------------------------------

    // ุซู ูุถูู ุงูููุงุณุงุช ุงูุฌุฏูุฏุฉ ูุงููุธููุฉ
    cvContainer.classList.add(`${category}-layout`, `template${templateNumber}`);

    // ุงูููุฏ ุงูุชุงูู ูุจูู ููุง ูู
    const selectedPreview = document.querySelector(`.template-preview[data-template-category="${category}"][onclick*="selectTemplate(${templateNumber}, '${category}')"]`);
    if (selectedPreview) {
        selectedPreview.classList.add('selected-template');
    }
    
    selectedTemplate = templateNumber;
    selectedTemplateCategory = category;
    
    // ุงูุขูุ ุนูุฏูุง ูุชู ุงุณุชุฏุนุงุก ูุฐู ุงูุฏุงูุฉุ ุณุชุฌุฏ ุงูููุงุณ ุงูุตุญูุญ ููุท
    updateControlsForCategory();
    createPaletteControls();
    generateCV(cvContainer);
    updateColorControlVisibility(); 

}

/**
 * ูุนุงูุฌ ุชุบููุฑ ุงูุตูุฑุฉ ุงูุดุฎุตูุฉุ ููุนุฑุถ ูุนุงููุฉ ูุฃููููุฉุ ููููู ุจุชุตุบูุฑ ุงูุตูุฑุฉ.
 */
function handleProfilePicChange(event) {
    const file = event.target.files[0];
    const inputElement = event.target;
    
    // ุงูุนุซูุฑ ุนูู ุนูุงุตุฑ ุงููุงุฌูุฉ: ุงุณู ุงูููู ูุฃููููุฉ ุงููุนุงููุฉ
    const fileNameDisplay = document.getElementById('file-name-display');
    const picPreview = document.getElementById('profile-pic-preview'); // โญ ุงูุจุญุซ ุนู ุนูุตุฑ ุงููุนุงููุฉ

    if (!file) {
        profilePicDataUrl = null;
        if(fileNameDisplay) fileNameDisplay.textContent = '';
        if(picPreview) picPreview.style.display = 'none'; // โญ ุฅุฎูุงุก ุงููุนุงููุฉ ุนูุฏ ุงูุฅูุบุงุก
        generateCV(cvContainer);
        updateProgress();
        return;
    }

    if(fileNameDisplay) fileNameDisplay.textContent = file.name;

    // ุงูุชุญูู ูู ููุน ูุญุฌู ุงูููู
    if (!file.type.startsWith('image/')) {
        alert(translations[currentLang]['Please select a valid image file.']);
        inputElement.value = '';
        if(fileNameDisplay) fileNameDisplay.textContent = '';
        if(picPreview) picPreview.style.display = 'none'; // โญ ุฅุฎูุงุก ุงููุนุงููุฉ ุนูุฏ ุงูุฎุทุฃ
        return;
    }
    if (file.size > MAX_FILE_SIZE) {
        alert(translations[currentLang]['Image size is too large. Please select an image smaller than {size} megabytes.'].replace('{size}', MAX_FILE_SIZE / 1024 / 1024));
        inputElement.value = '';
        if(fileNameDisplay) fileNameDisplay.textContent = '';
        if(picPreview) picPreview.style.display = 'none'; // โญ ุฅุฎูุงุก ุงููุนุงููุฉ ุนูุฏ ุงูุฎุทุฃ
        return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
        // โญ ุนุฑุถ ุงูุตูุฑุฉ ุงููุฎุชุงุฑุฉ ููุฑูุง ูู ุฃููููุฉ ุงููุนุงููุฉ
        if (picPreview) {
            picPreview.src = e.target.result;
            picPreview.style.display = 'inline-block'; // ุฅุธูุงุฑ ุงูุฃููููุฉ
        }

        const img = new Image();
        img.onload = function() {
            const canvas = document.createElement('canvas');
            const MAX_WIDTH = 400;
            const MAX_HEIGHT = 400;
            let width = img.width;
            let height = img.height;

            if (width > height) {
                if (width > MAX_WIDTH) {
                    height *= MAX_WIDTH / width;
                    width = MAX_WIDTH;
                }
            } else {
                if (height > MAX_HEIGHT) {
                    width *= MAX_HEIGHT / height;
                    height = MAX_HEIGHT;
                }
            }
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);
            
            profilePicDataUrl = canvas.toDataURL('image/jpeg', 0.9);

            generateCV(cvContainer);
            updateProgress();
        };
        img.src = e.target.result;
    };
    reader.readAsDataURL(file);
}

function addExperienceField(data = null) {
    const container = document.getElementById('experience-input');
    if (!container) return;
    const newEntry = document.createElement('div');
    newEntry.className = 'experience-entry';
    // --- โญ ุชุนุฏูู: ุงุณุชุฎุฏุงู ูุงุฆู ุงูุชุฑุฌูุฉ ูุจุงุดุฑุฉ ---
    newEntry.innerHTML = `
        <button type="button" class="remove-field" onclick="removeField(this)"><i class="fas fa-times-circle"></i></button>
        <input type="text" placeholder="${translations[currentLang]['Job Title_placeholder'] || 'Job Title'}" class="experience-title" oninput="generateCV(cvContainer); updateProgress()">
        <input type="text" placeholder="${translations[currentLang]['Company'] || 'Company'}" class="experience-company" oninput="generateCV(cvContainer); updateProgress()">
        <input type="text" placeholder="${translations[currentLang]['Duration'] || 'Duration'}" class="experience-duration" oninput="generateCV(cvContainer); updateProgress()">
        <textarea placeholder="${translations[currentLang]['Description'] || 'Description'}" class="experience-description" oninput="generateCV(cvContainer); updateProgress()"></textarea>
    `;
    container.appendChild(newEntry);

    if (data) {
        newEntry.querySelector('.experience-title').value = data.title || '';
        newEntry.querySelector('.experience-company').value = data.company || '';
        newEntry.querySelector('.experience-duration').value = data.duration || '';
        newEntry.querySelector('.experience-description').value = data.description || '';
    }
}

function removeLastExperienceField() {
    const experienceInput = document.getElementById('experience-input');
    if (!experienceInput) return;
    const entries = experienceInput.querySelectorAll('.experience-entry');
    if (entries.length > 1) {
        experienceInput.removeChild(entries[entries.length - 1]);
        generateCV(cvContainer); updateProgress();
    } else {
        alert(translations[currentLang]['You must have at least one field in this section.']);
    }
}

function addEducationField(data = null) {
    const educationInput = document.getElementById('education-input');
    if (!educationInput) return;
    const newEntry = document.createElement('div');
    newEntry.className = 'education-entry';
    // --- โญ ุชุนุฏูู: ุงุณุชุฎุฏุงู ูุงุฆู ุงูุชุฑุฌูุฉ ูุจุงุดุฑุฉ ---
    newEntry.innerHTML = `
         <button type="button" class="remove-field" onclick="removeField(this)"><i class="fas fa-times-circle"></i></button>
        <input type="text" placeholder="${translations[currentLang]['Degree'] || 'Degree'}" class="education-degree" oninput="generateCV(cvContainer); updateProgress()">
        <input type="text" placeholder="${translations[currentLang]['University/Institution'] || 'University/Institution'}" class="education-institution" oninput="generateCV(cvContainer); updateProgress()">
        <input type="text" placeholder="${translations[currentLang]['Duration'] || 'Duration'}" class="education-duration" oninput="generateCV(cvContainer); updateProgress()">
    `;
    educationInput.appendChild(newEntry);

    if (data) {
        newEntry.querySelector('.education-degree').value = data.degree || '';
        newEntry.querySelector('.education-institution').value = data.institution || '';
        newEntry.querySelector('.education-duration').value = data.duration || '';
    }
}

// ุงุณุชุจุฏู ุฏุงูุฉ addSkillField ุจุงููุงูู
function addSkillField(data = null) {
    const skillsInput = document.getElementById('skills-input');
    if (!skillsInput) return;

    // --- ุฅูุดุงุก ุงูุนูุงุตุฑ ุจุฑูุฌูุงู (ุงูุทุฑููุฉ ุงูุฌุฏูุฏุฉ) ---
    const newEntry = document.createElement('div');
    newEntry.className = 'skill-entry border p-2 mb-2 rounded position-relative';

    const removeButton = document.createElement('button');
    removeButton.type = 'button';
    removeButton.className = 'remove-field';
    removeButton.innerHTML = '&times;';
    removeButton.onclick = () => removeField(removeButton);

    const row = document.createElement('div');
    row.className = 'row';

    const col1 = document.createElement('div');
    col1.className = 'col-md-6';
    const nameInput = document.createElement('input');
    nameInput.type = 'text';
    nameInput.className = 'form-control skill-item-input';
    nameInput.placeholder = translations[currentLang]['Enter a skill'] || 'Enter a skill';
    nameInput.oninput = () => { generateCV(cvContainer); updateProgress(); };
    col1.appendChild(nameInput);

    const col2 = document.createElement('div');
    col2.className = 'col-md-6';
    const levelSelect = document.createElement('select');
    levelSelect.className = 'form-select skill-level-select';
    levelSelect.onchange = () => { generateCV(cvContainer); updateProgress(); };
    
    // ุฅุถุงูุฉ ุฎูุงุฑุงุช ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ูุน ุงูุชุฑุฌูุฉ
    const levels = {
        '0': 'Select Level',
        '30%': 'Beginner',
        '50%': 'Intermediate',
        '75%': 'Advanced',
        '100%': 'Expert'
    };
    for (const [value, key] of Object.entries(levels)) {
        const option = document.createElement('option');
        option.value = value;
        option.textContent = translations[currentLang][key] || key;
        levelSelect.appendChild(option);
    }
    col2.appendChild(levelSelect);

    row.appendChild(col1);
    row.appendChild(col2);
    newEntry.appendChild(removeButton);
    newEntry.appendChild(row);
    skillsInput.appendChild(newEntry);

    // ููุก ุงูุจูุงูุงุช ุฅุฐุง ูุงูุช ููุฌูุฏุฉ (ููุงุณุชุฑุฌุงุน ูู ุงูุฐุงูุฑุฉ)
    if (data) {
        nameInput.value = data.name || (typeof data === 'string' ? data : '');
        if (data.level) levelSelect.value = data.level;
    }
}
// ููุง ุชูุณ ุชุนุฏูู ุฏุงูุฉ ุฌูุจ ุจูุงูุงุช ุงูููุงุฑุงุช ูุชูุฑุฃ ุงููุณุชูู ุฃูุถุงู
function getSkillsData() {
    const skills = [];
    document.querySelectorAll('#skills-input .skill-entry').forEach(entry => {
        const name = entry.querySelector('.skill-item-input').value.trim();
        const level = entry.querySelector('.skill-level-select').value;
        if (name && level !== '0') {
            skills.push({ name, level });
        }
    });
    return skills;
}

// ูุฃุถู ุงูุชุฑุฌูุงุช ุงูุฌุฏูุฏุฉ ููุงุฆู translations
// ูู ูุณู ar
// "Select Level": "ุงุฎุชุฑ ุงููุณุชูู", "Beginner": "ูุจุชุฏุฆ", "Intermediate": "ูุชูุณุท", "Advanced": "ูุชูุฏู", "Expert": "ุฎุจูุฑ"
// ูู ูุณู en
// "Select Level": "Select Level", "Beginner": "Beginner", "Intermediate": "Intermediate", "Advanced": "Advanced", "Expert": "Expert"

function removeLastSkillField() {
    const skillsInput = document.getElementById('skills-input');
    if (!skillsInput) return;
    const entries = skillsInput.querySelectorAll('.skill-entry');
    // ุชุนุฏูู: ูุญุฐู ุทุงููุง ููุฌุฏ ุนูุตุฑ ูุงุญุฏ ุนูู ุงูุฃูู
    if (entries.length > 0) {
        skillsInput.removeChild(entries[entries.length - 1]);
        generateCV(cvContainer); 
        updateProgress();
    }
}

function removeLastLanguageField() {
    const languagesInput = document.getElementById('languages-input');
    if (!languagesInput) return;
    const entries = languagesInput.querySelectorAll('.language-entry');
    // ุชุนุฏูู: ูุญุฐู ุทุงููุง ููุฌุฏ ุนูุตุฑ ูุงุญุฏ ุนูู ุงูุฃูู
    if (entries.length > 0) {
        languagesInput.removeChild(entries[entries.length - 1]);
        generateCV(cvContainer); 
        updateProgress();
    }
}

function removeLastReferenceField() {
    const referencesInput = document.getElementById('references-input');
    if (!referencesInput) return;
    const entries = referencesInput.querySelectorAll('.reference-entry');
    // ุชุนุฏูู: ูุญุฐู ุทุงููุง ููุฌุฏ ุนูุตุฑ ูุงุญุฏ ุนูู ุงูุฃูู
    if (entries.length > 0) {
        referencesInput.removeChild(entries[entries.length - 1]);
        generateCV(cvContainer); 
        updateProgress();
    }
}

function removeField(button) {
    const entry = button.parentElement;
    const parentContainer = entry.parentElement;
    // ุชุนุฏูู: ุฃุฒููุง ุงูุดุฑุท ุงูุฐู ูููุน ุญุฐู ุขุฎุฑ ุนูุตุฑ
    parentContainer.removeChild(entry);
    generateCV(cvContainer); 
    updateProgress();
}

function addLanguageField(data = null) {
    const languagesInput = document.getElementById('languages-input');
    if (!languagesInput) return;
    const newEntry = document.createElement('div');
    newEntry.className = 'language-entry';
    // --- โญ ุชุนุฏูู: ุงุณุชุฎุฏุงู ูุงุฆู ุงูุชุฑุฌูุฉ ูุจุงุดุฑุฉ ---
    newEntry.innerHTML = `
        <button type="button" class="remove-field" onclick="removeField(this)"><i class="fas fa-times-circle"></i></button>
        <input type="text" placeholder="${translations[currentLang]['Enter a language'] || 'Enter a language'}" class="language-item-input" oninput="generateCV(cvContainer); updateProgress()">
    `;
    languagesInput.appendChild(newEntry);
    
    if (data) {
        newEntry.querySelector('.language-item-input').value = data || '';
    }
}

function addReferenceField(data = null) {
    const referencesInput = document.getElementById('references-input');
    if (!referencesInput) return;
    const newEntry = document.createElement('div');
    newEntry.className = 'reference-entry';
    // --- โญ ุชุนุฏูู: ุงุณุชุฎุฏุงู ูุงุฆู ุงูุชุฑุฌูุฉ ูุจุงุดุฑุฉ ---
    newEntry.innerHTML = `
        <button type="button" class="remove-field" onclick="removeField(this)"><i class="fas fa-times-circle"></i></button>
        <input type="text" placeholder="${translations[currentLang]['Name'] || 'Name'}" class="reference-name" oninput="generateCV(cvContainer); updateProgress()">
        <input type="text" placeholder="${translations[currentLang]['Position'] || 'Position'}" class="reference-position" oninput="generateCV(cvContainer); updateProgress()">
        <input type="text" placeholder="${translations[currentLang]['Phone'] || 'Phone'}" class="reference-phone" oninput="generateCV(cvContainer); updateProgress()">
        <input type="email" placeholder="${translations[currentLang]['Email'] || 'Email'}" class="reference-email" oninput="generateCV(cvContainer); updateProgress()">
    `;
    referencesInput.appendChild(newEntry);

    if (data) {
        newEntry.querySelector('.reference-name').value = data.name || '';
        newEntry.querySelector('.reference-position').value = data.position || '';
        newEntry.querySelector('.reference-phone').value = data.phone || '';
        newEntry.querySelector('.reference-email').value = data.email || '';
    }
}



/**
 * =========================================================================
 * == ุฏุงูุฉ generateCV ุงูููุงุฆูุฉ - ูุน ุฅุถุงูุฉ ุนูุตุฑ ุงูุชูุฏุฏ (endmarker) ==
 * =========================================================================
 * @param {HTMLElement} targetElement The DOM element to populate with CV content.
 */
function generateCV(targetElement) {
    if (!targetElement) {
        console.error("[generateCV] Target element is null!");
        return;
    }

    const isArabic = currentLang === 'ar';
    const direction = isArabic ? 'rtl' : 'ltr';
    targetElement.dir = direction;
    targetElement.innerHTML = ''; // ูุณุญ ุงููุญุชูู ุงููุฏูู

    // --- 1. ุฌูุน ุงูุจูุงูุงุช ---
    const name = document.getElementById('name-input')?.value.trim() || '';
    const title = document.getElementById('title-input')?.value.trim() || '';
    const emailVal = document.getElementById('email-input')?.value.trim() || '';
    const phone = document.getElementById('phone-input')?.value.trim() || '';
    const website = document.getElementById('website-input')?.value.trim() || '';
    const objective = document.getElementById('objective-input')?.value.trim() || '';

    // --- 2. ุจูุงุก ุฃุฌุฒุงุก HTML ---
    const endMarkerHTML = createEndMarkerHTML();
    let profilePicHTML = profilePicDataUrl ? `<img src="${profilePicDataUrl}" class="cv-profile-pic" alt="Profile Picture">` : '';

    let contactInfoHTML = `<div class="cv-section" data-section-name="contact-info"><div class="cv-contact-info">`;
    if (emailVal) contactInfoHTML += `<div class="cv-contact-item"><i class="fas fa-envelope"></i><p>${emailVal}</p></div>`;
    if (phone) contactInfoHTML += `<div class="cv-contact-item"><i class="fas fa-phone"></i><p>${phone}</p></div>`;
    if (website) contactInfoHTML += `<div class="cv-contact-item"><i class="fas fa-map-marker-alt"></i><p>${website}</p></div>`;
    contactInfoHTML += '</div></div>';

    const objectiveHTML = objective ? `<div class="cv-section" id="objective"><h3 class="cv-section-title">${translations[currentLang]['Career Objective']}</h3><p>${objective.replace(/(\r\n|\n|\r)+/g, '<br>')}</p></div>` : '';

    let experienceHTML = '';
    const experienceEntries = getExperiencesData();
    if (experienceEntries.length > 0 && experienceEntries.some(e => e.title || e.company)) {
        experienceHTML = `<div class="cv-section" id="experience"><h3 class="cv-section-title">${translations[currentLang]['Work Experience']}</h3>`;
        experienceEntries.forEach(entry => {
            if (entry.title || entry.company) {
                experienceHTML += `<div class="cv-experience-item"><h4 class="cv-job-title">${entry.title}</h4><h5 class="cv-company">${entry.company}${entry.company && entry.duration ? ' - ' : ''}${entry.duration}</h5><p>${entry.description.replace(/(\r\n|\n|\r)+/g, '<br>')}</p></div>`;
            }
        });
        experienceHTML += '</div>';
    }

    let educationHTML = '';
    const educationEntries = getEducationsData();
    if (educationEntries.length > 0 && educationEntries.some(e => e.degree || e.institution)) {
        educationHTML = `<div class="cv-section" id="education"><h3 class="cv-section-title">${translations[currentLang]['Education']}</h3>`;
        educationEntries.forEach(entry => {
             if (entry.degree || entry.institution) {
                educationHTML += `<div class="cv-education-item"><h4 class="cv-degree">${entry.degree}</h4><h5 class="cv-institution">${entry.institution}${entry.institution && entry.duration ? ' - ' : ''}${entry.duration}</h5></div>`;
            }
        });
        educationHTML += '</div>';
    }

    let customSectionsHTML = '';
    const customSections = getCustomSectionsData();
    if (customSections.length > 0) {
        customSections.forEach(section => {
            customSectionsHTML += `<div class="cv-section" id="custom-${section.title.replace(/\s+/g, '-')}">`;
            customSectionsHTML += `<h3 class="cv-section-title">${section.title}</h3>`;
            section.subSections.forEach(sub => {
                customSectionsHTML += `<div class="cv-experience-item">`; // ูุณุชุฎุฏู ููุณ ุชูุณูู ุงูุฎุจุฑุงุช
                if (sub.title) {
                    customSectionsHTML += `<h4 class="cv-job-title">${sub.title}</h4>`;
                }
                if (sub.description) {
                    customSectionsHTML += `<p>${sub.description.replace(/(\r\n|\n|\r)+/g, '<br>')}</p>`;
                }
                customSectionsHTML += `</div>`;
            });
            customSectionsHTML += `</div>`;
        });
    }
    
    const skillsContainerClass = (selectedTemplateCategory === 'normal') ? 'horizontal-skills' : 'vertical-skills';

    let skillsHTMLWithLevels = '';
    const skillsWithLevels = getSkillsData();
    if (skillsWithLevels.length > 0) {
        // 2. ูุณุชุฎุฏู ุงููุชุบูุฑ ุงูุฌุฏูุฏ ููุถุน ุงูููุงุณ ุงูุตุญูุญ ูู ุงูู HTML
        skillsHTMLWithLevels = `<div class="cv-section" id="skills"><h3 class="cv-section-title">${translations[currentLang]['Skills']}</h3><div class="skills-container ${skillsContainerClass}">`;
        skillsWithLevels.forEach(skill => {
            skillsHTMLWithLevels += `<div class="skill-item-wrapper"><span class="skill-name">${skill.name}</span><div class="skill-level-bar"><div class="skill-level-progress" style="width: ${skill.level};"></div></div></div>`;
        });
        skillsHTMLWithLevels += '</div></div>';
    }

    
    let languagesHTML = '';
    const filledLanguages = getLanguagesData();
    if (filledLanguages.length > 0) {
        languagesHTML = `<div class="cv-section" id="languages"><h3 class="cv-section-title">${translations[currentLang]['Languages']}</h3><ul class="cv-language-list">`;
        filledLanguages.forEach(lang => { languagesHTML += `<li>${lang}</li>`; });
        languagesHTML += '</ul></div>';
    }
    
    let referencesHTML = '';
    const referenceEntries = getReferencesData();
    if (referenceEntries.length > 0 && referenceEntries.some(r => r.name)) {
        referencesHTML = `<div class="cv-section" id="references"><h3 class="cv-section-title">${translations[currentLang]['References']}</h3><div class="cv-references-list">`;
        referenceEntries.forEach(ref => {
            if(ref.name) {
                referencesHTML += `<div class="cv-reference-item"><h4>${ref.name}</h4><p>${ref.position || ''}</p><p>${ref.phone || ''}</p><p>${ref.email || ''}</p></div>`;
            }
        });
        referencesHTML += '</div></div>';
    }

    // --- 3. ุจูุงุก ุงููููู ุงูููุงุฆู ุจูุงุกู ุนูู ูุฆุฉ ุงููุงูุจ ---
    const cvContentDiv = document.createElement('div');
    cvContentDiv.className = 'cv-content';

    if (selectedTemplateCategory === 'normal') {
        cvContentDiv.innerHTML = `<div class="cv-header">${profilePicHTML}<div class="cv-header-text"><h1 class="cv-name">${name}</h1><h2 class="cv-title">${title}</h2>${contactInfoHTML}</div></div><div class="cv-body-content">${objectiveHTML}${experienceHTML}${customSectionsHTML}${educationHTML}${skillsHTMLWithLevels}${languagesHTML}${referencesHTML}${endMarkerHTML}</div>`;
    } 
    else if (selectedTemplateCategory === 'creative') {
        if (selectedTemplate == 1) {
            cvContentDiv.innerHTML = `<div class="header-wave">${profilePicHTML}<div class="header-text"><h1 class="cv-name">${name}</h1><h2 class="cv-title">${title}</h2></div></div><div class="content-columns"><div class="left-column">${objectiveHTML}${experienceHTML}${customSectionsHTML}${educationHTML}${referencesHTML}${endMarkerHTML}</div><div class="right-column">${contactInfoHTML}${skillsHTMLWithLevels}${languagesHTML}${endMarkerHTML}</div></div>`;
        } else if (selectedTemplate == 2) {
            cvContentDiv.innerHTML = `<div class="header-wave"><h1 class="cv-name">${name}</h1><h2 class="cv-title">${title}</h2></div><div class="content-columns"><div class="left-column">${objectiveHTML}${experienceHTML}${customSectionsHTML}${educationHTML}${endMarkerHTML}</div><div class="right-column">${profilePicHTML}${contactInfoHTML}${skillsHTMLWithLevels}${languagesHTML}${referencesHTML}${endMarkerHTML}</div></div>`;
        } else if (selectedTemplate == 3) {
            cvContentDiv.innerHTML = `<div class="cv-sidebar"><div class="cv-header two-col-main">${profilePicHTML}<h1 class="cv-name">${name}</h1><h2 class="cv-title">${title}</h2></div>${contactInfoHTML}${skillsHTMLWithLevels}${languagesHTML}${referencesHTML}${endMarkerHTML}</div><div class="cv-main-content">${objectiveHTML}${experienceHTML}${customSectionsHTML}${educationHTML}${endMarkerHTML}</div>`;
        }
    }
    // === ุจุฏุงูุฉ: ุงูููุฏ ุงููุตุญุญ ุงูุฐู ูุนุงูุฌ ูู ุงููุฆุงุช ุงููุชุจููุฉ ===
    else { // ูุฐุง ุงูููุฏ ุณูุนุงูุฌ ุงูุขู Standard, AST, ู Professional ุจุดูู ุตุญูุญ
        const layoutDiv = document.createElement('div');
        const sidebarDiv = document.createElement('div');
        sidebarDiv.className = 'cv-sidebar';
        const mainContentDiv = document.createElement('div');
        mainContentDiv.className = 'cv-main-content';

        if (selectedTemplateCategory === 'professional') {
            layoutDiv.className = 'cv-professional-layout';
            const professionalHeader = document.createElement('div');
            professionalHeader.className = 'cv-header professional-layout';
    
            // --- ุงูููุทู ุงูุฌุฏูุฏ ูุชูุฒูุน ุงููุญุชูู ุจุดูู ุตุญูุญ ูู ุงูุจุฏุงูุฉ ---
            let headerHTML, sidebarHTML;
            
            // ุฅุฐุง ูุงู ุงููุงูุจ 1 ุฃู 3
            if (selectedTemplate == 1 || selectedTemplate == 3) {
                // ุงูุตูุฑุฉ ููุนูููุงุช ุงูุงุชุตุงู ุชููู ูู ุงูุฑุฃุณ
                const contactForHeader = contactInfoHTML.replace('<div class="cv-section" data-section-name="contact-info">', '').replace(/<\/div>$/, '');
                headerHTML = `<div class="cv-details">${profilePicHTML}<h1 class="cv-name">${name}</h1><h2 class="cv-title">${title}</h2>${contactForHeader}</div>`;
                sidebarHTML = `${skillsHTMLWithLevels}${languagesHTML}${referencesHTML}${endMarkerHTML}`;
            } 
            // ุฅุฐุง ูุงู ุงููุงูุจ 2
            else { 
                // ุงูุตูุฑุฉ ููุนูููุงุช ุงูุงุชุตุงู ุชููู ูู ุงูุนุงููุฏ ุงูุฌุงูุจู
                headerHTML = `<div class="cv-details"><h1 class="cv-name">${name}</h1><h2 class="cv-title">${title}</h2></div>`;
                sidebarHTML = `${profilePicHTML}${contactInfoHTML}${skillsHTMLWithLevels}${languagesHTML}${referencesHTML}${endMarkerHTML}`;
            }
    
ย ย ย ย ย ย professionalHeader.innerHTML = headerHTML;
ย ย ย ย ย ย sidebarDiv.innerHTML = sidebarHTML;
ย ย ย ย ย ย mainContentDiv.innerHTML = `${objectiveHTML}${experienceHTML}${customSectionsHTML}${educationHTML}${endMarkerHTML}`;
ย ย ย ย ย ย cvContentDiv.appendChild(professionalHeader);           

        } else { // ูุฐุง ุงูุฌุฒุก ูุนุงูุฌ Standard ู AST ููุง ูุงู
            layoutDiv.className = 'cv-two-column-layout';
            sidebarDiv.innerHTML = profilePicHTML + contactInfoHTML + skillsHTMLWithLevels + languagesHTML + referencesHTML + endMarkerHTML;
            mainContentDiv.innerHTML = `<div class="cv-header two-col-main"><h1 class="cv-name">${name}</h1><h2 class="cv-title">${title}</h2></div>${objectiveHTML}${experienceHTML}${customSectionsHTML}${educationHTML}${endMarkerHTML}`;
        }
        
        layoutDiv.appendChild(sidebarDiv);
        layoutDiv.appendChild(mainContentDiv);
        cvContentDiv.appendChild(layoutDiv);
    }
    // === ููุงูุฉ: ุงูููุฏ ุงููุตุญุญ ===
    
    targetElement.appendChild(cvContentDiv);

    // --- 4. ุงุณุชุฏุนุงุก ุฏูุงู ุงูุชูุณูู ูุงูุชุญุฏูุซ ุจุนุฏ ุจูุงุก ุงููููู ---
    saveCvDataToLocalStorage();
    applySelectedFonts();
    applySelectedColors();
    applyDynamicSizes();
}



function createEndMarkerHTML() {
    const endText = translations[currentLang]["End of CV"] || (currentLang === 'ar' ? "ููุงูุฉ ุงูุณูุฑุฉ" : "End of CV");
    return `<div class="cv-end-marker" style="height: 279mm !important; margin-top:auto !important; visibility: hidden !important; font-size:1px; color:transparent;">${endText}</div>`;
}

function updateProgress() {
    const progressBar = document.getElementById('progressBar');
    if (!progressBar) return;

    const nameInput = document.getElementById('name-input');
    const titleInput = document.getElementById('title-input');
    const emailInput = document.getElementById('email-input');
    const phoneInput = document.getElementById('phone-input');
    const websiteInput = document.getElementById('website-input');
    const objectiveInput = document.getElementById('objective-input');
    const profilePicInput = document.getElementById('profile-pic-input');

    let filledCoreFields = 0;
    if (nameInput && nameInput.value.trim()) filledCoreFields++;
    if (titleInput && titleInput.value.trim()) filledCoreFields++;
    if (emailInput && emailInput.value.trim()) filledCoreFields++;
    if (phoneInput && phoneInput.value.trim()) filledCoreFields++;
    if (websiteInput && websiteInput.value.trim()) filledCoreFields++;
    if (objectiveInput && objectiveInput.value.trim()) filledCoreFields++;
    if (profilePicInput && profilePicInput.files && profilePicInput.files.length > 0) filledCoreFields++;
    const totalCoreFields = 7;
    const coreFieldsWeight = 6;

    const sections = ['experience', 'education', 'skills', 'languages', 'references'];
    let filledSectionsCount = 0;
    sections.forEach(sectionId => {
        const sectionContainer = document.getElementById(`${sectionId}-input`);
        if (sectionContainer) {
            const inputs = sectionContainer.querySelectorAll('input, textarea');
            if (Array.from(inputs).some(input => input.value.trim() !== '')) {
                filledSectionsCount++;
            }
        }
    });
    const totalSections = sections.length;
    const sectionsOverallWeight = 4;

    let currentWeight = 0;
    if (totalCoreFields > 0) currentWeight += (filledCoreFields / totalCoreFields) * coreFieldsWeight;
    if (totalSections > 0) currentWeight += (filledSectionsCount / totalSections) * sectionsOverallWeight;
    
    const progress = Math.min(100, Math.round(currentWeight * 10));

    progressBar.style.width = `${progress}%`;
    progressBar.textContent = `${progress}%`;
    if (progress < 30) progressBar.style.backgroundColor = '#dc3545';
    else if (progress < 70) progressBar.style.backgroundColor = '#ffc107';
    else progressBar.style.backgroundColor = '#28a745';
}

function populateWithTestData() {
    const nameInput = document.getElementById('name-input');
    const titleInput = document.getElementById('title-input');
    const emailInput = document.getElementById('email-input');
    const phoneInput = document.getElementById('phone-input');
    const websiteInput = document.getElementById('website-input');
    const objectiveInput = document.getElementById('objective-input');
    
    if(nameInput) nameInput.value = currentLang === 'ar' ? 'ุฃุญูุฏ ูุญูุฏ ุงูุณูุฏ' : 'Ahmed Mohamed Elsayed';
    if(titleInput) titleInput.value = currentLang === 'ar' ? 'ูููุฏุณ ุจุฑูุฌูุงุช' : 'Software Engineer';
    if(emailInput) emailInput.value = 'ahmed.elsayed@example.com';
    if(phoneInput) phoneInput.value = '0501234567';
    if(websiteInput) websiteInput.value = currentLang === 'ar' ? 'ุงููุฏููุฉ ุงููููุฑุฉ' : 'Saudi Arabia';
    if(objectiveInput) objectiveInput.value = currentLang === 'ar' ? 
        'ูููุฏุณ ุจุฑูุฌูุงุช ุฐู ุฎุจุฑุฉ ุนุงููุฉ ูู ุชุทููุฑ ุชุทุจููุงุช ุงูููุจ ูุงูุฌูุงูุ ุฃุจุญุซ ุนู ูุฑุตุฉ ููุงูุถูุงู ุฅูู ูุฑูู ุฏููุงูููู ูููุณุงููุฉ ูู ุจูุงุก ุญููู ุชูููุฉ ูุจุชูุฑุฉ ูุฐุงุช ุฌูุฏุฉ ุนุงููุฉ.' :
        'Highly experienced software engineer in web and mobile application development, seeking an opportunity to join a dynamic team to contribute to building innovative and high-quality technical solutions.';

    // === ุจุฏุงูุฉ ุงูุชุนุฏูู ุงูููู ููุง ===
    ['experience', 'education', 'skills', 'languages', 'references'].forEach(type => {
        const container = document.getElementById(`${type}-input`);
        if (container) {
            // ุฃููุงูุ ูุณุญ ูู ุงูุญููู ุงููุฏููุฉ ุงูููุฌูุฏุฉ
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }
            
            // ุซุงูููุงุ ุฅุถุงูุฉ ุงูุนุฏุฏ ุงููุทููุจ ูู ุงูุญููู
            if (type === 'experience') { 
                addExperienceField(); // ูุชุฑู ุญูููู ููุฎุจุฑุฉ ููุซุงู ุฌูุฏ
                addExperienceField(); 
            } else if (type === 'education') { 
                addEducationField(); 
            } else if (type === 'skills') { 
                addSkillField(); // ุฅุถุงูุฉ 5 ููุงุฑุงุช ููุซุงู
                addSkillField();
                addSkillField();
                addSkillField();
                addSkillField();
            } else if (type === 'languages') { 
                addLanguageField(); // ุฅุถุงูุฉ ุญูู ูุงุญุฏ ููุท ููุบุงุช
            } else if (type === 'references') { 
                addReferenceField(); // ุฅุถุงูุฉ ุญูู ูุงุญุฏ ููุท ูููุฑุงุฌุน
            }
        }
    });
    // === ููุงูุฉ ุงูุชุนุฏูู ุงูููู ููุง ===
    
    // ููุก ุงูุญููู ุงููุถุงูุฉ
    const expEntries = document.querySelectorAll('#experience-input .experience-entry');
    if (expEntries[0]) {
        expEntries[0].querySelector('.experience-title').value = currentLang === 'ar' ? 'ูููุฏุณ ุจุฑูุฌูุงุช ุฃูู' : 'Senior Software Engineer';
        expEntries[0].querySelector('.experience-company').value = currentLang === 'ar' ? 'ุดุฑูุฉ ุงูุญููู ุงููุจุชูุฑุฉ' : 'Innovative Solutions Inc.';
        expEntries[0].querySelector('.experience-duration').value = currentLang === 'ar' ? '2020 - ุญุชู ุงูุขู' : '2020 - Present';
        expEntries[0].querySelector('.experience-description').value = currentLang === 'ar' ? 'ููุงุฏุฉ ูุฑู ุงูุชุทููุฑุ ุชุตููู ูุชูููุฐ ูุนูุงุฑูุงุช ุงูุจุฑูุฌูุงุชุ ุชุญุณูู ุฃุฏุงุก ุงูุชุทุจููุงุช ูุชุฃููููุง.' : 'Leading development teams, designing and implementing software architectures, optimizing application performance and security.';
    }
    if (expEntries[1]) {
        expEntries[1].querySelector('.experience-title').value = currentLang === 'ar' ? 'ูููุฏุณ ุจุฑูุฌูุงุช' : 'Software Engineer';
        expEntries[1].querySelector('.experience-company').value = currentLang === 'ar' ? 'ุดุฑูุฉ ุงูุชูููุฉ ุงูุฑุงุฆุฏุฉ' : 'Leading Tech Co.';
        expEntries[1].querySelector('.experience-duration').value = currentLang === 'ar' ? '2017 - 2020' : '2017 - 2020';
        expEntries[1].querySelector('.experience-description').value = currentLang === 'ar' ? 'ุชุทููุฑ ูุตูุงูุฉ ุชุทุจููุงุช ุงูููุจ ุจุงุณุชุฎุฏุงู Node.js ู Reactุ ุงูุชุนุงูู ูุน ูุฑูู ุงูููุชุฌ ูุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู.' : 'Developed and maintained web applications using Node.js and React, collaborated with the product team to improve user experience.';
    }

    const eduEntries = document.querySelectorAll('#education-input .education-entry');
    if (eduEntries[0]) {
        eduEntries[0].querySelector('.education-degree').value = currentLang === 'ar' ? 'ุจูุงููุฑููุณ ุนููู ุญุงุณูุจ' : 'B.Sc. Computer Science';
        eduEntries[0].querySelector('.education-institution').value = currentLang === 'ar' ? 'ุฌุงูุนุฉ ุงูููู ููุฏ ููุจุชุฑูู ูุงููุนุงุฏู' : 'King Fahd University of Petroleum & Minerals';
        eduEntries[0].querySelector('.education-duration').value = currentLang === 'ar' ? '2012 - 2017' : '2012 - 2017';
    }

    const skillInputsTest = document.querySelectorAll('#skills-input .skill-item-input');
    if(skillInputsTest[0]) skillInputsTest[0].value = 'JavaScript';
    if(skillInputsTest[1]) skillInputsTest[1].value = 'React';
    if(skillInputsTest[2]) skillInputsTest[2].value = 'Node.js';
    if(skillInputsTest[3]) skillInputsTest[3].value = 'SQL';
    if(skillInputsTest[4]) skillInputsTest[4].value = currentLang === 'ar' ? 'ูููุฌูุงุช ุฃุฌุงูู' : 'Agile Methodologies';
    
    const langInputsTest = document.querySelectorAll('#languages-input .language-item-input');
    if(langInputsTest[0]) langInputsTest[0].value = currentLang === 'ar' ? 'ุงูุนุฑุจูุฉ (ูุบุฉ ุฃู)' : 'Arabic (Native)';
    
    const refEntries = document.querySelectorAll('#references-input .reference-entry');
    if (refEntries[0]) {
        refEntries[0].querySelector('.reference-name').value = currentLang === 'ar' ? 'ุงูุฏูุชูุฑ ุนูู ุฃุญูุฏ' : 'Dr. Ali Ahmed';
        refEntries[0].querySelector('.reference-position').value = currentLang === 'ar' ? 'ุฃุณุชุงุฐ ูุณุงุนุฏุ ุฌุงูุนุฉ ุงูููู ููุฏ' : 'Assistant Professor, KFUPM';
        refEntries[0].querySelector('.reference-phone').value = '0551234567';
        refEntries[0].querySelector('.reference-email').value = 'ali.ahmed@example.com';
    }

    generateCV(cvContainer);
    updateProgress();
}






